<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>gin框架学习</title>
      <link href="/2026/01/07/gin%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"/>
      <url>/2026/01/07/gin%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p><a href="https://gin-gonic.com/zh-cn/docs/">官方文档 | Gin Web Framework</a></p><p>Gin是一个非常受欢迎的Golang Web框架，在GitHub上已经有47k的星星，它和Golang的语法一样简洁明了，使得初学者得以迅速入门。</p><p>首先是安装第三方库</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><p>或安装</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/gin-gonic/gin@latest</span><br></pre></td></tr></table></figure><h3 id="gin初始化"><a href="#gin初始化" class="headerlink" title="gin初始化"></a>gin初始化</h3><p>使用gin编写一个接口也是非常简单</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Response <span class="keyword">struct</span> &#123;</span><br><span class="line">Code <span class="type">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">Msg  <span class="type">string</span> <span class="string">`json:&quot;msg&quot;`</span></span><br><span class="line">Data any    <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, Response&#123;</span><br><span class="line">Code: <span class="number">0</span>,</span><br><span class="line">Msg:  <span class="string">&quot;成功&quot;</span>,</span><br><span class="line">Data: <span class="keyword">map</span>[<span class="type">string</span>]any&#123;&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 1.初始化</span></span><br><span class="line">gin.SetMode(<span class="string">&quot;release&quot;</span>) <span class="comment">// 关闭gin 输出debug日志</span></span><br><span class="line">r := gin.Default()</span><br><span class="line"><span class="comment">// 2.挂载路由</span></span><br><span class="line">r.GET(<span class="string">&quot;/index&quot;</span>, Index)</span><br><span class="line"><span class="comment">// 3.绑定端口，运行</span></span><br><span class="line">err := r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>router:=gin.Default()</code>：这是默认的服务器。使用gin的<code>Default</code>方法创建一个路由<code>Handler</code>；</li><li>然后通过Http方法绑定路由规则和路由函数。不同于<code>net/http</code>库的路由函数，gin进行了封装，把<code>request</code>和<code>response</code>都封装到了<code>gin.Context</code>的上下文环境中。</li><li>最后启动路由的Run方法监听端口。还可以用<code>http.ListenAndServe(&quot;:8080&quot;, router)</code>，或者自定义Http服务器配置。</li></ol><h4 id="两种启动方式"><a href="#两种启动方式" class="headerlink" title="两种启动方式"></a>两种启动方式</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启动方式一</span></span><br><span class="line">router.Run(<span class="string">&quot;:8000&quot;</span>)</span><br><span class="line"><span class="comment">// 启动方式二</span></span><br><span class="line">http.ListenAndServe(<span class="string">&quot;:8000&quot;</span>, router)</span><br></pre></td></tr></table></figure><h4 id="修改为内网ip"><a href="#修改为内网ip" class="headerlink" title="修改为内网ip"></a>修改为内网ip</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.Run(<span class="string">&quot;0.0.0.0:8000&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="修改为本地ip"><a href="#修改为本地ip" class="headerlink" title="修改为本地ip"></a>修改为本地ip</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.Run(<span class="string">&quot;127.0.0.1:8000&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">  context.String(<span class="number">200</span>, <span class="string">&quot;Hello AcKnight!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建一个默认的路由</span></span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 绑定路由规则和路由函数，访问/index的路由，将由对应的函数去处理</span></span><br><span class="line">  router.GET(<span class="string">&quot;/index&quot;</span>, Index)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 启动监听，gin会把web服务运行在本机的0.0.0.0:8080端口上</span></span><br><span class="line">  router.Run(<span class="string">&quot;0.0.0.0:8080&quot;</span>)</span><br><span class="line">  <span class="comment">// 用原生http服务的方式， router.Run本质就是http.ListenAndServe的进一步封装</span></span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, router)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><h4 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h4><p>200 表示正常响应 <code>http.StatusOK</code></p><h4 id="返回字符串"><a href="#返回字符串" class="headerlink" title="返回字符串"></a>返回字符串</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/txt&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  c.String(http.StatusOK, <span class="string">&quot;返回txt&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="返回json"><a href="#返回json" class="headerlink" title="返回json"></a>返回json</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/json&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;hey&quot;</span>, <span class="string">&quot;status&quot;</span>: http.StatusOK&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 结构体转json</span></span><br><span class="line">router.GET(<span class="string">&quot;/moreJSON&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// You also can use a struct</span></span><br><span class="line">  <span class="keyword">type</span> Msg <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name    <span class="type">string</span> <span class="string">`json:&quot;user&quot;`</span></span><br><span class="line">    Message <span class="type">string</span></span><br><span class="line">    Number  <span class="type">int</span></span><br><span class="line">  &#125;</span><br><span class="line">  msg := Msg&#123;<span class="string">&quot;AcKnight&quot;</span>, <span class="string">&quot;hey&quot;</span>, <span class="number">21</span>&#125;</span><br><span class="line">  <span class="comment">// 注意 msg.Name 变成了 &quot;user&quot; 字段</span></span><br><span class="line">  <span class="comment">// 以下方式都会输出 :   &#123;&quot;user&quot;: &quot;hanru&quot;, &quot;Message&quot;: &quot;hey&quot;, &quot;Number&quot;: 123&#125;</span></span><br><span class="line">  c.JSON(http.StatusOK, msg)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="返回html"><a href="#返回html" class="headerlink" title="返回html"></a>返回html</h4><p>先要使用 <code>LoadHTMLGlob()</code>或者<code>LoadHTMLFiles()</code>方法来加载模板文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">r := gin.Default()</span><br><span class="line"><span class="comment">//r.LoadHTMLGlob(&quot;templates/*&quot;)</span></span><br><span class="line">r.LoadHTMLFiles(<span class="string">&quot;study_response/templates/index.html&quot;</span>)</span><br><span class="line">r.GET(<span class="string">&quot;&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(http.StatusOK, <span class="string">&quot;index.html&quot;</span>, <span class="keyword">map</span>[<span class="type">string</span>]any&#123;</span><br><span class="line"><span class="string">&quot;title&quot;</span>: <span class="string">&quot;AcKnight&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">r.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在模板中使用这个title，需要使用<code>&#123;&#123;  .title  &#125;&#125;</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;.title&#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    AcKnight</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>不同文件夹下模板名字可以相同，此时需要 LoadHTMLGlob() 加载两层模板路径。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">router.LoadHTMLGlob(<span class="string">&quot;templates/**/*&quot;</span>)</span><br><span class="line">router.GET(<span class="string">&quot;/posts/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.HTML(http.StatusOK, <span class="string">&quot;posts/index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Posts&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    c.HTML(http.StatusOK, <span class="string">&quot;users/index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Users&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="文件相应"><a href="#文件相应" class="headerlink" title="文件相应"></a>文件相应</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在golang总，没有相对文件的路径，它只有相对项目的路径</span></span><br><span class="line"><span class="comment">// 网页请求这个静态目录的前缀， 第二个参数是一个目录，注意，前缀不要重复</span></span><br><span class="line">router.StaticFS(<span class="string">&quot;/static&quot;</span>, http.Dir(<span class="string">&quot;static/static&quot;</span>))</span><br><span class="line"><span class="comment">// 配置单个文件， 网页请求的路由，文件的路径</span></span><br><span class="line">router.StaticFile(<span class="string">&quot;/titian.png&quot;</span>, <span class="string">&quot;static/titian.png&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/redirect&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//支持内部和外部的重定向</span></span><br><span class="line">    c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;http://www.baidu.com/&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><h4 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h4><h5 id="查询参数-Query"><a href="#查询参数-Query" class="headerlink" title="查询参数 Query"></a>查询参数 Query</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">query</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(c.Query(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">  fmt.Println(c.GetQuery(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">  fmt.Println(c.QueryArray(<span class="string">&quot;user&quot;</span>)) <span class="comment">// 拿到多个相同的查询参数</span></span><br><span class="line">  fmt.Println(c.DefaultQuery(<span class="string">&quot;addr&quot;</span>, <span class="string">&quot;四川省&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="动态参数-Param"><a href="#动态参数-Param" class="headerlink" title="动态参数 Param"></a>动态参数 Param</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">param</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(c.Param(<span class="string">&quot;user_id&quot;</span>))</span><br><span class="line">  fmt.Println(c.Param(<span class="string">&quot;book_id&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">&quot;/param/:user_id/&quot;</span>, _param)</span><br><span class="line">router.GET(<span class="string">&quot;/param/:user_id/:book_id&quot;</span>, _param)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?param/12</span></span><br><span class="line"><span class="comment">// ?param/12/123</span></span><br></pre></td></tr></table></figure><h5 id="表单-PostForm"><a href="#表单-PostForm" class="headerlink" title="表单 PostForm"></a>表单 PostForm</h5><p>可以接收 <code>multipart/form-data; </code>和<code>application/x-www-form-urlencoded</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">form</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(c.PostForm(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">  fmt.Println(c.PostFormArray(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">  fmt.Println(c.DefaultPostForm(<span class="string">&quot;addr&quot;</span>, <span class="string">&quot;四川省&quot;</span>)) <span class="comment">// 如果用户没传，就使用默认值</span></span><br><span class="line">  forms, err := c.MultipartForm()               <span class="comment">// 接收所有的form参数，包括文件</span></span><br><span class="line">  fmt.Println(forms, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="原始参数-GetRawData"><a href="#原始参数-GetRawData" class="headerlink" title="原始参数 GetRawData"></a>原始参数 GetRawData</h5><p>form-data</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">---------------------------<span class="number">-638149124879484626406689</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line">AcKnight</span><br><span class="line">---------------------------<span class="number">-638149124879484626406689</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line">zhangsan</span><br><span class="line">---------------------------<span class="number">-638149124879484626406689</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;addr&quot;</span></span><br><span class="line"></span><br><span class="line">长沙市</span><br><span class="line">---------------------------<span class="number">-638149124879484626406689</span>--</span><br></pre></td></tr></table></figure><p>x-www-form-urlencoded</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=abc&amp;age=<span class="number">23</span></span><br></pre></td></tr></table></figure><p>json</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AcKnight&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">raw</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  body, _ := c.GetRawData()</span><br><span class="line">  contentType := c.GetHeader(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">  <span class="keyword">switch</span> contentType &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;application/json&quot;</span>:</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// json解析到结构体</span></span><br><span class="line">    <span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">      Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">      Age  <span class="type">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> user User</span><br><span class="line">    err := json.Unmarshal(body, &amp;user)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(user)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>封装一个解析json到结构体上的函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bindJson</span><span class="params">(c *gin.Context, obj any)</span></span> (err <span class="type">error</span>) &#123;</span><br><span class="line">  body, _ := c.GetRawData()</span><br><span class="line">  contentType := c.GetHeader(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">  <span class="keyword">switch</span> contentType &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;application/json&quot;</span>:</span><br><span class="line">    err = json.Unmarshal(body, &amp;obj)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="四大请求方式"><a href="#四大请求方式" class="headerlink" title="四大请求方式"></a>四大请求方式</h5><p><code>GET</code> <code>POST</code> <code>PUT</code> <code>DELETE</code></p><p>Restful风格指的是网络应用中就是资源定位和资源操作的风格。不是标准也不是协议。</p><p>GET：从服务器取出资源（一项或多项）</p><p>POST：在服务器新建一个资源</p><p>PUT：在服务器更新资源（客户端提供完整资源数据）</p><p>PATCH：在服务器更新资源（客户端提供需要修改的资源数据）</p><p>DELETE：从服务器删除资源</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以文字资源为例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GET    /articles          文章列表</span></span><br><span class="line"><span class="comment">// GET    /articles/:id      文章详情</span></span><br><span class="line"><span class="comment">// POST   /articles          添加文章</span></span><br><span class="line"><span class="comment">// PUT    /articles/:id      修改某一篇文章</span></span><br><span class="line"><span class="comment">// DELETE /articles/:id      删除某一篇文章</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ArticleModel <span class="keyword">struct</span> &#123;</span><br><span class="line">  Title   <span class="type">string</span> <span class="string">`json:&quot;title&quot;`</span></span><br><span class="line">  Content <span class="type">string</span> <span class="string">`json:&quot;content&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Response <span class="keyword">struct</span> &#123;</span><br><span class="line">  Code <span class="type">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">  Data any    <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">  Msg  <span class="type">string</span> <span class="string">`json:&quot;msg&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">bindJson</span><span class="params">(c *gin.Context, obj any)</span></span> (err <span class="type">error</span>) &#123;</span><br><span class="line">  body, _ := c.GetRawData()</span><br><span class="line">  contentType := c.GetHeader(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">  <span class="keyword">switch</span> contentType &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;application/json&quot;</span>:</span><br><span class="line">    err = json.Unmarshal(body, &amp;obj)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err.Error())</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _getList 文章列表页面</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">getList</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 包含搜索，分页</span></span><br><span class="line">  articleList := []ArticleModel&#123;</span><br><span class="line">    &#123;<span class="string">&quot;Go语言入门&quot;</span>, <span class="string">&quot;这篇文章是《Go语言入门》&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;python语言入门&quot;</span>, <span class="string">&quot;这篇文章是《python语言入门》&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;JavaScript语言入门&quot;</span>, <span class="string">&quot;这篇文章是《JavaScript语言入门》&quot;</span>&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  c.JSON(<span class="number">200</span>, Response&#123;<span class="number">0</span>, articleList, <span class="string">&quot;成功&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _getDetail 文章详情</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">getDetail</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 获取param中的id</span></span><br><span class="line">  fmt.Println(c.Param(<span class="string">&quot;id&quot;</span>))</span><br><span class="line">  article := ArticleModel&#123;</span><br><span class="line">    <span class="string">&quot;Go语言入门&quot;</span>, <span class="string">&quot;这篇文章是《Go语言入门》&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  c.JSON(<span class="number">200</span>, Response&#123;<span class="number">0</span>, article, <span class="string">&quot;成功&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _create 创建文章</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">create</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 接收前端传递来的json数据</span></span><br><span class="line">  <span class="keyword">var</span> article ArticleModel</span><br><span class="line"></span><br><span class="line">  err := _bindJson(c, &amp;article)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  c.JSON(<span class="number">200</span>, Response&#123;<span class="number">0</span>, article, <span class="string">&quot;添加成功&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _update 编辑文章</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">update</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(c.Param(<span class="string">&quot;id&quot;</span>))</span><br><span class="line">  <span class="keyword">var</span> article ArticleModel</span><br><span class="line">  err := _bindJson(c, &amp;article)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  c.JSON(<span class="number">200</span>, Response&#123;<span class="number">0</span>, article, <span class="string">&quot;修改成功&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _delete 删除文章</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> _<span class="title">delete</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(c.Param(<span class="string">&quot;id&quot;</span>))</span><br><span class="line">  c.JSON(<span class="number">200</span>, Response&#123;<span class="number">0</span>, <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;&#125;, <span class="string">&quot;删除成功&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  router.GET(<span class="string">&quot;/articles&quot;</span>, _getList)       <span class="comment">// 文章列表</span></span><br><span class="line">  router.GET(<span class="string">&quot;/articles/:id&quot;</span>, _getDetail) <span class="comment">// 文章详情</span></span><br><span class="line">  router.POST(<span class="string">&quot;/articles&quot;</span>, _create)       <span class="comment">// 添加文章</span></span><br><span class="line">  router.PUT(<span class="string">&quot;/articles/:id&quot;</span>, _update)    <span class="comment">// 编辑文章</span></span><br><span class="line">  router.DELETE(<span class="string">&quot;/articles/:id&quot;</span>, _delete) <span class="comment">// 删除文章</span></span><br><span class="line">  router.Run(<span class="string">&quot;:80&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="请求头相关"><a href="#请求头相关" class="headerlink" title="请求头相关"></a>请求头相关</h5><h6 id="请求头参数获取"><a href="#请求头参数获取" class="headerlink" title="请求头参数获取"></a>请求头参数获取</h6><p><code>GetHeader</code>，可以大小写不分，且返回切片中的第一个数据</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 首字母大小写不区分  单词与单词之间用 - 连接</span></span><br><span class="line">  <span class="comment">// 用于获取一个请求头</span></span><br><span class="line">  fmt.Println(c.GetHeader(<span class="string">&quot;User-Agent&quot;</span>))</span><br><span class="line">  <span class="comment">//fmt.Println(c.GetHeader(&quot;user-agent&quot;))</span></span><br><span class="line">  <span class="comment">//fmt.Println(c.GetHeader(&quot;user-Agent&quot;))</span></span><br><span class="line">  <span class="comment">//fmt.Println(c.GetHeader(&quot;user-AGent&quot;))</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Header 是一个普通的 map[string][]string</span></span><br><span class="line">  fmt.Println(c.Request.Header)</span><br><span class="line">  <span class="comment">// 如果是使用 Get方法或者是 .GetHeader,那么可以不用区分大小写，并且返回第一个value</span></span><br><span class="line">  fmt.Println(c.Request.Header.Get(<span class="string">&quot;User-Agent&quot;</span>))</span><br><span class="line">  fmt.Println(c.Request.Header[<span class="string">&quot;User-Agent&quot;</span>])</span><br><span class="line">  <span class="comment">// 如果是用map的取值方式，请注意大小写问题</span></span><br><span class="line">  fmt.Println(c.Request.Header[<span class="string">&quot;user-agent&quot;</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自定义的请求头，用Get方法也是免大小写</span></span><br><span class="line">  fmt.Println(c.Request.Header.Get(<span class="string">&quot;Token&quot;</span>))</span><br><span class="line">  fmt.Println(c.Request.Header.Get(<span class="string">&quot;token&quot;</span>))</span><br><span class="line">  c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;成功&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="响应头相关"><a href="#响应头相关" class="headerlink" title="响应头相关"></a>响应头相关</h5><h6 id="设置响应头"><a href="#设置响应头" class="headerlink" title="设置响应头"></a>设置响应头</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置响应头</span></span><br><span class="line">router.GET(<span class="string">&quot;/res&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  c.Header(<span class="string">&quot;Token&quot;</span>, <span class="string">&quot;jhgeu%hsg845jUIF83jh&quot;</span>)</span><br><span class="line">  c.Header(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/text; charset=utf-8&quot;</span>)</span><br><span class="line">  c.JSON(<span class="number">0</span>, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;看看响应头&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><h5 id="单文件"><a href="#单文件" class="headerlink" title="单文件"></a>单文件</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  <span class="comment">// 为 multipart forms 设置较低的内存限制 (默认是 32 MiB)</span></span><br><span class="line">  <span class="comment">// 单位是字节， &lt;&lt; 是左移预算符号，等价于 8 * 2^20</span></span><br><span class="line">  <span class="comment">// gin对文件上传大小的默认值是32MB</span></span><br><span class="line">  router.MaxMultipartMemory = <span class="number">8</span> &lt;&lt; <span class="number">20</span>  <span class="comment">// 8 MiB</span></span><br><span class="line">  router.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 单文件</span></span><br><span class="line">    file, _ := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">    log.Println(file.Filename)</span><br><span class="line"></span><br><span class="line">    dst := <span class="string">&quot;./&quot;</span> + file.Filename</span><br><span class="line">    <span class="comment">// 上传文件至指定的完整文件路径</span></span><br><span class="line">    c.SaveUploadedFile(file, dst)</span><br><span class="line"></span><br><span class="line">    c.String(http.StatusOK, fmt.Sprintf(<span class="string">&quot;&#x27;%s&#x27; uploaded!&quot;</span>, file.Filename))</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="服务端保存文件的几种方式"><a href="#服务端保存文件的几种方式" class="headerlink" title="服务端保存文件的几种方式"></a>服务端保存文件的几种方式</h5><h6 id="SaveUploadedFile"><a href="#SaveUploadedFile" class="headerlink" title="SaveUploadedFile"></a>SaveUploadedFile</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.SaveUploadedFile(file, dst)  <span class="comment">// 文件对象  文件路径，注意要从项目根路径开始写</span></span><br></pre></td></tr></table></figure><h6 id="Create-Copy"><a href="#Create-Copy" class="headerlink" title="Create+Copy"></a>Create+Copy</h6><p>file.Open的第一个返回值就是我们讲文件对象中的那个文件（只读的），我们可以使用这个去直接读取文件内容</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">file, _ := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">log.Println(file.Filename)</span><br><span class="line"><span class="comment">// 读取文件中的数据，返回文件对象</span></span><br><span class="line">fileRead, _ := file.Open()</span><br><span class="line">dst := <span class="string">&quot;./&quot;</span> + file.Filename</span><br><span class="line"><span class="comment">// 创建一个文件</span></span><br><span class="line">out, err := os.Create(dst)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> out.Close()</span><br><span class="line"><span class="comment">// 拷贝文件对象到out中</span></span><br><span class="line">io.Copy(out, fileRead)</span><br></pre></td></tr></table></figure><h5 id="读取上传的文件"><a href="#读取上传的文件" class="headerlink" title="读取上传的文件"></a>读取上传的文件</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file, _ := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="comment">// 读取文件中的数据，返回文件对象</span></span><br><span class="line">fileRead, _ := file.Open()</span><br><span class="line">data, _ := io.ReadAll(fileRead)</span><br><span class="line">fmt.Println(<span class="type">string</span>(data))</span><br></pre></td></tr></table></figure><p>这里的玩法就很多了</p><p>例如我们可以基于文件中的内容，判断是否需要保存到服务器中</p><h5 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  <span class="comment">// 为 multipart forms 设置较低的内存限制 (默认是 32 MiB)</span></span><br><span class="line">  router.MaxMultipartMemory = <span class="number">8</span> &lt;&lt; <span class="number">20</span> <span class="comment">// 8 MiB</span></span><br><span class="line">  router.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Multipart form</span></span><br><span class="line">    form, _ := c.MultipartForm()</span><br><span class="line">    files := form.File[<span class="string">&quot;upload[]&quot;</span>]  <span class="comment">// 注意这里名字不要对不上了</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">      log.Println(file.Filename)</span><br><span class="line">      <span class="comment">// 上传文件至指定目录</span></span><br><span class="line">      c.SaveUploadedFile(file, <span class="string">&quot;./&quot;</span>+file.Filename)</span><br><span class="line">    &#125;</span><br><span class="line">    c.String(http.StatusOK, fmt.Sprintf(<span class="string">&quot;%d files uploaded!&quot;</span>, <span class="built_in">len</span>(files)))</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.File(<span class="string">&quot;uploads/12.png&quot;</span>)</span><br></pre></td></tr></table></figure><p>有些响应，比如图片，浏览器就会显示这个图片，而不是下载，所以我们需要使浏览器唤起下载行为</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c.Header(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/octet-stream&quot;</span>)              <span class="comment">// 表示是文件流，唤起浏览器下载，一般设置了这个，就要设置文件名</span></span><br><span class="line">c.Header(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=&quot;</span>+<span class="string">&quot;牛逼.png&quot;</span>) <span class="comment">// 用来指定下载下来的文件名</span></span><br><span class="line">c.Header(<span class="string">&quot;Content-Transfer-Encoding&quot;</span>, <span class="string">&quot;binary&quot;</span>)                   <span class="comment">// 表示传输过程中的编码形式，乱码问题可能就是因为它</span></span><br><span class="line">c.File(<span class="string">&quot;uploads/12.png&quot;</span>)</span><br></pre></td></tr></table></figure><p>注意，文件下载浏览器可能会有缓存，这个要注意一下</p><p>解决办法就是加查询参数</p><h5 id="前后端模式下的文件下载"><a href="#前后端模式下的文件下载" class="headerlink" title="前后端模式下的文件下载"></a>前后端模式下的文件下载</h5><p>如果是前后端模式下，后端就只需要响应一个文件数据</p><p>文件名和其他信息就写在请求头中</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c.Header(<span class="string">&quot;fileName&quot;</span>, <span class="string">&quot;xxx.png&quot;</span>)</span><br><span class="line">c.Header(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;文件下载成功&quot;</span>)</span><br><span class="line">c.File(<span class="string">&quot;uploads/12.png&quot;</span>)</span><br></pre></td></tr></table></figure><h6 id="前端写法"><a href="#前端写法" class="headerlink" title="前端写法"></a>前端写法</h6><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">async downloadFile(row) &#123;</span><br><span class="line">   this.$http(&#123;</span><br><span class="line">      method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      url: <span class="string">&#x27;file/upload&#x27;</span>,</span><br><span class="line">      data:postData,</span><br><span class="line">      responseType: <span class="string">&quot;blob&quot;</span></span><br><span class="line">   &#125;).then(res =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> _res = res.data</span><br><span class="line">      let blob = <span class="built_in">new</span> Blob([_res], &#123;</span><br><span class="line">            <span class="keyword">type</span>: <span class="string">&#x27;application/png&#x27;</span></span><br><span class="line">          &#125;);</span><br><span class="line">      let downloadElement = document.createElement(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">      let href = window.URL.createObjectURL(blob); <span class="comment">//创建下载的链接</span></span><br><span class="line">      downloadElement.href = href;</span><br><span class="line">      downloadElement.download = res.headers[<span class="string">&quot;fileName&quot;</span>]; <span class="comment">//下载后文件名</span></span><br><span class="line">      document.body.appendChild(downloadElement);</span><br><span class="line">      downloadElement.click(); <span class="comment">//点击下载</span></span><br><span class="line">      document.body.removeChild(downloadElement); <span class="comment">//下载完成移除元素</span></span><br><span class="line">      window.URL.revokeObjectURL(href); <span class="comment">//释放掉blob对象</span></span><br><span class="line">    &#125;)&#125;</span><br></pre></td></tr></table></figure><h3 id="中间件和路由"><a href="#中间件和路由" class="headerlink" title="中间件和路由"></a>中间件和路由</h3><p>Gin框架允许开发者在处理请求的过程中，加入用户自己的钩子（Hook）函数。这个钩子函数就叫中间件，中间件适合处理一些公共的业务逻辑，比如登录认证、权限校验、数据分页、记录日志、耗时统计等。 比如，如果访问一个网页的话，不管访问什么路径都需要进行登录，此时就需要为所有路径的处理函数进行统一一个中间件</p><p>Gin中的中间件必须是一个gin.HandlerFunc类型</p><h4 id="单独注册中间件"><a href="#单独注册中间件" class="headerlink" title="单独注册中间件"></a>单独注册中间件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexHandler</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;index.....&quot;</span>)</span><br><span class="line">  c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;index&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 in.........&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  r := gin.Default()</span><br><span class="line">  <span class="comment">//m1处于indexHandler函数的前面,请求来之后,先走m1,再走index</span></span><br><span class="line">  r.GET(<span class="string">&quot;/index&quot;</span>, m1, indexHandler)</span><br><span class="line"></span><br><span class="line">  _ = r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多个中间件"><a href="#多个中间件" class="headerlink" title="多个中间件"></a>多个中间件</h4><p>router.GET，后面可以跟很多HandlerFunc方法，这些方法其实都可以叫中间件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...in&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m2 ...in&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, m1, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...&quot;</span>)</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;响应数据&quot;</span>&#125;)</span><br><span class="line">  &#125;, m2)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">m1  ...in</span></span><br><span class="line"><span class="comment">index ...</span></span><br><span class="line"><span class="comment">m2  ...in</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="中间件拦截器"><a href="#中间件拦截器" class="headerlink" title="中间件拦截器"></a>中间件拦截器</h4><p>c.Abort()拦截，后续的HandlerFunc就不会执行了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...in&quot;</span>)</span><br><span class="line">  c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;第一个中间件拦截了&quot;</span>&#125;)</span><br><span class="line">  c.Abort()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m2 ...in&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, m1, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...&quot;</span>)</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;响应数据&quot;</span>&#125;)</span><br><span class="line">  &#125;, m2)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="中间件放行"><a href="#中间件放行" class="headerlink" title="中间件放行"></a>中间件放行</h4><p>c.Next()，Next前后形成了其他语言中的请求中间件和响应中间件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...in&quot;</span>)</span><br><span class="line">  c.Next()</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...out&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m2 ...in&quot;</span>)</span><br><span class="line">  c.Next()</span><br><span class="line">  fmt.Println(<span class="string">&quot;m2 ...out&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, m1, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...in&quot;</span>)</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;响应数据&quot;</span>&#125;)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...out&quot;</span>)</span><br><span class="line">  &#125;, m2)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">m1 ...in</span></span><br><span class="line"><span class="comment">index ...in</span></span><br><span class="line"><span class="comment">m2 ...in   </span></span><br><span class="line"><span class="comment">m2 ...out  </span></span><br><span class="line"><span class="comment">index ...out</span></span><br><span class="line"><span class="comment">m1 ...out</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>如果其中一个中间件响应了c.Abort()，后续中间件将不再执行，直接按照顺序走完所有的响应中间件</p><h4 id="全局注册中间件"><a href="#全局注册中间件" class="headerlink" title="全局注册中间件"></a>全局注册中间件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m10</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...in&quot;</span>)</span><br><span class="line">  c.Next()</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...out&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.Use(m10)</span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...in&quot;</span>)</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;index&quot;</span>&#125;)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...out&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用Use去注册全局中间件，Use接收的参数也是多个HandlerFunc</p><h4 id="中间件传递数据"><a href="#中间件传递数据" class="headerlink" title="中间件传递数据"></a>中间件传递数据</h4><p>使用Set设置一个key-value,</p><p>在后续中间件中使用Get接收数据</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m10</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...in&quot;</span>)</span><br><span class="line">  c.Set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Acknight&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.Use(m10)</span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...in&quot;</span>)</span><br><span class="line">    name, _ := c.Get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    fmt.Println(name)</span><br><span class="line">    </span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;index&quot;</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>value的类型是any类型，所有我们可以用它传任意类型，在接收的时候做好断言即可</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m10</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...in&quot;</span>)</span><br><span class="line">  c.Set(<span class="string">&quot;name&quot;</span>, User&#123;<span class="string">&quot;Acknight&quot;</span>, <span class="number">20</span>&#125;)</span><br><span class="line">  c.Next()</span><br><span class="line">  fmt.Println(<span class="string">&quot;m1 ...out&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.Use(m10)</span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index ...in&quot;</span>)</span><br><span class="line">    name, _ := c.Get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    user := name.(User)</span><br><span class="line">    fmt.Println(user.Name, user.Age)</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;index&quot;</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="路由分组"><a href="#路由分组" class="headerlink" title="路由分组"></a>路由分组</h4><p>将一系列的路由放到一个组下，统一管理</p><p>例如，以下的路由前面统一加上api的前缀</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  r := router.Group(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line">  r.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;index&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  r.GET(<span class="string">&quot;/home&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;home&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="路由分组注册中间件"><a href="#路由分组注册中间件" class="headerlink" title="路由分组注册中间件"></a>路由分组注册中间件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middle</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;middle ...in&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  r := router.Group(<span class="string">&quot;/api&quot;</span>).Use(middle)  <span class="comment">// 可以链式，也可以直接r.Use(middle)</span></span><br><span class="line">  r.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;index&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  r.GET(<span class="string">&quot;/home&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;home&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样写我们就可以指定哪一些分组下可以使用中间件了</p><p>当然，中间件还有一种写法，就是使用函数加括号的形式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middle</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;middle ...in&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middle1</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">  <span class="comment">// 这里的代码是程序一开始就会执行</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这里是请求来了才会执行</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;middle1 ...inin&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  r := router.Group(<span class="string">&quot;/api&quot;</span>).Use(middle, middle1())</span><br><span class="line">  r.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;index&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  r.GET(<span class="string">&quot;/home&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.String(<span class="number">200</span>, <span class="string">&quot;home&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="gin-Default"><a href="#gin-Default" class="headerlink" title="gin.Default"></a>gin.Default</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">()</span></span> *Engine &#123;</span><br><span class="line">  debugPrintWARNINGDefault()</span><br><span class="line">  engine := New()</span><br><span class="line">  engine.Use(Logger(), Recovery())</span><br><span class="line">  <span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gin.Default()默认使用了Logger和Recovery中间件，其中：</p><p>Logger中间件将日志写入gin.DefaultWriter，即使配置了GIN_MODE&#x3D;release。 Recovery中间件会recover任何panic。如果有panic的话，会写入500响应码。 如果不想使用上面两个默认的中间件，可以使用gin.New()新建一个没有任何默认中间件的路由。</p><p>使用gin.New，如果不指定日志，那么在控制台中就不会有日志显示</p><h4 id="中间件案例"><a href="#中间件案例" class="headerlink" title="中间件案例"></a>中间件案例</h4><h5 id="权限验证"><a href="#权限验证" class="headerlink" title="权限验证"></a>权限验证</h5><p>以前后端最流行的jwt为例，如果用户登录了，前端发来的每一次请求都会在请求头上携带上token</p><p>后台拿到这个token进行校验，验证是否过期，是否非法</p><p>如果通过就说明这个用户是登录过的</p><p>不通过就说明用户没有登录</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">JwtTokenMiddleware</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 获取请求头的token</span></span><br><span class="line">  token := c.GetHeader(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">  <span class="comment">// 调用jwt的验证函数</span></span><br><span class="line">  <span class="keyword">if</span> token == <span class="string">&quot;1234&quot;</span> &#123;</span><br><span class="line">    <span class="comment">// 验证通过</span></span><br><span class="line">    c.Next()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 验证不通过</span></span><br><span class="line">  c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;权限验证失败&quot;</span>&#125;)</span><br><span class="line">  c.Abort()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  api := router.Group(<span class="string">&quot;/api&quot;</span>)</span><br><span class="line"></span><br><span class="line">  apiUser := api.Group(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    apiUser.POST(<span class="string">&quot;login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">      c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;登录成功&quot;</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  apiHome := api.Group(<span class="string">&quot;system&quot;</span>).Use(JwtTokenMiddleware)</span><br><span class="line">  &#123;</span><br><span class="line">    apiHome.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">      c.String(<span class="number">200</span>, <span class="string">&quot;index&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    apiHome.GET(<span class="string">&quot;/home&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">      c.String(<span class="number">200</span>, <span class="string">&quot;home&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="耗时统计"><a href="#耗时统计" class="headerlink" title="耗时统计"></a>耗时统计</h5><p>统计每一个视图函数的执行时间</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TimeMiddleware</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">  startTime := time.Now()</span><br><span class="line">  c.Next()</span><br><span class="line">  since := time.Since(startTime)</span><br><span class="line">  <span class="comment">// 获取当前请求所对应的函数</span></span><br><span class="line">  f := c.HandlerName()</span><br><span class="line">  fmt.Printf(<span class="string">&quot;函数 %s 耗时 %d\n&quot;</span>, f, since)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>为什么要使用日志</p><ol><li>记录用户操作，猜测用户行为</li><li>记录bug</li></ol><h4 id="gin自带日志系统"><a href="#gin自带日志系统" class="headerlink" title="gin自带日志系统"></a>gin自带日志系统</h4><h5 id="输出日志到log文件"><a href="#输出日志到log文件" class="headerlink" title="输出日志到log文件"></a>输出日志到log文件</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">  <span class="string">&quot;io&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 输出到文件</span></span><br><span class="line">  f, _ := os.Create(<span class="string">&quot;gin.log&quot;</span>)</span><br><span class="line">  <span class="comment">//gin.DefaultWriter = io.MultiWriter(f)</span></span><br><span class="line">  <span class="comment">// 如果需要同时将日志写入文件和控制台，请使用以下代码。</span></span><br><span class="line">  gin.DefaultWriter = io.MultiWriter(f, os.Stdout)</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;/&quot;</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="定义路由格式"><a href="#定义路由格式" class="headerlink" title="定义路由格式"></a>定义路由格式</h5><p>启动gin，它会显示所有路由，默认格式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[GIN-debug] POST   /foo    --&gt; main.main.func1 (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] GET    /bar    --&gt; main.main.func2 (<span class="number">3</span> handlers)</span><br><span class="line">[GIN-debug] GET    /status --&gt; main.main.func3 (<span class="number">3</span> handlers)</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">gin.DebugPrintRouteFunc = <span class="function"><span class="keyword">func</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  httpMethod,</span></span></span><br><span class="line"><span class="params"><span class="function">  absolutePath,</span></span></span><br><span class="line"><span class="params"><span class="function">  handlerName <span class="type">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  nuHandlers <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  log.Printf(</span><br><span class="line">    <span class="string">&quot;[ acknight ] %v %v %v %v\n&quot;</span>,</span><br><span class="line">    httpMethod,</span><br><span class="line">    absolutePath,</span><br><span class="line">    handlerName,</span><br><span class="line">    nuHandlers,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*  输出如下</span></span><br><span class="line"><span class="comment">2022/12/11 14:10:28 [ acknight ] GET / main.main.func3 3</span></span><br><span class="line"><span class="comment">2022/12/11 14:10:28 [ acknight ] POST /index main.main.func4 3</span></span><br><span class="line"><span class="comment">2022/12/11 14:10:28 [ acknight ] PUT /haha main.main.func5 3</span></span><br><span class="line"><span class="comment">2022/12/11 14:10:28 [ acknight ] DELETE /home main.main.func6 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h5 id="查看路由"><a href="#查看路由" class="headerlink" title="查看路由"></a>查看路由</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.Routes()  <span class="comment">// 它会返回已注册的路由列表</span></span><br></pre></td></tr></table></figure><h5 id="环境切换"><a href="#环境切换" class="headerlink" title="环境切换"></a>环境切换</h5><p>如果不想看到这些debug日志，那么我们可以改为release模式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gin.SetMode(gin.ReleaseMode)</span><br><span class="line">router := gin.Default()</span><br></pre></td></tr></table></figure><h5 id="修改log的显示"><a href="#修改log的显示" class="headerlink" title="修改log的显示"></a>修改log的显示</h5><p>默认的是这样的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[GIN] <span class="number">2022</span>/<span class="number">12</span>/<span class="number">11</span> - <span class="number">14</span>:<span class="number">22</span>:<span class="number">00</span> | <span class="number">200</span> |  <span class="number">0</span>s |  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> | GET  <span class="string">&quot;/&quot;</span></span><br></pre></td></tr></table></figure><p>如果觉得不好看，我们可以自定义</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LoggerWithFormatter</span><span class="params">(params gin.LogFormatterParams)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fmt.Sprintf(</span><br><span class="line">    <span class="string">&quot;[ acknight ] %s  | %d | \t %s | %s | %s \t  %s\n&quot;</span>,</span><br><span class="line">    params.TimeStamp.Format(<span class="string">&quot;2006/01/02 - 15:04:05&quot;</span>),</span><br><span class="line">    params.StatusCode,  <span class="comment">// 状态码</span></span><br><span class="line">    params.ClientIP,  <span class="comment">// 客户端ip</span></span><br><span class="line">    params.Latency,  <span class="comment">// 请求耗时</span></span><br><span class="line">    params.Method,  <span class="comment">// 请求方法</span></span><br><span class="line">    params.Path,  <span class="comment">// 路径</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.New()</span><br><span class="line">  router.Use(gin.LoggerWithFormatter(LoggerWithFormatter))</span><br><span class="line">  router.Run()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也可以这样</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LoggerWithFormatter</span><span class="params">(params gin.LogFormatterParams)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fmt.Sprintf(</span><br><span class="line">    <span class="string">&quot;[ acknight ] %s  | %d | \t %s | %s | %s \t  %s\n&quot;</span>,</span><br><span class="line">    params.TimeStamp.Format(<span class="string">&quot;2006/01/02 - 15:04:05&quot;</span>),</span><br><span class="line">    params.StatusCode,</span><br><span class="line">    params.ClientIP,</span><br><span class="line">    params.Latency,</span><br><span class="line">    params.Method,</span><br><span class="line">    params.Path,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.New()</span><br><span class="line">  router.Use(</span><br><span class="line">    gin.LoggerWithConfig(</span><br><span class="line">      gin.LoggerConfig&#123;Formatter: LoggerWithFormatter&#125;,</span><br><span class="line">    ),</span><br><span class="line">  )</span><br><span class="line">  router.Run()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是你会发现自己这样输出之后，没有颜色了，不太好看，我们可以输出有颜色的log</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LoggerWithFormatter</span><span class="params">(params gin.LogFormatterParams)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> statusColor, methodColor, resetColor <span class="type">string</span></span><br><span class="line">  statusColor = params.StatusCodeColor()</span><br><span class="line">  methodColor = params.MethodColor()</span><br><span class="line">  resetColor = params.ResetColor()</span><br><span class="line">  <span class="keyword">return</span> fmt.Sprintf(</span><br><span class="line">    <span class="string">&quot;[ acknight ] %s  | %s %d  %s | \t %s | %s | %s %-7s %s \t  %s\n&quot;</span>,</span><br><span class="line">    params.TimeStamp.Format(<span class="string">&quot;2006/01/02 - 15:04:05&quot;</span>),</span><br><span class="line">    statusColor, params.StatusCode, resetColor,</span><br><span class="line">    params.ClientIP,</span><br><span class="line">    params.Latency,</span><br><span class="line">    methodColor, params.Method, resetColor,</span><br><span class="line">    params.Path,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golang基础学习</title>
      <link href="/2025/10/27/golang%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
      <url>/2025/10/27/golang%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="Golang代理"><a href="#Golang代理" class="headerlink" title="Golang代理"></a>Golang代理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">多行注释</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>快捷键 <code>ctrl + /</code></p><h3 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h3><p>go的字符串只能使用双引号，所以想在字符串中显示单引号，那么就得使用转义字符</p><p>如果想要输出 “hello world”</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">&quot;\&quot;hello world\&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>go支持反引号</p><p>反引号引起来的字符串就不支持转义</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">`&quot;Hello World&quot;`</span>)</span><br></pre></td></tr></table></figure><p>go中引号的区别</p><ol><li>双引号表示一个字符串，双引号内字符可以转义，比如：\n，\r</li><li>单引号只能用来包裹一个字节的ASCII码字符，比如：<code>var a int = &#39;中&#39;</code></li><li>反引号引起来的字符串就不支持转义</li></ol><h4 id="其他常用转义字符"><a href="#其他常用转义字符" class="headerlink" title="其他常用转义字符"></a>其他常用转义字符</h4><table><thead><tr><th>“</th><th>双引号</th></tr></thead><tbody><tr><td>\</td><td>反斜线</td></tr><tr><td>\a</td><td>报警声</td></tr><tr><td>\b</td><td>退格</td></tr><tr><td>\f</td><td>换页</td></tr><tr><td>\n</td><td>换行</td></tr><tr><td>\r</td><td>回车替换</td></tr><tr><td>\v</td><td>垂直制表符</td></tr><tr><td>\t</td><td>制表符</td></tr></tbody></table><h4 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h4><p>在使用fmt中的Println的时候，有没有发现除了这个函数，还有好几个函数</p><p>Print 函数直接输出内容</p><p>Printf 格式化输出字符串</p><p>Println 会在输出内容的结尾添加一个换行符</p><p>Printf和Println是用到最多的输出</p><p>其中Printf中的格式化字符串特别多，很多都是用不到的，所以重点讲几个</p><table><thead><tr><th>%v</th><th>按值的本来值输出</th></tr></thead><tbody><tr><td>%+v</td><td>在 %v 基础上，对结构体字段名和值进行展开</td></tr><tr><td>%#v</td><td>输出 Go 语言语法格式的值</td></tr><tr><td>%T</td><td>输出 Go 语言语法格式的类型和值</td></tr><tr><td>%%</td><td>输出 % 本体</td></tr><tr><td>%b（oOdxX）</td><td>整型的不同进制方式显示</td></tr><tr><td>%U</td><td>Unicode 字符</td></tr><tr><td>%s</td><td>字符串</td></tr><tr><td>%d</td><td>整数</td></tr><tr><td>%f</td><td>浮点数</td></tr><tr><td>%p</td><td>指针，十六进制方式显示</td></tr></tbody></table><h3 id="变量定义"><a href="#变量定义" class="headerlink" title="变量定义"></a>变量定义</h3><h4 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h4><p>在go中，声明变量就必须使用</p><p>对于int类型，它的默认值就是0</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 1.先声明，再赋值</span></span><br><span class="line"><span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">name = <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">fmt.Println(name)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明并赋值</span></span><br><span class="line"><span class="keyword">var</span> name1 <span class="type">string</span> = <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">fmt.Println(name1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 省略类型</span></span><br><span class="line"><span class="keyword">var</span> name2 = <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">fmt.Println(name2)</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明并赋值 短声明符号 :=</span></span><br><span class="line">name3 := <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">fmt.Println(name3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="批量声明"><a href="#批量声明" class="headerlink" title="批量声明"></a>批量声明</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">v1 <span class="type">int</span></span><br><span class="line">v2 <span class="type">int</span> = <span class="number">2</span></span><br><span class="line">v3     = <span class="number">3</span></span><br><span class="line">)</span><br><span class="line">fmt.Printf(<span class="string">&quot;v1=%v, v2=%v, v3=%v&quot;</span>, v1, v2, v3)</span><br></pre></td></tr></table></figure><h4 id="常量Constant"><a href="#常量Constant" class="headerlink" title="常量Constant"></a>常量Constant</h4><p>声明之后不能修改</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a <span class="type">int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">fmt.Println(a)</span><br></pre></td></tr></table></figure><h4 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h4><p>批量声明常量就可以使用iota</p><p>它可以实现常量的计数功能</p><p>iota就是当前变量的层数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a <span class="type">int</span> = <span class="literal">iota</span></span><br><span class="line">    b     = <span class="number">2</span></span><br><span class="line">    c     = <span class="literal">iota</span></span><br><span class="line">    d     = <span class="literal">iota</span></span><br><span class="line">    e     = <span class="number">1</span></span><br><span class="line">    f     = <span class="literal">iota</span></span><br><span class="line">)</span><br><span class="line">fmt.Println(a, b, c, d, e, f)</span><br><span class="line"><span class="comment">// 0 2 2 3 1 5</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    g = <span class="literal">iota</span></span><br><span class="line">    h = <span class="literal">iota</span></span><br><span class="line">)</span><br><span class="line">fmt.Println(g, h)</span><br><span class="line"><span class="comment">// 0 1</span></span><br></pre></td></tr></table></figure><h4 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h4><p>将变量声明放在函数之外</p><p>声明为全局变量之后，该变量可以不使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="全局挎包变量"><a href="#全局挎包变量" class="headerlink" title="全局挎包变量"></a>全局挎包变量</h4><p>在当前项目中创建一个version目录，在version目录中创建version.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> version</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  Version <span class="type">int</span>  = <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>在主程序中就可以引入该包进行使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;go_study/version&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(version.Version)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果要使用跨包变量，则需要将该变量名首字母大写</p><h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h3><p>Golang中所有的值类型变量常量都会在声明时被分配内存空间并赋予默认值</p><p>数字型 0</p><p>布尔型 false</p><p>字符串 “”</p><p>bit：比特位，二进制中的一位，信息的最小单位</p><p>byte：字节，1byte&#x3D;8bit，在Go中是uint8的别名</p><h4 id="整数型"><a href="#整数型" class="headerlink" title="整数型"></a>整数型</h4><p>int: 整数 integer</p><table><thead><tr><th>0</th><th>1</th><th>0</th><th>1</th><th>0</th><th>1</th></tr></thead></table><p>第一位用于存放正负</p><p>范围 -128 ~ 127</p><p>uint: 无符号整数 unsigned integer</p><table><thead><tr><th>1</th><th>1</th><th>0</th><th>1</th><th>0</th><th>1</th></tr></thead></table><p>范围：0~255</p><table><thead><tr><th>名称</th><th>长度</th><th>范围</th></tr></thead><tbody><tr><td>int8</td><td>8bit</td><td>-128 ~ 127</td></tr><tr><td>uint8</td><td>8bit</td><td>0 ~ 255</td></tr><tr><td>int16</td><td>16bit</td><td>-32768 ~ 32767</td></tr><tr><td>uint16</td><td>16bit</td><td>0 ~ 65536</td></tr><tr><td>int32</td><td>32bit</td><td></td></tr><tr><td>uint32</td><td>32bit</td><td></td></tr><tr><td>int64</td><td>64bit</td><td></td></tr><tr><td>uint64</td><td>64bit</td><td></td></tr><tr><td>int</td><td>32 &#x2F; 64bit</td><td></td></tr><tr><td>uint</td><td>32 &#x2F; 64bit</td><td></td></tr></tbody></table><p>int会根据操作系统自动来判断是int32或int64</p><p>decimal：十进制，无需前缀</p><p>binary: 二进制，前缀0b、0B</p><p>octal：八进制，前缀0o、0O</p><p>hexadecimal：十六进制，前缀0X、0x</p><h4 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h4><p>byte uint8的别名</p><p>rune uint32的别名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  c1 <span class="type">byte</span> = <span class="number">65</span></span><br><span class="line">  c2      = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">  c3 <span class="type">rune</span> = <span class="string">&#x27;中&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;c1 的码值=%v, 字符为：%c, 类型是%T\n&quot;</span>, c1, c1, c1)</span><br><span class="line">fmt.Printf(<span class="string">&quot;c2 的码值=%v, 字符为：%c, 类型是%T\n&quot;</span>, c2, c2, c2)</span><br><span class="line">fmt.Printf(<span class="string">&quot;c3 的码值=%v, 字符为：%c, 类型是%T\n&quot;</span>, c3, c3, c3)</span><br></pre></td></tr></table></figure><h4 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h4><p>bool true false</p><p>字符串型</p><p>string</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s <span class="type">string</span> = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;s=%v, type is %T&quot;</span>, s, s)CopyErrorOK!</span><br></pre></td></tr></table></figure><p>求字符串个数</p><p>len(str)</p><h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p><code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>，<code>%</code></p><p><code>++</code></p><p>没有次方 ^ 异或</p><p>go没有前++，只有<code>后++</code></p><h4 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b <span class="type">uint8</span> = <span class="number">0</span>b00111100</span><br><span class="line"></span><br><span class="line"><span class="comment">// 往右移两位</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;b&gt;&gt;2:%b\n&quot;</span>, b&gt;&gt;<span class="number">2</span>)</span><br><span class="line"><span class="comment">// 0b00001111</span></span><br><span class="line"><span class="comment">// 往左移两位</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;b&lt;&lt;2:%b\n&quot;</span>, b&lt;&lt;<span class="number">2</span>)</span><br><span class="line"><span class="comment">// 0b111100</span></span><br></pre></td></tr></table></figure><p><code>&amp;</code> 按位<code>与</code> 全1为1</p><p><code>|</code> 按位<code>或</code> 有1为1</p><p><code>^</code> 按位<code>异或</code> 相同为0 不同为1</p><h4 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h4><p>+&#x3D;</p><p>-&#x3D;</p><p>*&#x3D;</p><p>&#x2F;&#x3D;</p><p>…</p><h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;</span><br><span class="line">&gt;=</span><br><span class="line">&lt;</span><br><span class="line">&lt;=</span><br><span class="line">==</span><br><span class="line">!=</span><br></pre></td></tr></table></figure><h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;&amp;  与</span><br><span class="line">||  或</span><br><span class="line">!   非</span><br></pre></td></tr></table></figure><p>逻辑运算符只针对于布尔类型的数据值 或者表达式使用</p><h4 id="逻辑短路"><a href="#逻辑短路" class="headerlink" title="逻辑短路"></a>逻辑短路</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为0不能作为除数的特性 ，我们这里使用0来进行举证。</span></span><br><span class="line">a,b:=<span class="number">10</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> a&gt;<span class="number">0</span> || a/b&gt;<span class="number">0</span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个时候 || 左边为true 右边会报错 而或[||] 只要有一个为true即可满足条件<br>这个时候 我们是可以看到OK的输出的 而没有报错<br>如果改为a&lt;0 左边的判断条件为false 就会接着去执行右边的表达式 此时报错 而OK也无法输出<br>代码：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因为0不能作为除数的特性 ，我们这里使用0来进行举证。</span></span><br><span class="line">a,b:=<span class="number">10</span>,<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> a&gt;<span class="number">0</span> &amp;&amp; a/b&gt;<span class="number">0</span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同真为真 其余为假 根据这个特性 我们就可以推导 和上面的短路或 有一些相似<br>而他是在其中有一个是false的情况下 即我们得出左边的值是false 那么程序就会直接输出OK 不会报右边除于0的错误<br>上述举例中，a&gt;0为true 这种情况下 还会继续向右执行 这个时候是报错的</p><h4 id="地址运算符"><a href="#地址运算符" class="headerlink" title="地址运算符"></a>地址运算符</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&amp;  取地址</span><br><span class="line">*  取地址对应的值</span><br></pre></td></tr></table></figure><p>Golang中所有的值类型变量常量都会在声明时被分配内存空间并赋予默认值</p><p>数字型 0</p><p>布尔型 false</p><p>字符串 “”</p><p>bit：比特位，二进制中的一位，信息的最小单位</p><p>byte：字节，1byte&#x3D;8bit，在Go中是uint8的别名</p><h3 id="判断语句"><a href="#判断语句" class="headerlink" title="判断语句"></a>判断语句</h3><h4 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h4><p>和其他语言没什么区别</p><ol><li>条件不用加括号，加括号也不会报错</li><li>编码风格</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">&quot;请输入你的年龄&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age <span class="type">uint8</span></span><br><span class="line">fmt.Scanln(&amp;age)</span><br><span class="line"><span class="keyword">if</span> age &lt; <span class="number">13</span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;年龄小于13&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;年龄大于13&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是，<strong>if后面的左大括号，必须和if在同一行</strong></p><p>这种语法是不被编译通过的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age <span class="type">uint8</span> = <span class="number">12</span></span><br><span class="line"><span class="keyword">if</span> age &lt; <span class="number">13</span> </span><br><span class="line">&#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;年龄小于13&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="if-else-if"><a href="#if-else-if" class="headerlink" title="if else if"></a>if else if</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">&quot;请输入你的年龄&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age <span class="type">uint8</span></span><br><span class="line">fmt.Scanln(&amp;age)</span><br><span class="line"><span class="keyword">if</span> age &lt; <span class="number">13</span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;年龄小于13&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> age &lt; <span class="number">25</span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;年龄小于25&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;年龄大于25&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="if-简短语句"><a href="#if-简短语句" class="headerlink" title="if 简短语句"></a>if 简短语句</h4><p>在进行判断的之前，可以声明变量，用于接收函数返回值并判断</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i:=<span class="number">3</span>;i&gt;<span class="number">0</span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;大于0&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="switch-case"><a href="#switch-case" class="headerlink" title="switch case"></a>switch case</h4><p>可以直接将if else改写为switch case</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">&quot;请输入你的年龄&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> age <span class="type">uint8</span></span><br><span class="line">fmt.Scanln(&amp;age)</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> age &lt; <span class="number">13</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;年龄小于13&quot;</span>)</span><br><span class="line">    <span class="keyword">fallthrough</span></span><br><span class="line">  <span class="keyword">case</span> age &lt; <span class="number">25</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;年龄小于25&quot;</span>)</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;年龄大于25&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>fallthrough</code>是用于case穿透</p><p><code>break</code>是退出当前switch，默认每个case后都有break</p><p><strong>第二种用法</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(<span class="string">&quot;请输入星期（数字）&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> weekDay <span class="type">uint8</span></span><br><span class="line">fmt.Scanln(&amp;weekDay)</span><br><span class="line"><span class="keyword">switch</span> weekDay &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;酱油拌饭&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;蛋炒饭&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;阳春面&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">  fmt.Println(<span class="string">&quot;西北风&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="switch-case与if-else区别"><a href="#switch-case与if-else区别" class="headerlink" title="switch case与if else区别"></a>switch case与if else区别</h4><p>if else是多个条件选一个，只要成立了一个，后面的就都不会去匹配了</p><p>switch的每一个case是从上到下去匹配，如果没有break，则每一个都会去匹配</p><h3 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h3><h4 id="无线循环"><a href="#无线循环" class="headerlink" title="无线循环"></a>无线循环</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">  i++</span><br><span class="line">  <span class="keyword">if</span> i == <span class="number">10</span> &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="条件循环"><a href="#条件循环" class="headerlink" title="条件循环"></a>条件循环</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i &lt;= <span class="number">10</span> &#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">  i++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="标准循环"><a href="#标准循环" class="headerlink" title="标准循环"></a>标准循环</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意点：<strong>for语句后面的三个构成部分不能加括号，会报错</strong></p><h4 id="break"><a href="#break" class="headerlink" title="break"></a>break</h4><p>跳出当前循环</p><h4 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h4><p>结束本次循环</p><p>continue后面的代码就不会执行了</p><p>九九乘法表</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++ &#123;</span><br><span class="line">  <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= i; j++ &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%d * %d = %d  &quot;</span>, j, j, i*j)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="label和goto"><a href="#label和goto" class="headerlink" title="label和goto"></a>label和goto</h3><p>Go 语言中有 <code>goto</code> 这个功能，这个功能会影响代码的可读性， 会让代码结构看起来比较乱。</p><p>Go语言也支持label(标签)语法：分别是<code>break label</code>和 <code>goto label</code> 、<code>continue label</code></p><h4 id="break-1"><a href="#break-1" class="headerlink" title="break"></a>break</h4><p>break 一般用来跳出当前所在的循环， 但是我们有业务场景，需要使用到 跳出最外层循环怎么办？<code>break label</code> 跳出循环不再执行for循环里的代码。</p><p>label一般用于跳出多层循环</p><p><code>break</code>标签只能用于<code>for</code>循环，不能和<code>switch</code>使用，在其他语言里<code>switch</code>与<code>break</code>是搭档</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">label:</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">5</span>; j++ &#123;</span><br><span class="line">      <span class="keyword">if</span> i == <span class="number">8</span> &amp;&amp; j == <span class="number">4</span> &#123;</span><br><span class="line">        <span class="keyword">break</span> label</span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Print(<span class="string">&quot;+&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Print(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="continue-1"><a href="#continue-1" class="headerlink" title="continue"></a>continue</h4><p><code>continue label</code> 这个功能和 <code>break</code> 优点类似，区别在于  <code>break</code> 是强制终止， <code>continue</code> 是继续循环下一个迭代。</p><h4 id="goto"><a href="#goto" class="headerlink" title="goto"></a>goto</h4><p>goto 可以无条件的跳转执行的位置，但是<strong>不能跨函数</strong>，需要配合标签使用。</p><p><code>goto</code> 标签放上面，下面都可以的.</p><p>用goto实现循环</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">start:</span><br><span class="line">  fmt.Println(<span class="string">&quot;请输入你的名字:&quot;</span>)</span><br><span class="line"></span><br><span class="line">  fmt.Scanln(&amp;name)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> name != <span class="string">&quot;AcKnight&quot;</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;名字输入错误！&quot;</span>)</span><br><span class="line">    <span class="keyword">goto</span> start</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">&quot;名字输入正确！&quot;</span>)</span><br></pre></td></tr></table></figure><p>不建议使用，容易造成逻辑混乱</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">if</span> i := <span class="number">1</span>; i == <span class="number">1</span> &#123;</span><br><span class="line">    <span class="keyword">goto</span> four</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="number">2</span>)</span><br><span class="line">  fmt.Println(<span class="number">3</span>)</span><br><span class="line">four:</span><br><span class="line">  fmt.Println(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>标准的函数写法</p><p>参数 参数类型 返回的类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSum</span><span class="params">(n1 <span class="type">int</span>, n2 <span class="type">int</span>)</span></span> <span class="type">int</span>&#123;</span><br><span class="line">    sum := n1 + n2</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    res := getSum(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    fmt.Println(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实参：给函数实际传递的参数，例如上面的1，2</p><p>形参：形式上的参数，例如上面的n1和n2</p><h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>golang函数支持返回多个返回值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getRes</span><span class="params">(n1 <span class="type">int</span>, n2 <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">  sum := n1 + n2</span><br><span class="line">  difference := n1 - n2</span><br><span class="line">  <span class="keyword">return</span> sum, difference</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>两个及以上的返回值，上面类型要加括号</p><h4 id="返回值命名"><a href="#返回值命名" class="headerlink" title="返回值命名"></a>返回值命名</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getRes</span><span class="params">(n1, n2 <span class="type">int</span>)</span></span> (sum, difference <span class="type">int</span>) &#123;</span><br><span class="line">  sum = n1 + n2</span><br><span class="line">  difference = n1 - n2</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数也是一种数据类型"><a href="#函数也是一种数据类型" class="headerlink" title="函数也是一种数据类型"></a>函数也是一种数据类型</h4><p>函数不是变量，但他也存在与内存中，存在内存地址</p><p>函数名的本质就是一个指向其函数内存地址的指针常量</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getRes</span><span class="params">(n1, n2 <span class="type">int</span>)</span></span> (sum, difference <span class="type">int</span>) &#123;</span><br><span class="line">  sum = n1 + n2</span><br><span class="line">  difference = n1 - n2</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;getRes is %v, type is %T&quot;</span>, getRes, getRes)</span><br><span class="line">  <span class="comment">//getRes is 0x4aca00, type is func(int, int) (int, int)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以，我们也可以以声明变量的形式声明函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getRes = <span class="function"><span class="keyword">func</span><span class="params">(n1, n2 <span class="type">int</span>)</span></span> (sum, difference <span class="type">int</span>) &#123;</span><br><span class="line">  sum = n1 + n2</span><br><span class="line">  difference = n1 - n2</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">a, b := getRes(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">fmt.Println(a, b)</span><br></pre></td></tr></table></figure><p>getRes 对应的那个函数也叫匿名函数</p><h4 id="立即调用的匿名函数"><a href="#立即调用的匿名函数" class="headerlink" title="立即调用的匿名函数"></a>立即调用的匿名函数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a, b := <span class="function"><span class="keyword">func</span><span class="params">(n1, n2 <span class="type">int</span>)</span></span> (sum, difference <span class="type">int</span>) &#123;</span><br><span class="line">  sum = n1 + n2</span><br><span class="line">  difference = n1 - n2</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">fmt.Println(a, b)</span><br></pre></td></tr></table></figure><h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p>在弄懂什么是指针之前</p><p>先弄清楚什么是值传递，什么是引用传递</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(n <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  n++</span><br><span class="line">  fmt.Println(<span class="string">&quot;add函数结束时：&quot;</span>, n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2022</span></span><br><span class="line">  add(y)</span><br><span class="line">  fmt.Println(<span class="string">&quot;调用add函数之后：&quot;</span>, y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到函数调用结束之后，y的值还是2022</p><p>这就是说明函数传递默认是值传递</p><p>我们可以使用&amp;可以获取某个变量的内存地址</p><p>用*获取到内存地址所对应的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(n *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  *n++</span><br><span class="line">  fmt.Println(<span class="string">&quot;add函数结束时：&quot;</span>, n, *n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> y = <span class="number">2022</span></span><br><span class="line">  <span class="keyword">var</span> yy = &amp;y</span><br><span class="line">  add(yy)</span><br><span class="line">  fmt.Println(<span class="string">&quot;调用add函数之后：&quot;</span>, y, &amp;y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h3><ol><li>延迟执行的函数会被压入栈中，return后按照先进后出的顺序调用</li><li>延迟执行的函数其参数会立即求值</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferUtil</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  i := <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;本次调用接收到n=%v\n&quot;</span>, n)</span><br><span class="line">    i++</span><br><span class="line">    fmt.Printf(<span class="string">&quot;匿名工具函数第%v次被调用\n&quot;</span>, i)</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Defer</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  f := deferUtil()</span><br><span class="line">  <span class="comment">//f(1)</span></span><br><span class="line">  <span class="keyword">defer</span> f(<span class="number">1</span>)</span><br><span class="line">  <span class="comment">//defer f(f(3))</span></span><br><span class="line">  <span class="keyword">return</span> f(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  Defer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">本次调用接收到n=2</span><br><span class="line">匿名工具函数第1次被调用</span><br><span class="line">本次调用接收到n=1</span><br><span class="line">匿名工具函数第2次被调用</span><br></pre></td></tr></table></figure><p>可用于函数异常捕获</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Defer</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    err := <span class="built_in">recover</span>()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  n := <span class="number">0</span></span><br><span class="line">  fmt.Println(<span class="number">3</span> / n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  Defer()</span><br><span class="line">  fmt.Println(<span class="string">&quot;Defer函数之后运行&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runtime error: integer divide by zero</span><br><span class="line">Defer函数之后运行</span><br></pre></td></tr></table></figure><h3 id="init函数"><a href="#init函数" class="headerlink" title="init函数"></a>init函数</h3><ol><li>init函数可以在所有程序执行开始前被调用，并且每个包下可以有多个init函数</li><li>init函数先于main函数自动执行</li><li>每个包中可以有多个init函数，每个包中的源文件中也可以有多个init函数</li><li>init函数没有输入参数、返回值，也未声明，所以无法引用</li><li>不同包的init函数按照包导入的依赖关系决定执行顺序</li><li>无论包被导入多少次，init函数只会被调用一次，也就是只执行一次</li><li>init函数在代码中不能被显示的调用，不能被引用（赋值给函数变量），否则会出现编译错误</li><li>Go程序仅仅想要用一个package的init执行，我们可以这样使用：import _ “test_xxxx”，导入包的时候加上下划线就ok了</li><li>init函数不应该依赖任何在main函数里创建的变量，因为init函数的执行是在main函数之前的</li></ol><p><strong>执行顺序</strong></p><p>被依赖的全局变量&gt;&gt;被依赖包的init函数&gt;&gt;…&gt;&gt;main包的全局变量&gt;&gt;main的init函数&gt;&gt;main函数</p><p><strong>init函数可以做什么</strong></p><p>初始化操作</p><h3 id="包"><a href="#包" class="headerlink" title="包"></a>包</h3><p>注意点</p><ol><li>一个包就是一个目录，包名和目录名一致</li></ol><h4 id="包的导入"><a href="#包的导入" class="headerlink" title="包的导入"></a>包的导入</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;go_study/pkg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  pkg.Pkg()</span><br><span class="line">  fmt.Println(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;go_study/pkg&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  pkg.Pkg()</span><br><span class="line">  fmt.Println(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="起别名"><a href="#起别名" class="headerlink" title="起别名"></a>起别名</h4><p>如果有两个一样的包，那么在导入的时候就可以起一个别名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  pkg01 <span class="string">&quot;go_study/pkg&quot;</span></span><br><span class="line">  pkg02 <span class="string">&quot;go_study/pkg&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  pkg01.Pkg()</span><br><span class="line">  pkg02.Pkg()</span><br><span class="line">  fmt.Println(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="全部引入"><a href="#全部引入" class="headerlink" title="全部引入"></a>全部引入</h4><p>我们在使用包中的函数、变量的时候，通常都是包名点变量名这样，如果想直接使用变量名，那么需要将包中的内容全部导入</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  . <span class="string">&quot;go_study/pkg&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  Pkg()</span><br><span class="line">  fmt.Println(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是这样做会有一些问题，一般是不建议的</p><p>如果在当前包中，有重名的函数名或变量，则会编译失败</p><h4 id="下划线"><a href="#下划线" class="headerlink" title="下划线_"></a>下划线_</h4><p>引入某个包，但不直接使用包里的函数，而是调用该包里面的init函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  _ <span class="string">&quot;go_study/pkg&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr [<span class="number">3</span>]<span class="type">int</span> = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br></pre></td></tr></table></figure><p>长度不能为空</p><p>可以使用…自动推导数组的长度</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [...]<span class="type">int</span>&#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> arr1 [<span class="number">3</span>]<span class="type">int</span> = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br><span class="line">  <span class="keyword">var</span> arr2 = [...]<span class="type">int</span>&#123;<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 索引</span></span><br><span class="line">  fmt.Println(arr1[<span class="number">0</span>])</span><br><span class="line">  fmt.Println(arr1[<span class="number">1</span>])</span><br><span class="line">  fmt.Println(arr1[<span class="number">2</span>])</span><br><span class="line">  <span class="comment">//fmt.Println(arr1[3])  // 超过索引范围会编译错误</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改元素</span></span><br><span class="line">  arr2[<span class="number">0</span>] = <span class="number">11</span></span><br><span class="line">  arr2[<span class="number">2</span>] = <span class="number">9</span></span><br><span class="line">  fmt.Println(arr2)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(arr2); i++ &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;arr2[%v]=%v\n&quot;</span>, i, arr2[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 第二种遍历</span></span><br><span class="line">  <span class="keyword">for</span> index, value := <span class="keyword">range</span> arr2 &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;arr2 index=%v, value=%v\n&quot;</span>, index, value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>二维数组</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t [<span class="number">3</span>][<span class="number">4</span>]<span class="type">int</span> = [<span class="number">3</span>][<span class="number">4</span>]<span class="type">int</span>&#123;</span><br><span class="line">    &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;,</span><br><span class="line">    &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;,</span><br><span class="line">    &#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">fmt.Println(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> t &#123;</span><br><span class="line">  <span class="keyword">for</span> i2, v2 := <span class="keyword">range</span> v &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;a[%v][%v]=%v\t&quot;</span>, i, i2, v2)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p>使用数组的时候，会不会觉得数组不太灵活</p><p>所以golang为我们提供了一种切片</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"><span class="keyword">var</span> slice = arr[<span class="number">0</span>:<span class="number">5</span>] <span class="comment">// 切片的两边也是顾头不顾尾</span></span><br><span class="line">fmt.Println(slice)</span><br></pre></td></tr></table></figure><p>array[开始引用的index : 结束引用的index+1]</p><p>这里的slice是从arr中切片切出来的</p><p>：两边是顾头不顾尾（前闭后开）</p><p>左边不写默认是0</p><p>右边不写默认是最后一个</p><h4 id="切片不是对数组的引用"><a href="#切片不是对数组的引用" class="headerlink" title="切片不是对数组的引用"></a>切片不是对数组的引用</h4><p>如果改变切片中的元素，对应的数组也会变化</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"><span class="keyword">var</span> slice = arr[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">slice[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">fmt.Println(arr)</span><br></pre></td></tr></table></figure><h4 id="指向切片的切片"><a href="#指向切片的切片" class="headerlink" title="指向切片的切片"></a>指向切片的切片</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;</span><br><span class="line"><span class="keyword">var</span> slice = arr[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> s1 = slice[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">slice[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">fmt.Println(s1)</span><br><span class="line">fmt.Println(slice)</span><br><span class="line">fmt.Println(arr)</span><br></pre></td></tr></table></figure><p>切片是引用类型，默认值为nil</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s []<span class="type">int</span></span><br><span class="line">fmt.Println(s == <span class="literal">nil</span>)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>遍历方式同数组</p><h4 id="分配内存空间"><a href="#分配内存空间" class="headerlink" title="分配内存空间"></a>分配内存空间</h4><p>使用make</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s []<span class="type">int</span></span><br><span class="line">s = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">3</span>, <span class="number">5</span>) <span class="comment">// 创建一个长度为3， 容量为5的空间</span></span><br><span class="line">fmt.Println(s)        <span class="comment">// [0 0 0]</span></span><br></pre></td></tr></table></figure><p>容量不写，默认等于长度</p><p>查看长度和容量</p><p>len</p><p>cap</p><p>由系统自动创建底层数组</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s := []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure><p>追加元素</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1 := []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">s = <span class="built_in">append</span>(s1, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>) <span class="comment">// 底层创建了新的数组，不在应用原数组</span></span><br></pre></td></tr></table></figure><p>复制数组</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复制</span></span><br><span class="line"><span class="keyword">var</span> s1 = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line"><span class="built_in">copy</span>(s1, s)  <span class="comment">// 将s复制到s1，复制的个数就是s1的容量大小</span></span><br><span class="line">fmt.Println(s1)</span><br></pre></td></tr></table></figure><p>string与 []byte</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str := <span class="string">&quot;hello 世界&quot;</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;[]byte(str)=%s\n&quot;</span>, []<span class="type">byte</span>(str))</span><br><span class="line">fmt.Printf(<span class="string">&quot;[]byte(str)=%v\n&quot;</span>, []<span class="type">byte</span>(str))</span><br><span class="line"><span class="comment">// 汉字被分成了三个数字</span></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> str&#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;str[%d]=%c\n&quot;</span>, i, v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数参数接收多个值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(numList ...<span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  sum := <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> _, v := <span class="keyword">range</span> numList &#123;</span><br><span class="line">    sum += v</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  sum := Sum(<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">  fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>map是key-value形式</p><p>它的key只能是基本数据类型</p><h4 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h4><p>定义并创建</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义map</span></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span></span><br><span class="line"><span class="comment">// 创建空间</span></span><br><span class="line">m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>, <span class="number">2</span>) <span class="comment">// size可以不写，默认为1</span></span><br><span class="line"></span><br><span class="line">m[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;张三&quot;</span></span><br><span class="line">m[<span class="string">&quot;age&quot;</span>] = <span class="string">&quot;21&quot;</span></span><br><span class="line">m[<span class="string">&quot;addr&quot;</span>] = <span class="string">&quot;湖南长沙&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(m)</span><br></pre></td></tr></table></figure><p>简写</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m2 := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: <span class="string">&quot;12&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="增加"><a href="#增加" class="headerlink" title="增加"></a>增加</h4><p>通过map[key] &#x3D; xxx</p><h4 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h4><p>通过双赋值检测某个key是否存在</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">v, ok := m2[<span class="string">&quot;name&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line">   <span class="comment">// 如果存在，ok就为true</span></span><br><span class="line">   fmt.Printf(<span class="string">&quot;v = %v&quot;</span>, v)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;v不存在&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delete</span>(<span class="keyword">map</span>, key) <span class="comment">// 删除单个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除所有的key-value</span></span><br><span class="line"><span class="comment">// 重新make</span></span><br></pre></td></tr></table></figure><h4 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h4><p>map只有len，没有cap</p><p>len一个map，得到的就是key的个数</p><p>只有for range一种遍历方式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> m&#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;key=%v,value=%v\n&quot;</span>, key, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="切片中的类型为map类型"><a href="#切片中的类型为map类型" class="headerlink" title="切片中的类型为map类型"></a>切片中的类型为map类型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mapSlice = <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> index, value := <span class="keyword">range</span> mapSlice &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;index:%d value:%v\n&quot;</span>, index, value)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;初始化元素：&quot;</span>)</span><br><span class="line"><span class="comment">// 对切片中的map元素进行初始化</span></span><br><span class="line">mapSlice[<span class="number">0</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line">mapSlice[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;小明&quot;</span></span><br><span class="line">mapSlice[<span class="number">0</span>][<span class="string">&quot;gender&quot;</span>] = <span class="string">&quot;男&quot;</span></span><br><span class="line">mapSlice[<span class="number">0</span>][<span class="string">&quot;address&quot;</span>] = <span class="string">&quot;长沙&quot;</span></span><br><span class="line"><span class="keyword">for</span> index, value := <span class="keyword">range</span> mapSlice &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;index:%d value:%v\n&quot;</span>, index, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="map中的值为切片类型"><a href="#map中的值为切片类型" class="headerlink" title="map中的值为切片类型"></a>map中的值为切片类型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span><br><span class="line">fmt.Println(m)</span><br><span class="line">val := []<span class="type">string</span>&#123;<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;上海&quot;</span>&#125;</span><br><span class="line">m[<span class="string">&quot;中国&quot;</span>] = val</span><br><span class="line">fmt.Println(m)</span><br><span class="line">m[<span class="string">&quot;中国&quot;</span>] = <span class="built_in">append</span>(m[<span class="string">&quot;中国&quot;</span>], <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;深圳&quot;</span>)</span><br><span class="line">fmt.Println(m)</span><br></pre></td></tr></table></figure><h3 id="自定义数据类型"><a href="#自定义数据类型" class="headerlink" title="自定义数据类型"></a>自定义数据类型</h3><p>假如我想用4位数字表示消息的类型</p><p>也用4为数字表示异常的返回值</p><p>如果用uint16来表示，就容易搞混</p><p>所以就可以自定义一个数据类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> msgType <span class="type">uint16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textMes msgType = <span class="number">1000</span></span><br><span class="line"><span class="comment">// 混用需要类型转换</span></span><br><span class="line"><span class="keyword">var</span> u1001 <span class="type">uint16</span> = <span class="number">1001</span></span><br><span class="line"><span class="keyword">var</span> imageMes msgType = msgType(u1001)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;textMes=%v, type of is %T\n&quot;</span>, textMes, textMes)</span><br><span class="line">fmt.Printf(<span class="string">&quot;imageMes =%v, type of is %T\n&quot;</span>, imageMes, imageMes )</span><br></pre></td></tr></table></figure><p>这个msgType 已经和uint16是属于不同的类型了</p><p>如果需要将uint16的变量赋值给msgType 的变量，则需要进行类型转换</p><h4 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h4><p>byte是uint8的别名</p><p>rune是int32的别名</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> msgType = <span class="type">uint16</span></span><br><span class="line"><span class="keyword">var</span> textMes msgType = <span class="number">1000</span></span><br><span class="line"><span class="comment">// 混用需要类型转换</span></span><br><span class="line"><span class="keyword">var</span> u1001 <span class="type">uint16</span> = <span class="number">1001</span></span><br><span class="line"><span class="keyword">var</span> imageMes msgType = u1001</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;textMes=%v, type of is %T\n&quot;</span>, textMes, textMes)</span><br><span class="line">fmt.Printf(<span class="string">&quot;imageMes =%v, type of is %T\n&quot;</span>, imageMes, imageMes)</span><br></pre></td></tr></table></figure><p>类型别名就相当于是将uint16起了一个别的名字</p><p>赋值的时候也不用类型转换</p><h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>由一组字段构成的一种自定义数据类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Id <span class="type">uint32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> u1 User = User&#123;</span><br><span class="line">  Name: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">u1.Id = <span class="number">10000</span></span><br></pre></td></tr></table></figure><h4 id="结构体字段"><a href="#结构体字段" class="headerlink" title="结构体字段"></a>结构体字段</h4><p>结构体可以没有字段</p><p>结构体字段通过<code>.</code>访问</p><h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name     <span class="type">string</span></span><br><span class="line">  Age      <span class="type">int</span></span><br><span class="line">  password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Account <span class="keyword">struct</span> &#123;</span><br><span class="line">  User</span><br><span class="line">  money <span class="type">float32</span></span><br><span class="line">  Name  <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> ac Account = Account&#123;</span><br><span class="line">    money: <span class="number">21.9</span>,</span><br><span class="line">    User: User&#123;</span><br><span class="line">      Name:     <span class="string">&quot;王五&quot;</span>,</span><br><span class="line">      Age:      <span class="number">21</span>,</span><br><span class="line">      password: <span class="string">&quot;978345&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    Name: <span class="string">&quot;账户1&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;ac %#v, %T\n&quot;</span>, ac, ac)</span><br><span class="line">  <span class="keyword">var</span> u1 = User&#123;</span><br><span class="line">    Name:     <span class="string">&quot;lisa&quot;</span>,</span><br><span class="line">    Age:      <span class="number">22</span>,</span><br><span class="line">    password: <span class="string">&quot;1233fg&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> ac1 Account = Account&#123;</span><br><span class="line">    money: <span class="number">21.9</span>,</span><br><span class="line">    User:  u1,</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;ac1 %#v, %T\n&quot;</span>, ac1, ac1)</span><br><span class="line"></span><br><span class="line">  fmt.Println(ac.money)</span><br><span class="line">  fmt.Println(ac.Name)</span><br><span class="line">  fmt.Println(ac.User.Name)</span><br><span class="line">  fmt.Println(ac.password)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name     <span class="type">string</span></span><br><span class="line">  Age      <span class="type">int</span></span><br><span class="line">  password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span></span> PrintName() <span class="type">string</span> &#123;</span><br><span class="line">  u.Name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">  fmt.Println(<span class="string">&quot;printName方法： &quot;</span>, u)</span><br><span class="line">  fmt.Printf(<span class="string">&quot;printName方法内部：%p \n&quot;</span>, &amp;u)</span><br><span class="line">  <span class="keyword">return</span> u.Name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  user := User&#123;<span class="string">&quot;王二麻子&quot;</span>, <span class="number">23</span>, <span class="string">&quot;xsdfe23&quot;</span>&#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;main: %p\n&quot;</span>, &amp;user)</span><br><span class="line">  name := user.PrintName() <span class="comment">// 是值传递，</span></span><br><span class="line">  fmt.Println(name, user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结构体指针"><a href="#结构体指针" class="headerlink" title="结构体指针"></a>结构体指针</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Id   <span class="type">uint16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> u User = User&#123;</span><br><span class="line">  Name: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">u.Id = <span class="number">20</span></span><br><span class="line">fmt.Println(u)</span><br><span class="line"><span class="keyword">var</span> u2 *User = &amp;User&#123;</span><br><span class="line">  Name: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">u2.Id = <span class="number">21</span></span><br><span class="line">fmt.Println(u2)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;u = %+v, type of %T\n&quot;</span>, u, u)</span><br><span class="line">fmt.Printf(<span class="string">&quot;u2 = %+v, type of %T\n&quot;</span>, u2, u2)</span><br></pre></td></tr></table></figure><h4 id="结构体指针继承"><a href="#结构体指针继承" class="headerlink" title="结构体指针继承"></a>结构体指针继承</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Id   <span class="type">uint16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Account <span class="keyword">struct</span> &#123;</span><br><span class="line">  User</span><br><span class="line">  password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Contact <span class="keyword">struct</span> &#123;</span><br><span class="line">  *User</span><br><span class="line">  Remark <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化账户</span></span><br><span class="line"><span class="keyword">var</span> a1 = Account&#123;</span><br><span class="line">  User: User&#123;</span><br><span class="line">    Name: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    Id:   <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  password: <span class="string">&quot;666&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> c1 *Contact = &amp;Contact&#123;</span><br><span class="line">  User:   &amp;a1.User,</span><br><span class="line">  Remark: <span class="string">&quot;王麻子&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 没有重复字段就可以这样简写</span></span><br><span class="line">c1.Name = <span class="string">&quot;王五&quot;</span> <span class="comment">// 等效于  c1.User.Name = &quot;王五&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;a1 = %+v\n&quot;</span>, a1)</span><br><span class="line">fmt.Printf(<span class="string">&quot;c1 = %+v\n&quot;</span>, c1)</span><br></pre></td></tr></table></figure><h4 id="结构体标签"><a href="#结构体标签" class="headerlink" title="结构体标签"></a>结构体标签</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">  Id   <span class="type">uint16</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样写好之后，结构体进行json转换的时候，Name就会自动变为name</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Article <span class="keyword">struct</span> &#123;</span><br><span class="line">  Title     <span class="type">string</span> <span class="string">`json:&quot;title&quot;`</span></span><br><span class="line">  Desc      <span class="type">string</span> <span class="string">`json:&quot;desc&quot;`</span></span><br><span class="line">  Content   <span class="type">string</span> <span class="string">`json:&quot;content&quot;`</span></span><br><span class="line">  Username  <span class="type">string</span> <span class="string">`json:&quot;-&quot;`</span> <span class="comment">// - 也不参与序列化</span></span><br><span class="line">  LookCount <span class="type">int</span>    <span class="string">`json:&quot;look_count&quot;`</span></span><br><span class="line">  Free      <span class="type">bool</span>   <span class="string">`json:&quot;free&quot;`</span></span><br><span class="line">  password  <span class="type">string</span> <span class="comment">// 小写字母开头的不会参与序列化</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  article := Article&#123;</span><br><span class="line">    Title:     <span class="string">&quot;golang文档&quot;</span>,</span><br><span class="line">    Desc:      <span class="string">&quot;golang零基础入门，四小时转岗golang开发&quot;</span>,</span><br><span class="line">    Content:   <span class="string">&quot;golang零基础入门，四小时转岗golang开发&quot;</span>,</span><br><span class="line">    Username:  <span class="string">&quot;AcKnight&quot;</span>,</span><br><span class="line">    LookCount: <span class="number">1024</span>,</span><br><span class="line">    password:  <span class="string">&quot;ksd8%38&quot;</span>,</span><br><span class="line">    Free:      <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 结构体转json</span></span><br><span class="line">  jsonData, err := json.Marshal(article)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  jsonStr := <span class="type">string</span>(jsonData)</span><br><span class="line">  fmt.Println(jsonStr)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们都知道golang的函数都是值传递</p><p>所以如果在方法中修改结构体的值</p><p>相当于修改的是结构体的副本</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">  Id   <span class="type">uint16</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span></span> SetName(name <span class="type">string</span>) &#123;</span><br><span class="line">  u.Name = name</span><br><span class="line">  fmt.Printf(<span class="string">&quot;setName修改之后：u=%+v\n&quot;</span>, u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  u := User&#123;</span><br><span class="line">    Name: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    Id:   <span class="number">1001</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  u.SetName(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">  fmt.Printf(<span class="string">&quot;setName运行完之后，u=%+v\n&quot;</span>, u)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果需要修改原结构体，那么需要传递的是结构体的指针</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">  Id   <span class="type">uint16</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span></span> SetName(name <span class="type">string</span>) &#123;</span><br><span class="line">  (*u).Name = name</span><br><span class="line">  <span class="comment">// 也可这样简写</span></span><br><span class="line">  <span class="comment">//u.Name = name</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;setName修改之后：u=%+v\n&quot;</span>, *u)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  u := User&#123;</span><br><span class="line">    Name: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    Id:   <span class="number">1001</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  u.SetName(<span class="string">&quot;李四&quot;</span>)</span><br><span class="line">  fmt.Printf(<span class="string">&quot;setName运行完之后，u=%+v\n&quot;</span>, u)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>特殊的数据类型</p><p>方法定义的合集</p><p>方法名(形参类型)返回值类型</p><p>提高代码的复用率</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Animal 定义一个animal的接口，它有唱，跳，rap的方法</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">  sing()</span><br><span class="line">  jump()</span><br><span class="line">  rap()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Chicken 需要全部实现这些接口</span></span><br><span class="line"><span class="keyword">type</span> Chicken <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Chicken)</span></span> sing() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;chicken 唱&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Chicken)</span></span> jump() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;chicken 跳&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Chicken)</span></span> rap() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;chicken rap&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全部实现完之后，chicken就不再是一只普通的鸡了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> animal Animal</span><br><span class="line"></span><br><span class="line">  animal = Chicken&#123;<span class="string">&quot;ik&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">  animal.sing()</span><br><span class="line">  animal.jump()</span><br><span class="line">  animal.rap()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接口本身不能绑定方法</p><p>接口是值类型，保存的是：值+原始类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Animal 定义一个animal的接口，它有唱，跳，rap的方法</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span> &#123;</span><br><span class="line">  sing()</span><br><span class="line">  jump()</span><br><span class="line">  rap()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Chicken 需要全部实现这些接口</span></span><br><span class="line"><span class="keyword">type</span> Chicken <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Chicken)</span></span> sing() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;chicken 唱&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Chicken)</span></span> jump() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;chicken 跳&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Chicken)</span></span> rap() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;chicken rap&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cat 需要全部实现这些接口</span></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> sing() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;cat 唱&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> jump() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;cat 跳&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cat)</span></span> rap() &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;cat rap&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sing</span><span class="params">(obj Animal)</span></span> &#123;</span><br><span class="line">  obj.sing()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全部实现完之后，chicken就不再是一只普通的鸡了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  chicken := Chicken&#123;<span class="string">&quot;ik&quot;</span>&#125;</span><br><span class="line">  cat := Cat&#123;<span class="string">&quot;阿狸&quot;</span>&#125;</span><br><span class="line">  sing(chicken)</span><br><span class="line">  sing(cat)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现接口：</p><p>一个类型实现了接口的所有方法</p><p>即实现了该接口</p><h4 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h4><p>还原为原始类型 interface.(Type)</p><p>如果接口没有保存类型，则会报错</p><p>可返回两个值</p><p>value,ok :&#x3D; interface.(Type)</p><h4 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h4><p>interface{}</p><p>空接口可以保存任何类型</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> data <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Print</span><span class="params">(d data)</span></span> &#123;</span><br><span class="line">  fmt.Println(d)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  d := Dog&#123;<span class="string">&quot;小黑&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">  Print(d)</span><br><span class="line"></span><br><span class="line">  Print(<span class="number">12</span>)</span><br><span class="line">  Print(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">  Print(<span class="literal">true</span>)</span><br><span class="line">  Print([]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">  Print(<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="nil问题"><a href="#nil问题" class="headerlink" title="nil问题"></a>nil问题</h4><p>nil值：有类型没有值，接口本身并不是nil，可以处理</p><p>nil接口：既没有报错值，也没有保存类型，使用时会报错</p><h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>Goroutine是Go运行时管理的轻量级线程</p><p>主线程结束时，协程会被中断，需要有效的阻塞机制</p><h4 id="协程的使用"><a href="#协程的使用" class="headerlink" title="协程的使用"></a>协程的使用</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SendCode 发送验证码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendCode</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;发送验证码开始&quot;</span>)</span><br><span class="line">  time.Sleep(<span class="number">3</span> * time.Second)</span><br><span class="line">  fmt.Println(<span class="string">&quot;发送验证码完成！&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 实现用户注册功能</span></span><br><span class="line">  fmt.Println(<span class="string">&quot;用户注册校验完成&quot;</span>)</span><br><span class="line">  <span class="comment">// 发送验证码</span></span><br><span class="line">  <span class="comment">//SendCode() // 会阻塞主线程</span></span><br><span class="line">  <span class="keyword">go</span> SendCode() <span class="comment">// 会阻塞主线程</span></span><br><span class="line">  fmt.Println(<span class="string">&quot;验证码已发送，请注意查收...&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>问题：</p><ol><li>主线程结束，协程也会结束</li><li>协程安全</li><li>如何获取协程函数的返回值，如何在协程中传递数据？</li></ol><h4 id="WaitGroup"><a href="#WaitGroup" class="headerlink" title="WaitGroup"></a>WaitGroup</h4><p>前面我们通过让主程序延时的方式，可以成功让协程函数顺利结束</p><p>但是，延时多久没人能够知道</p><p>所以，睡眠这种方式肯定不靠谱</p><p>go 自带一个WaitGroup可以解决这个问题, 代码如下</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">say</span><span class="params">(s <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="built_in">println</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">go</span> say(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    <span class="keyword">go</span> say(<span class="string">&quot;World&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>wg.add(2)是有2个goroutine需要执行</p><p>wg.Done 相当于 wg.Add(-1) 意思就是我这个协程执行完了。wg.Wait() 就是告诉主线程要等一下，等他们2个都执行完再退出</p><h4 id="协程安全"><a href="#协程安全" class="headerlink" title="协程安全"></a>协程安全</h4><p>非常经典的例子，两个协程函数，分别对同一个全局变量进行操作</p><p>按照我们预期的结果，应该是200万，但是多运行几次，会发现结果各不相同</p><p>这就是协程安全问题</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> w = sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddNum</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    num++</span><br><span class="line">  &#125;</span><br><span class="line">  w.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  w.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> AddNum()</span><br><span class="line">  <span class="keyword">go</span> AddNum()</span><br><span class="line">  w.Wait()</span><br><span class="line">  fmt.Println(num)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种情况我们可以通过加锁进行解决，go语言中给我们通过了这个方法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lock = sync.Mutex&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> w = sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddNum</span><span class="params">()</span></span> &#123;</span><br><span class="line">  lock.Lock()  <span class="comment">// 上锁</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    num++</span><br><span class="line">  &#125;</span><br><span class="line">  lock.Unlock() <span class="comment">// 解锁</span></span><br><span class="line">  w.Done() </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  w.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> AddNum()</span><br><span class="line">  <span class="keyword">go</span> AddNum()</span><br><span class="line">  w.Wait()</span><br><span class="line">  fmt.Println(num)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="信道-channel"><a href="#信道-channel" class="headerlink" title="信道 channel"></a>信道 channel</h3><h4 id="声明和存取"><a href="#声明和存取" class="headerlink" title="声明和存取"></a>声明和存取</h4><p>channel，是一种带有类型的管道引用类型</p><p>使用前需要make(Type, (缓冲容量))</p><p>不带缓冲区的管道必须结合协程使用</p><p>可以查看长度len和容量cap</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 声明一个string信道，容量为2</span></span><br><span class="line">  <span class="keyword">var</span> ch <span class="keyword">chan</span> <span class="type">string</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  ch &lt;- <span class="string">&quot;AcKnight&quot;</span> <span class="comment">// 写入数据到信道中</span></span><br><span class="line">  ch &lt;- <span class="string">&quot;知道&quot;</span></span><br><span class="line"></span><br><span class="line">  s := &lt;-ch <span class="comment">// 从信道读取数据</span></span><br><span class="line">  fmt.Println(s)</span><br><span class="line">  ss, ok := &lt;-ch</span><br><span class="line">  fmt.Println(ss, ok)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">close</span>(ch)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">存入：channel &lt;- value</span><br><span class="line">取出：value, (ok) &lt;- channel</span><br><span class="line">丢弃：&lt;- channel</span><br><span class="line">先进先出，自动阻塞</span><br><span class="line">数据需要保持流动，否则会阻死报错</span><br></pre></td></tr></table></figure><p>搭配协程使用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pushNum</span><span class="params">(c <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">    c &lt;- i</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">close</span>(c) <span class="comment">// 写完必须要关闭，不然会死锁</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> c1 <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>) <span class="comment">// 2表示缓冲区大小</span></span><br><span class="line">  <span class="keyword">go</span> pushNum(c1)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> value := <span class="keyword">range</span> c1 &#123;</span><br><span class="line">    fmt.Println(value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多个协程函数，close就不能写在协程函数里了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ch <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pushNum</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    ch &lt;- i</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> pushNum()</span><br><span class="line">  <span class="keyword">go</span> pushNum()</span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="built_in">close</span>(ch)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    res, ok := &lt;-ch</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(res)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><p>使用close之后就不能在继续写入了，但是还可以继续从缓冲区读取</p><ol><li>close之后，读取的chan是数据类型的默认值</li><li>close之后，不能再往chan里面写入数据</li><li>for range之前必须要close</li></ol><h4 id="可读可写"><a href="#可读可写" class="headerlink" title="可读可写"></a>可读可写</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> ch <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="comment">// 可读chan</span></span><br><span class="line">  <span class="keyword">var</span> readCh &lt;-<span class="keyword">chan</span> <span class="type">int</span> = ch</span><br><span class="line">  <span class="comment">// 可写chan</span></span><br><span class="line">  <span class="keyword">var</span> writeCh <span class="keyword">chan</span>&lt;- <span class="type">int</span> = ch</span><br><span class="line"></span><br><span class="line">  writeCh &lt;- <span class="number">1</span></span><br><span class="line">  writeCh &lt;- <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  fmt.Println(&lt;-readCh)</span><br><span class="line">  fmt.Println(&lt;-readCh)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="select…case"><a href="#select…case" class="headerlink" title="select…case"></a>select…case</h4><p>适用于无法确认合适关闭信道的情况</p><p>通常结合for循环使用</p><p>select … case会阻塞到某个分支可以继续执行时执行该分支，当没有可执行的分支是执行default分支</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> ch1 <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">var</span> ch2 <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">var</span> ch3 <span class="keyword">chan</span> <span class="type">int</span> = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">  ch1 &lt;- <span class="number">1</span></span><br><span class="line">  ch2 &lt;- <span class="number">2</span></span><br><span class="line">  ch3 &lt;- <span class="number">3</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">select</span> &#123;</span><br><span class="line">  <span class="comment">// 监听多个chan的情况，是随机执行</span></span><br><span class="line">  <span class="keyword">case</span> v := &lt;-ch1:</span><br><span class="line">    fmt.Println(v)</span><br><span class="line">  <span class="keyword">case</span> v := &lt;-ch2:</span><br><span class="line">    fmt.Println(v)</span><br><span class="line">  <span class="keyword">case</span> v := &lt;-ch3:</span><br><span class="line">    fmt.Println(v)</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">&quot;没有数据&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrimeNum</span><span class="params">(n <span class="type">int</span>, c <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">2</span>; i &lt; n; i++ &#123;</span><br><span class="line">    <span class="keyword">if</span> n%i == <span class="number">0</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  c &lt;- n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">2</span>; i &lt; <span class="number">100001</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> PrimeNum(i, c)</span><br><span class="line">  &#125;</span><br><span class="line">Print:</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> v := &lt;-c:</span><br><span class="line">      fmt.Printf(<span class="string">&quot;%v\t&quot;</span>, v)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Printf(<span class="string">&quot;所有素数都已被找到&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span> Print</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="线程安全与sync-Map"><a href="#线程安全与sync-Map" class="headerlink" title="线程安全与sync.Map"></a>线程安全与sync.Map</h3><h4 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h4><p>什么是线程安全？</p><p>现在有两个协程，同时触发，一个协程对一个全局变量进行100完成++操作，另一个对全局变量—的操作</p><p>那么，两个协程结束，最后的值应该是0才对</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    num++</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reduce</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    num--</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wait.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> add()</span><br><span class="line">  <span class="keyword">go</span> reduce()</span><br><span class="line">  wait.Wait()</span><br><span class="line">  fmt.Println(num)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是你会发现，这个输出的结果完全无法预测</p><p>这是为什么呢？</p><blockquote><p>根本原因是CPU的调度方法为抢占式执行，随机调度</p></blockquote><h4 id="同步锁"><a href="#同步锁" class="headerlink" title="同步锁"></a>同步锁</h4><p>那么我们能不能通过给操作加锁来解决这个问题呢</p><p>答案是可以的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> wait  sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> lock  sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 谁先抢到了这把锁，谁就把它锁上，一旦锁上，其他的线程就只能等着</span></span><br><span class="line">  lock.Lock()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    num++</span><br><span class="line">  &#125;</span><br><span class="line">  lock.Unlock()</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reduce</span><span class="params">()</span></span> &#123;</span><br><span class="line">  lock.Lock()</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++ &#123;</span><br><span class="line">    num--</span><br><span class="line">  &#125;</span><br><span class="line">  lock.Unlock()</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wait.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> add()</span><br><span class="line">  <span class="keyword">go</span> reduce()</span><br><span class="line">  wait.Wait()</span><br><span class="line">  fmt.Println(num)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="线程安全下的map"><a href="#线程安全下的map" class="headerlink" title="线程安全下的map"></a>线程安全下的map</h4><p>如果我们在一个协程函数下，读写map就会引发一个错误</p><p>concurrent map read and map write</p><p>希望大家见到这个错误，就能知道，这个就是map的线程安全错误</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> mp = <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reader</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Println(mp[<span class="string">&quot;time&quot;</span>])</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writer</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    mp[<span class="string">&quot;time&quot;</span>] = time.Now().Format(<span class="string">&quot;15:04:05&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wait.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> reader()</span><br><span class="line">  <span class="keyword">go</span> writer()</span><br><span class="line">  wait.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们不能在并发模式下读写map</p><p>如果要这样做</p><ol><li>给读写操作加锁</li><li>使用sync.Map</li></ol><p>加锁</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> mp = <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reader</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    lock.Lock()</span><br><span class="line">    fmt.Println(mp[<span class="string">&quot;time&quot;</span>])</span><br><span class="line">    lock.Unlock()</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writer</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    lock.Lock()</span><br><span class="line">    mp[<span class="string">&quot;time&quot;</span>] = time.Now().Format(<span class="string">&quot;15:04:05&quot;</span>)</span><br><span class="line">    lock.Unlock()</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wait.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> reader()</span><br><span class="line">  <span class="keyword">go</span> writer()</span><br><span class="line">  wait.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sync.Map</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">  <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> mp = sync.Map&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reader</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line"></span><br><span class="line">    fmt.Println(mp.Load(<span class="string">&quot;time&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writer</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    mp.Store(<span class="string">&quot;time&quot;</span>, time.Now().Format(<span class="string">&quot;15:04:05&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  wait.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  wait.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> reader()</span><br><span class="line">  <span class="keyword">go</span> writer()</span><br><span class="line">  wait.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其实看它源码，它的内部也是用了同步锁的</p><h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><h4 id="常见的异常处理"><a href="#常见的异常处理" class="headerlink" title="常见的异常处理"></a>常见的异常处理</h4><h5 id="向上抛"><a href="#向上抛" class="headerlink" title="向上抛"></a>向上抛</h5><p>将错误交给上一级处理</p><p>一般是用于框架层，有些错误框架层面不能擅做决定，将错误向上抛不失为一个好的办法</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;errors&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Parent</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">  err := method() <span class="comment">// 遇到错误向上抛</span></span><br><span class="line">  <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">method</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> errors.New(<span class="string">&quot;出错了&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(Parent())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="中断程序"><a href="#中断程序" class="headerlink" title="中断程序"></a>中断程序</h5><p>遇到错误直接停止程序</p><p>这种一般是用于初始化，一旦初始化出现错误，程序继续走下去也意义不大了，还不如中断掉</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 读取配置文件中，结果路径错了</span></span><br><span class="line">  _, err := os.ReadFile(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(err.Error())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;啦啦啦&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="恢复程序"><a href="#恢复程序" class="headerlink" title="恢复程序"></a>恢复程序</h5><p>我们可以在一个函数里面，使用一个defer，可以实现对panic的捕获</p><p>以至于出现错误不至于让程序直接崩溃</p><p>这种一般也是框架层的异常处理所做的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;runtime/debug&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err) <span class="comment">// 捕获异常，打印错误信息</span></span><br><span class="line">      <span class="comment">// 打印错误的堆栈信息</span></span><br><span class="line">      s := <span class="type">string</span>(debug.Stack())</span><br><span class="line">      fmt.Println(s)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;()</span><br><span class="line">  <span class="keyword">var</span> list = []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">  fmt.Println(list[<span class="number">2</span>]) <span class="comment">// 肯定会有一个panic</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">  read()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然，这个用于捕获异常的defer的延迟函数可以在调用链路上的任何一个函数上</p><p>一般用于在最上层函数，捕获所有异常</p><h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>从1.18版本开始，Go添加了对泛型的支持，即类型参数</p><h4 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h4><p>如果我们要实现一个对int类型的求和函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是这样写了之后，如果参数是float类型，int32类型这些，就没办法使用了</p><p>难道要为每个类型都写一个这样的函数吗？</p><p>显然这就不合理</p><p>这个时候，泛型就上场了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span>[<span class="title">T</span> <span class="title">int</span> | <span class="title">float64</span> | <span class="title">int32</span>]<span class="params">(a, b T)</span></span> T &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数多类型泛型"><a href="#函数多类型泛型" class="headerlink" title="函数多类型泛型"></a>函数多类型泛型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span>[<span class="title">T</span> <span class="title">int</span>, <span class="title">K</span> <span class="title">string</span> | <span class="title">int</span>]<span class="params">(a T, b K)</span></span> &#123;</span><br><span class="line">    fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="泛型结构体"><a href="#泛型结构体" class="headerlink" title="泛型结构体"></a>泛型结构体</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Response[T any] <span class="keyword">struct</span> &#123;</span><br><span class="line">  Code <span class="type">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">  Msg  <span class="type">string</span> <span class="string">`json:&quot;msg&quot;`</span></span><br><span class="line">  Data T      <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">    Age  <span class="type">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//user := Response&#123;</span></span><br><span class="line">  <span class="comment">//  Code: 0,</span></span><br><span class="line">  <span class="comment">//  Msg:  &quot;成功&quot;,</span></span><br><span class="line">  <span class="comment">//  Data: User&#123;</span></span><br><span class="line">  <span class="comment">//    Name: &quot;AcKnight&quot;,</span></span><br><span class="line">  <span class="comment">//  &#125;,</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">  <span class="comment">//byteData, _ := json.Marshal(user)</span></span><br><span class="line">  <span class="comment">//fmt.Println(string(byteData))</span></span><br><span class="line">  <span class="comment">//userInfo := Response&#123;</span></span><br><span class="line">  <span class="comment">//  Code: 0,</span></span><br><span class="line">  <span class="comment">//  Msg:  &quot;成功&quot;,</span></span><br><span class="line">  <span class="comment">//  Data: UserInfo&#123;</span></span><br><span class="line">  <span class="comment">//    Name: &quot;AcKnight&quot;,</span></span><br><span class="line">  <span class="comment">//    Age:  24,</span></span><br><span class="line">  <span class="comment">//  &#125;,</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">  <span class="comment">//byteData, _ = json.Marshal(userInfo)</span></span><br><span class="line">  <span class="comment">//fmt.Println(string(byteData))</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> userResponse Response[User]</span><br><span class="line">  json.Unmarshal([]<span class="type">byte</span>(<span class="string">`&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;成功&quot;,&quot;data&quot;:&#123;&quot;name&quot;:&quot;AcKnight&quot;&#125;&#125;`</span>), &amp;userResponse)</span><br><span class="line">  fmt.Println(userResponse.Data.Name)</span><br><span class="line">  <span class="keyword">var</span> userInfoResponse Response[UserInfo]</span><br><span class="line">  json.Unmarshal([]<span class="type">byte</span>(<span class="string">`&#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;成功&quot;,&quot;data&quot;:&#123;&quot;name&quot;:&quot;AcKnight&quot;,&quot;age&quot;:24&#125;&#125;`</span>), &amp;userInfoResponse)</span><br><span class="line">  fmt.Println(userInfoResponse.Data.Name, userInfoResponse.Data.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="泛型切片"><a href="#泛型切片" class="headerlink" title="泛型切片"></a>泛型切片</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MySlice[T any] []T</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> mySlice MySlice[<span class="type">string</span>]</span><br><span class="line">  mySlice = <span class="built_in">append</span>(mySlice, <span class="string">&quot;AcKnight&quot;</span>)</span><br><span class="line">  <span class="keyword">var</span> intSlice MySlice[<span class="type">int</span>]</span><br><span class="line">  intSlice = <span class="built_in">append</span>(intSlice, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="泛型map"><a href="#泛型map" class="headerlink" title="泛型map"></a>泛型map</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyMap[K <span class="type">string</span> | <span class="type">int</span>, V any] <span class="keyword">map</span>[K]V</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> myMap = <span class="built_in">make</span>(MyMap[<span class="type">string</span>, <span class="type">string</span>])</span><br><span class="line">  myMap[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">  fmt.Println(myMap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><h4 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h4><h5 id="一次性读取"><a href="#一次性读取" class="headerlink" title="一次性读取"></a>一次性读取</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">byteData, _ := os.ReadFile(<span class="string">&quot;go_study/hello.txt&quot;</span>)</span><br><span class="line">fmt.Println(<span class="type">string</span>(byteData))</span><br></pre></td></tr></table></figure><h5 id="获取当前go文件的路径"><a href="#获取当前go文件的路径" class="headerlink" title="获取当前go文件的路径"></a>获取当前go文件的路径</h5><p>可以通过获取当前go文件的路径，然后用相对于当前go文件的路径去打开文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetCurrentFilePath 获取当前文件路径</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetCurrentFilePath</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">  _, file, _, _ := runtime.Caller(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">return</span> file</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="分片读"><a href="#分片读" class="headerlink" title="分片读"></a>分片读</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">file, _ := os.Open(<span class="string">&quot;go_study/hello.txt&quot;</span>)</span><br><span class="line"><span class="keyword">defer</span> file.Close()</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1</span>)</span><br><span class="line">  _, err := file.Read(buf)</span><br><span class="line">  <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;%s&quot;</span>, buf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="带缓冲读"><a href="#带缓冲读" class="headerlink" title="带缓冲读"></a>带缓冲读</h5><p><strong>按行读</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">file, _ := os.Open(<span class="string">&quot;go_study/hello.txt&quot;</span>)</span><br><span class="line">buf := bufio.NewReader(file)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  line, _, err := buf.ReadLine()</span><br><span class="line">  fmt.Println(<span class="type">string</span>(line))</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>指定分割符</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">file, _ := os.Open(<span class="string">&quot;go_study/hello.txt&quot;</span>)</span><br><span class="line">scanner := bufio.NewScanner(file)</span><br><span class="line">scanner.Split(bufio.ScanWords) <span class="comment">// 按照单词读</span></span><br><span class="line"><span class="comment">//scanner.Split(bufio.ScanLines) // 按照行读</span></span><br><span class="line"><span class="comment">//scanner.Split(bufio.ScanRunes) // 按照中文字符读</span></span><br><span class="line"><span class="comment">//scanner.Split(bufio.ScanBytes) // 按照字节读读，中文会乱码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> scanner.Scan() &#123;</span><br><span class="line">  fmt.Println(scanner.Text())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文件写入"><a href="#文件写入" class="headerlink" title="文件写入"></a>文件写入</h4><h5 id="一次性写入"><a href="#一次性写入" class="headerlink" title="一次性写入"></a>一次性写入</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">err := os.WriteFile(<span class="string">&quot;go_study/file1.txt&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;这是内容&quot;</span>), os.ModePerm)</span><br><span class="line">fmt.Println(err)</span><br></pre></td></tr></table></figure><h5 id="文件的打开方式"><a href="#文件的打开方式" class="headerlink" title="文件的打开方式"></a>文件的打开方式</h5><p><strong>常见的一些打开模式</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果文件不存在就创建</span></span><br><span class="line">os.O_CREATE|os.O_WRONLY</span><br><span class="line"><span class="comment">// 追加写</span></span><br><span class="line">os.O_APPEND|os.O_WRONLY</span><br><span class="line"><span class="comment">// 可读可写</span></span><br><span class="line">os.O_RDWR</span><br></pre></td></tr></table></figure><p><strong>完整的模式</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  O_RDONLY <span class="type">int</span> = syscall.O_RDONLY <span class="comment">// 只读</span></span><br><span class="line">  O_WRONLY <span class="type">int</span> = syscall.O_WRONLY <span class="comment">// 只写</span></span><br><span class="line">  O_RDWR   <span class="type">int</span> = syscall.O_RDWR   <span class="comment">// 读写</span></span><br><span class="line">  </span><br><span class="line">  O_APPEND <span class="type">int</span> = syscall.O_APPEND <span class="comment">// 追加</span></span><br><span class="line">  O_CREATE <span class="type">int</span> = syscall.O_CREAT  <span class="comment">// 如果不存在就创建</span></span><br><span class="line">  O_EXCL   <span class="type">int</span> = syscall.O_EXCL   <span class="comment">// 文件必须不存在</span></span><br><span class="line">  O_SYNC   <span class="type">int</span> = syscall.O_SYNC   <span class="comment">// 同步打开</span></span><br><span class="line">  O_TRUNC  <span class="type">int</span> = syscall.O_TRUNC  <span class="comment">// 打开时清空文件</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="文件的权限"><a href="#文件的权限" class="headerlink" title="文件的权限"></a>文件的权限</h5><p>主要用于linux系统，在windows下这个参数会被无视，代表文件的模式和权限位，</p><p>三个占位符</p><p>第一个是文件所有者所拥有的权限</p><p>第二个是文件所在组对其拥有的权限</p><p>第三个占位符是指其他人对文件拥有的权限</p><p>根据UNIX系统的权限模型，文件或目录的权限模式由三个数字表示，分别代表 所有者（Owner） 、组（Group） 和 其他用户(Other) 的权限。每个数字由三个比特位组成，分别代表读、写和执行权限。因此，对于一个mode参数值，它的每一个数字都是一个八进制数字，代表三个比特位的权限组合</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">R：读，Read的缩写，八进制值为 <span class="number">4</span>；</span><br><span class="line">W：写，Write的缩写，八进制值为 <span class="number">2</span>；</span><br><span class="line">X：执行，Execute的缩写，八进制值为 <span class="number">1</span>；</span><br></pre></td></tr></table></figure><p>例如</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0444</span> 表示三者均为只读的权限；</span><br><span class="line"><span class="number">0666</span> 表示三者均为“读写”的权限；</span><br><span class="line"><span class="number">0777</span> 表示三者均为读写执行的权限；</span><br><span class="line"><span class="number">0764</span> 表示所有者有读写执行（<span class="number">7</span>=<span class="number">4</span>+<span class="number">2</span>+<span class="number">1</span>）的权限，组有读写（<span class="number">6</span>=<span class="number">4</span>+<span class="number">2</span>）的权限，其他用户则为只读（<span class="number">4</span>=<span class="number">4</span>）；</span><br></pre></td></tr></table></figure><h5 id="文件复制"><a href="#文件复制" class="headerlink" title="文件复制"></a>文件复制</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io.Copy(dst Writer, src Reader) (written <span class="type">int64</span>, err <span class="type">error</span>)</span><br></pre></td></tr></table></figure><p>将src文件的内容复制到dst文件</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">read, _ := os.Open(<span class="string">&quot;go_study/file1.txt&quot;</span>)</span><br><span class="line">write, _ := os.Create(<span class="string">&quot;go_study/file3.txt&quot;</span>) <span class="comment">// 默认是 可读可写，不存在就创建，清空文件</span></span><br><span class="line">n, err := io.Copy(write, read)</span><br><span class="line">fmt.Println(n, err)</span><br></pre></td></tr></table></figure><h5 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dir, _ := os.ReadDir(<span class="string">&quot;go_study&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> _, entry := <span class="keyword">range</span> dir &#123;</span><br><span class="line">  info, _ := entry.Info()</span><br><span class="line">  fmt.Println(entry.Name(), info.Size()) <span class="comment">// 文件名，文件大小，单位比特</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><p>Go语言中自带有一个轻量级的测试框架testing和自带的go test命令来实现单元测试和性能测试，testing框架和其他语言的测试框架相似，可以基于这个框架写针对相应函数的测试用例，也可以基于该框架写相应的压力测试用例。通过单元测试，可以解决：</p><ol><li>确保每个函数是可运行，并且运行结果是正确的</li><li>确保写出来的代码性能是好的</li><li>单元测试能及时的发现程序设计或实现的逻辑错误，使问题暴露，便于问题的定位解决，而性能测试的重点在于发现程序设计上的一些问题，让程序能够在高并发的情况下还能保持稳定</li></ol><p>Go 语言推荐测试文件和源代码文件放在一块，测试文件以 <code>_test.go</code> 结尾</p><blockquote><p>需要注意的是</p></blockquote><ol><li>测试用例文件名必须以_test.go结尾</li><li>测试用例函数必须以Test开头，一般来说就是Test+被测试的函数名</li></ol><h4 id="单元测试-1"><a href="#单元测试-1" class="headerlink" title="单元测试"></a>单元测试</h4><p>例如我现在有两个用于计算的文件，叫calc.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a <span class="type">int</span>, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Mul</span><span class="params">(a <span class="type">int</span>, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么我的测试文件就是calc_test.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ans := Add(<span class="number">1</span>, <span class="number">2</span>); ans != <span class="number">3</span> &#123;</span><br><span class="line">    <span class="comment">// 如果不符合预期，那就是测试不通过</span></span><br><span class="line">    t.Errorf(<span class="string">&quot;1 + 2 expected be 3, but %d got&quot;</span>, ans)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ans := Add(<span class="number">-10</span>, <span class="number">-20</span>); ans != <span class="number">-30</span> &#123;</span><br><span class="line">    t.Errorf(<span class="string">&quot;-10 + -20 expected be -30, but %d got&quot;</span>, ans)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试的话，就在界面上点绿色的按钮就可以了</p><p>如果是命令的话</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> test <span class="comment">// 可以运行某个包下的所有测试用例</span></span><br></pre></td></tr></table></figure><p><code>-v</code> 参数会显示每个用例的测试结果</p><p><code>-run</code>参数可以指定测试某个函数</p><p>单元测试框架提供的日志方法</p><table><thead><tr><th>方 法</th><th>备 注</th><th>测试结果</th></tr></thead><tbody><tr><td>Log</td><td>打印日志，同时结束测试</td><td>PASS</td></tr><tr><td>Logf</td><td>格式化打印日志，同时结束测试</td><td>PASS</td></tr><tr><td>Error</td><td>打印错误日志，同时结束测试</td><td>FAIL</td></tr><tr><td>Errorf</td><td>格式化打印错误日志，同时结束测试</td><td>FAIL</td></tr><tr><td>Fatal</td><td>打印致命日志，同时结束测试</td><td>FAIL</td></tr><tr><td>Fatalf</td><td>格式化打印致命日志，同时结束测试</td><td>FAIL</td></tr></tbody></table><h4 id="子测试"><a href="#子测试" class="headerlink" title="子测试"></a>子测试</h4><p>如果需要给一个函数，调用不同的测试用例，可以使用子测试</p><p>子测试里面的Fatal，是不会终止程序的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t1 *testing.T)</span></span> &#123;</span><br><span class="line">  t1.Run(<span class="string">&quot;add1&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ans := Add(<span class="number">1</span>, <span class="number">2</span>); ans != <span class="number">3</span> &#123;</span><br><span class="line">      <span class="comment">// 如果不符合预期，那就是测试不通过</span></span><br><span class="line">      t.Fatalf(<span class="string">&quot;1 + 2 expected be 3, but %d got&quot;</span>, ans)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  t1.Run(<span class="string">&quot;add2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ans := Add(<span class="number">-10</span>, <span class="number">-20</span>); ans != <span class="number">-30</span> &#123;</span><br><span class="line">      t.Fatalf(<span class="string">&quot;-10 + -20 expected be -30, but %d got&quot;</span>, ans)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果测试用例很多，还可以用一个类似表格去表示</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">  cases := []<span class="keyword">struct</span> &#123;</span><br><span class="line">    Name           <span class="type">string</span></span><br><span class="line">    A, B, Expected <span class="type">int</span></span><br><span class="line">  &#125;&#123;</span><br><span class="line">    &#123;<span class="string">&quot;a1&quot;</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;a2&quot;</span>, <span class="number">2</span>, <span class="number">-3</span>, <span class="number">-1</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;a3&quot;</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>&#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> _, c := <span class="keyword">range</span> cases &#123;</span><br><span class="line">    t.Run(c.Name, <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ans := Add(c.A, c.B); ans != c.Expected &#123;</span><br><span class="line">        t.Fatalf(<span class="string">&quot;%d * %d expected %d, but %d got&quot;</span>,</span><br><span class="line">          c.A, c.B, c.Expected, ans)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="TestMain函数"><a href="#TestMain函数" class="headerlink" title="TestMain函数"></a>TestMain函数</h4><p>它是测试的入口</p><p>我们可以在TestMain里面实现测试流程的生命周期</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">  <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试前执行</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setup</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Before all tests&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试后执行</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">teardown</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;After all tests&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test1</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;I&#x27;m test1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test2</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;I&#x27;m test2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 必须叫这个名字  测试主入口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 测试前执行</span></span><br><span class="line">  setup()</span><br><span class="line">  code := m.Run()</span><br><span class="line">  <span class="comment">// 测试后执行</span></span><br><span class="line">  teardown()</span><br><span class="line">  os.Exit(code)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><h4 id="类型判断"><a href="#类型判断" class="headerlink" title="类型判断"></a>类型判断</h4><p>判断一个变量是否是结构体，切片，map</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">refType</span><span class="params">(obj any)</span></span> &#123;</span><br><span class="line">  typeObj := reflect.TypeOf(obj)</span><br><span class="line">  fmt.Println(typeObj, typeObj.Kind())</span><br><span class="line">  <span class="comment">// 去判断具体的类型</span></span><br><span class="line">  <span class="keyword">switch</span> typeObj.Kind() &#123;</span><br><span class="line">  <span class="keyword">case</span> reflect.Slice:</span><br><span class="line">    fmt.Println(<span class="string">&quot;切片&quot;</span>)</span><br><span class="line">  <span class="keyword">case</span> reflect.Map:</span><br><span class="line">    fmt.Println(<span class="string">&quot;map&quot;</span>)</span><br><span class="line">  <span class="keyword">case</span> reflect.Struct:</span><br><span class="line">    fmt.Println(<span class="string">&quot;结构体&quot;</span>)</span><br><span class="line">  <span class="keyword">case</span> reflect.String:</span><br><span class="line">    fmt.Println(<span class="string">&quot;字符串&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  refType(<span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">  &#125;&#123;Name: <span class="string">&quot;AcKnight&quot;</span>&#125;)</span><br><span class="line">  name := <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">  refType(name)</span><br><span class="line">  refType([]<span class="type">string</span>&#123;<span class="string">&quot;AcKnight&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="通过反射获取值"><a href="#通过反射获取值" class="headerlink" title="通过反射获取值"></a>通过反射获取值</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">refValue</span><span class="params">(obj any)</span></span> &#123;</span><br><span class="line">  value := reflect.ValueOf(obj)</span><br><span class="line">  fmt.Println(value, value.Type())</span><br><span class="line">  <span class="keyword">switch</span> value.Kind() &#123;</span><br><span class="line">  <span class="keyword">case</span> reflect.Int:</span><br><span class="line">    fmt.Println(value.Int())</span><br><span class="line">  <span class="keyword">case</span> reflect.Struct:</span><br><span class="line">    fmt.Println(value.Interface())</span><br><span class="line">  <span class="keyword">case</span> reflect.String:</span><br><span class="line">    fmt.Println(value.String())</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="通过反射修改值"><a href="#通过反射修改值" class="headerlink" title="通过反射修改值"></a>通过反射修改值</h4><blockquote><p>注意，如果需要通过反射修改值，必须要传指针，在反射中使用Elem取指针对应的值</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">refSetValue</span><span class="params">(obj any)</span></span> &#123;</span><br><span class="line">  value := reflect.ValueOf(obj)</span><br><span class="line">  elem := value.Elem()</span><br><span class="line">  <span class="comment">// 专门取指针反射的值</span></span><br><span class="line">  <span class="keyword">switch</span> elem.Kind() &#123;</span><br><span class="line">  <span class="keyword">case</span> reflect.String:</span><br><span class="line">    elem.SetString(<span class="string">&quot;ACKNIGHT&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  name := <span class="string">&quot;AcKnight&quot;</span></span><br><span class="line">  refSetValue(&amp;name)</span><br><span class="line">  fmt.Println(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="结构体反射"><a href="#结构体反射" class="headerlink" title="结构体反射"></a>结构体反射</h4><p>读取json标签对应的值，如果没有就用属性的名称</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Age  <span class="type">int</span> <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s := Student&#123;</span><br><span class="line">    Name: <span class="string">&quot;AcKnight&quot;</span>,</span><br><span class="line">    Age:  <span class="number">24</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  t := reflect.TypeOf(s)</span><br><span class="line">  v := reflect.ValueOf(s)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</span><br><span class="line">    field := t.Field(i)</span><br><span class="line">    jsonField := field.Tag.Get(<span class="string">&quot;json&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> jsonField == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">      <span class="comment">// 说明json的tag是空的</span></span><br><span class="line">      jsonField = field.Name</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Name: %s, type: %s, json: %s, value: %v\n&quot;</span>, field.Name, field.Type, jsonField, v.Field(i))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然了，我们写的这个都很简单了，没有处理-和omitempty的情况</p><h4 id="修改结构体中某些值"><a href="#修改结构体中某些值" class="headerlink" title="修改结构体中某些值"></a>修改结构体中某些值</h4><p>例如，结构体tag中有big的标签，就将值大写</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;reflect&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name1 <span class="type">string</span> <span class="string">`big:&quot;-&quot;`</span></span><br><span class="line">  Name2 <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s := Student&#123;</span><br><span class="line">    Name1: <span class="string">&quot;acknight&quot;</span>,</span><br><span class="line">    Name2: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  t := reflect.TypeOf(s)</span><br><span class="line">  v := reflect.ValueOf(&amp;s).Elem()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</span><br><span class="line">    field := t.Field(i)</span><br><span class="line">    bigField := field.Tag.Get(<span class="string">&quot;big&quot;</span>)</span><br><span class="line">    <span class="comment">// 判断类型是不是字符串</span></span><br><span class="line">    <span class="keyword">if</span> field.Type.Kind() != reflect.String &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> bigField == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改值</span></span><br><span class="line">    valueFiled := v.Field(i)</span><br><span class="line">    valueFiled.SetString(strings.ToTitle(valueFiled.String()))</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="调用结构体方法"><a href="#调用结构体方法" class="headerlink" title="调用结构体方法"></a>调用结构体方法</h4><p>如果结构体有call这个名字的方法，就执行它</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span></span><br><span class="line">  Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Student)</span></span> See(name <span class="type">string</span>) &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;see name:&quot;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  s := Student&#123;</span><br><span class="line">    Name: <span class="string">&quot;acknight&quot;</span>,</span><br><span class="line">    Age:  <span class="number">21</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  t := reflect.TypeOf(s)</span><br><span class="line">  v := reflect.ValueOf(s)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumMethod(); i++ &#123;</span><br><span class="line">    methodType := t.Method(i)</span><br><span class="line">    fmt.Println(methodType.Name, methodType.Type)</span><br><span class="line">    <span class="keyword">if</span> methodType.Name != <span class="string">&quot;See&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    methodValue := v.Method(i)</span><br><span class="line">    methodValue.Call([]reflect.Value&#123;</span><br><span class="line">      reflect.ValueOf(<span class="string">&quot;AcKnight&quot;</span>), <span class="comment">// 注意这里的类型</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ORM小案例"><a href="#ORM小案例" class="headerlink" title="ORM小案例"></a>ORM小案例</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;errors&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;reflect&quot;</span></span><br><span class="line">  <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">  Name <span class="type">string</span> <span class="string">`ac-orm:&quot;name&quot;`</span></span><br><span class="line">  Age  <span class="type">int</span>    <span class="string">`ac-orm:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">  Id   <span class="type">int</span>    <span class="string">`ac-orm:&quot;id&quot;`</span></span><br><span class="line">  Name <span class="type">string</span> <span class="string">`ac-orm:&quot;name&quot;`</span></span><br><span class="line">  Age  <span class="type">int</span>    <span class="string">`ac-orm:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Find</span><span class="params">(obj any, query ...any)</span></span> (sql <span class="type">string</span>, err <span class="type">error</span>) &#123;</span><br><span class="line">  <span class="comment">// Find(Student, &quot;name = ?&quot;, &quot;acknight&quot;)</span></span><br><span class="line">  <span class="comment">// 希望能够生成 select name, age from  where  name = &#x27;acknight&#x27;</span></span><br><span class="line">  t := reflect.TypeOf(obj)</span><br><span class="line">  <span class="comment">//v := reflect.ValueOf(obj)</span></span><br><span class="line">  <span class="comment">// 首先得是结构体对吧</span></span><br><span class="line">  <span class="keyword">if</span> t.Kind() != reflect.Struct &#123;</span><br><span class="line">    err = errors.New(<span class="string">&quot;非结构体&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 拿全部字段</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接条件</span></span><br><span class="line">  <span class="comment">// 第二个参数，中的问号，就决定后面还能接多少参数</span></span><br><span class="line">  <span class="keyword">var</span> where <span class="type">string</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(query) &gt; <span class="number">0</span> &#123;</span><br><span class="line">    <span class="comment">// 有第二个参数，校验第二个参数中的？个数，是不是和后面的个数一样</span></span><br><span class="line">    q := query[<span class="number">0</span>] <span class="comment">// 理论上还要校验第二个参数的类型</span></span><br><span class="line">    <span class="keyword">if</span> strings.Count(q.(<span class="type">string</span>), <span class="string">&quot;?&quot;</span>)+<span class="number">1</span> != <span class="built_in">len</span>(query) &#123;</span><br><span class="line">      err = errors.New(<span class="string">&quot;参数个数不对&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 拼接where语句</span></span><br><span class="line">    <span class="comment">// 将？号带入后面的参数</span></span><br><span class="line">    <span class="keyword">for</span> _, a := <span class="keyword">range</span> query[<span class="number">1</span>:] &#123;</span><br><span class="line">      <span class="comment">// 替换q</span></span><br><span class="line">      <span class="comment">// 这里要判断a的类型</span></span><br><span class="line">      at := reflect.TypeOf(a)</span><br><span class="line">      <span class="keyword">switch</span> at.Kind() &#123;</span><br><span class="line">      <span class="keyword">case</span> reflect.Int:</span><br><span class="line">        q = strings.Replace(q.(<span class="type">string</span>), <span class="string">&quot;?&quot;</span>, fmt.Sprintf(<span class="string">&quot;%d&quot;</span>, a.(<span class="type">int</span>)), <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">case</span> reflect.String:</span><br><span class="line">        q = strings.Replace(q.(<span class="type">string</span>), <span class="string">&quot;?&quot;</span>, fmt.Sprintf(<span class="string">&quot;&#x27;%s&#x27;&quot;</span>, a.(<span class="type">string</span>)), <span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    where += <span class="string">&quot;where &quot;</span> + q.(<span class="type">string</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果没有第二个参数，就是查全部</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接select</span></span><br><span class="line">  <span class="comment">// 拿所有字段，取ac-orm对应的值</span></span><br><span class="line">  <span class="keyword">var</span> columns []<span class="type">string</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</span><br><span class="line">    field := t.Field(i)</span><br><span class="line">    f := field.Tag.Get(<span class="string">&quot;ac-orm&quot;</span>)</span><br><span class="line">    <span class="comment">// 不考虑是空的情况</span></span><br><span class="line">    columns = <span class="built_in">append</span>(columns, f)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 结构体的小写名字+s做表名</span></span><br><span class="line">  name := strings.ToLower(t.Name()) + <span class="string">&quot;s&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接最后的sql</span></span><br><span class="line">  sql = fmt.Sprintf(<span class="string">&quot;select %s from %s %s&quot;</span>, strings.Join(columns, <span class="string">&quot;,&quot;</span>), name, where)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  sql, err := Find(Student&#123;&#125;, <span class="string">&quot;name = ? and age = ?&quot;</span>, <span class="string">&quot;acknight&quot;</span>, <span class="number">23</span>)</span><br><span class="line">  fmt.Println(sql, err) <span class="comment">// select name,age from students where name = &#x27;acknight&#x27; and age = 23</span></span><br><span class="line">  sql, err = Find(UserInfo&#123;&#125;, <span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>)</span><br><span class="line">  fmt.Println(sql, err) <span class="comment">// select id,name,age from userinfos where id = 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是写一下框架，偏底层工具类的操作</p><p>不用反射确实不太好写，但是如果是在业务上，大量使用反射就不太合适了</p><p>因为反射的性能没有正常代码高，会慢个一到两个数量级</p><p>使用反射可读性也不太好，并且也不能在编译期间发生错误</p><h3 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h3><h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p>传输控制协议（<em>TCP</em>，Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议</p><p>如何保证连接可靠呢？（面试常考题）</p><ol><li>三次握手</li><li>四次挥手</li></ol><h5 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;io&quot;</span></span><br><span class="line">  <span class="string">&quot;net&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 创建tcp的监听地址</span></span><br><span class="line">  tcpAddr, _ := net.ResolveTCPAddr(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:8080&quot;</span>)</span><br><span class="line">  <span class="comment">// tcp监听</span></span><br><span class="line">  listen, _ := net.ListenTCP(<span class="string">&quot;tcp&quot;</span>, tcpAddr)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 等待连接</span></span><br><span class="line">    conn, err := listen.AcceptTCP()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(err)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取客户端的地址</span></span><br><span class="line">    fmt.Println(conn.RemoteAddr().String() + <span class="string">&quot; 进来了&quot;</span>)</span><br><span class="line">    <span class="comment">// 读取客户端传来的数据</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> buf []<span class="type">byte</span> = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>)</span><br><span class="line">      n, err := conn.Read(buf)</span><br><span class="line">      <span class="comment">// 客户端退出</span></span><br><span class="line">      <span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">        fmt.Println(conn.RemoteAddr().String() + <span class="string">&quot; 出去了&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      fmt.Println(<span class="type">string</span>(buf[<span class="number">0</span>:n]))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;net&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  conn, _ := net.DialTCP(<span class="string">&quot;tcp&quot;</span>, <span class="literal">nil</span>,</span><br><span class="line">    &amp;net.TCPAddr&#123;</span><br><span class="line">      IP:   net.ParseIP(<span class="string">&quot;127.0.0.1&quot;</span>),</span><br><span class="line">      Port: <span class="number">8080</span>&#125;)</span><br><span class="line">  <span class="keyword">var</span> s <span class="type">string</span></span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Scanln(&amp;s)</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">&quot;q&quot;</span> &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    conn.Write([]<span class="type">byte</span>(s))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  conn.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><h5 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端"></a>服务端</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// handler</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  res.Write([]<span class="type">byte</span>(<span class="string">&quot;hello AcKnight&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 回调函数</span></span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/index&quot;</span>, handler)</span><br><span class="line">  <span class="comment">// 绑定服务</span></span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;io&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IndexHandler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> req.Method &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">    data, err := os.ReadFile(<span class="string">&quot;acStudy/37.http/server/index.html&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(data)</span><br><span class="line">    &#125;</span><br><span class="line">    res.Write(data)</span><br><span class="line">    <span class="comment">//res.Write([]byte(&quot;&lt;h1&gt;hello AcKnight GET&lt;/h1&gt;&quot;))</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">    <span class="comment">// 获取body数据</span></span><br><span class="line">    data, err := io.ReadAll(req.Body)</span><br><span class="line">    <span class="comment">// 拿请求头</span></span><br><span class="line">    contentType := req.Header.Get(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">    fmt.Println(contentType)</span><br><span class="line">    <span class="comment">//switch contentType &#123;</span></span><br><span class="line">    <span class="comment">//case &quot;application/json&quot;:</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(data)</span><br><span class="line">    &#125;</span><br><span class="line">    ma := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>)</span><br><span class="line">    json.Unmarshal(data, &amp;ma)</span><br><span class="line">    fmt.Println(ma[<span class="string">&quot;username&quot;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">      Username <span class="type">string</span> <span class="string">`json:&quot;username&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> user User</span><br><span class="line">    json.Unmarshal(data, &amp;user)</span><br><span class="line">    fmt.Println(user)</span><br><span class="line">    <span class="comment">// 设置响应头</span></span><br><span class="line">    header := res.Header()</span><br><span class="line">    header[<span class="string">&quot;token&quot;</span>] = []<span class="type">string</span>&#123;<span class="string">&quot;y1gyf156sdgT%d44hjgj&quot;</span>&#125;</span><br><span class="line">    res.Write([]<span class="type">byte</span>(<span class="string">&quot;hello AcKnight POST&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 1. 绑定回调</span></span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/index&quot;</span>, IndexHandler)</span><br><span class="line">  <span class="comment">// 2. 注册服务</span></span><br><span class="line">  fmt.Println(<span class="string">&quot;listen server on http://localhost:8080&quot;</span>)</span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;io&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 实例化一个http客户端</span></span><br><span class="line">  client := <span class="built_in">new</span>(http.Client)</span><br><span class="line">  <span class="comment">// 构造请求对象</span></span><br><span class="line">  req, _ := http.NewRequest(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:8080/index&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">  <span class="comment">// 发请求</span></span><br><span class="line">  res, _ := client.Do(req)</span><br><span class="line">  <span class="comment">// 获取响应</span></span><br><span class="line">  b, _ := io.ReadAll(res.Body)</span><br><span class="line">  fmt.Println(<span class="type">string</span>(b))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><p>远程过程调用的协议</p><h4 id="服务端-2"><a href="#服务端-2" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;net&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">  <span class="string">&quot;net/rpc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Req <span class="keyword">struct</span> &#123;</span><br><span class="line">  Num1 <span class="type">int</span></span><br><span class="line">  Num2 <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Res <span class="keyword">struct</span> &#123;</span><br><span class="line">  Num <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Server)</span></span> Add(req Req, res *Res) <span class="type">error</span> &#123;</span><br><span class="line">  res.Num = req.Num1 + req.Num2</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 注册rpc服务</span></span><br><span class="line">  rpc.Register(<span class="built_in">new</span>(Server))</span><br><span class="line">  rpc.HandleHTTP()</span><br><span class="line">  listen, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  http.Serve(listen, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="客户端-2"><a href="#客户端-2" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;net/rpc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Req <span class="keyword">struct</span> &#123;</span><br><span class="line">  Num1 <span class="type">int</span></span><br><span class="line">  Num2 <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Res <span class="keyword">struct</span> &#123;</span><br><span class="line">  Num <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  req := Req&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line">  client, err := rpc.DialHTTP(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> res Res</span><br><span class="line">  client.Call(<span class="string">&quot;Server.Add&quot;</span>, req, &amp;res)</span><br><span class="line">  fmt.Println(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h3><p>websocket是<a href="https://so.csdn.net/so/search?q=socket&spm=1001.2101.3001.7020">socket</a>连接和http协议的结合体，可以实现网页和服务端的长连接</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get github.com/gorilla/websocket</span><br></pre></td></tr></table></figure><h4 id="服务端-3"><a href="#服务端-3" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gorilla/websocket&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> UP = websocket.Upgrader&#123;</span><br><span class="line">  ReadBufferSize:  <span class="number">1024</span>,</span><br><span class="line">  WriteBufferSize: <span class="number">1024</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 服务升级</span></span><br><span class="line">  conn, err := UP.Upgrade(res, req, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 消息类型，消息，错误</span></span><br><span class="line">    t, p, err := conn.ReadMessage()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    conn.WriteMessage(websocket.TextMessage, []<span class="type">byte</span>(fmt.Sprintf(<span class="string">&quot;你说的是：%s吗？&quot;</span>, <span class="type">string</span>(p))))</span><br><span class="line">    fmt.Println(t, <span class="type">string</span>(p))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line">  fmt.Println(<span class="string">&quot;服务关闭&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/&quot;</span>, handler)</span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>服务端给多个客户端发</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gorilla/websocket&quot;</span></span><br><span class="line">  <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> UP = websocket.Upgrader&#123;</span><br><span class="line">  ReadBufferSize:  <span class="number">1024</span>,</span><br><span class="line">  WriteBufferSize: <span class="number">1024</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> connLis []*websocket.Conn</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(res http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">  <span class="comment">// 服务升级</span></span><br><span class="line">  conn, err := UP.Upgrade(res, req, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  connLis = <span class="built_in">append</span>(connLis, conn)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// 消息类型，消息，错误</span></span><br><span class="line">    t, p, err := conn.ReadMessage()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> index := <span class="keyword">range</span> connLis &#123;</span><br><span class="line">      connLis[index].WriteMessage(websocket.TextMessage, []<span class="type">byte</span>(fmt.Sprintf(<span class="string">&quot;你说的是：%s吗？&quot;</span>, <span class="type">string</span>(p))))</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(t, <span class="type">string</span>(p))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> conn.Close()</span><br><span class="line">  fmt.Println(<span class="string">&quot;服务关闭&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  http.HandleFunc(<span class="string">&quot;/&quot;</span>, handler)</span><br><span class="line">  http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="客户端-3"><a href="#客户端-3" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;bufio&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/gorilla/websocket&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  dl := websocket.Dialer&#123;&#125;</span><br><span class="line">  conn, _, err := dl.Dial(<span class="string">&quot;ws://127.0.0.1:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">go</span> send(conn)</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    t, p, err := conn.ReadMessage()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(t, <span class="type">string</span>(p))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(conn *websocket.Conn)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    reader := bufio.NewReader(os.Stdin)</span><br><span class="line">    l, _, _ := reader.ReadLine()</span><br><span class="line">    conn.WriteMessage(websocket.TextMessage, l)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>go项目的部署特别简单，编写完成之后，只需要执行go build即可打包为可执行文件</p><blockquote><p>注意，这个操作是不同平台不一样的</p></blockquote><p>windows下打包就是exe文件，linux下打包就是二进制文件</p><h4 id="打包命令"><a href="#打包命令" class="headerlink" title="打包命令"></a>打包命令</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build </span><br></pre></td></tr></table></figure><p>打当前目录下的main包，注意，只能有一个main函数的包</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build xxx.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><p>打当前目录下，xxx.go的包，这个包必须得是一个main包，不然没有效果</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> build -o main.exe xxx.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><p>强制对输出的文件进行重命名</p><p>-o参数必须得在文件的前面</p><h4 id="交叉编译"><a href="#交叉编译" class="headerlink" title="交叉编译"></a>交叉编译</h4><p>什么是交叉编译呢，就是在windows上，我开发的go程序，我也能打包为linux上的可执行程序</p><p>例如在windows平台，打linux的包</p><blockquote><p>注意，执行set这个命令，一定得要是在cmd的命令行下，powershell是无效的</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set CGO_ENABLED=<span class="number">0</span>  </span><br><span class="line">set GOOS=linux  </span><br><span class="line">set GOARCH=amd64  </span><br><span class="line"><span class="keyword">go</span> build -o main main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><p>CGO_ENABLED : CGO 表示 golang 中的工具，CGO_ENABLED&#x3D;0 表示 CGO 禁用，交叉编译中不能使用 CGO GOOS : 环境变量用于指定目标操作系统，mac 对应 darwin，linux 对应 linux，windows 对应 windows ，还有其它的 freebsd、android 等</p><p><code>GOARCH</code>：环境变量用于指定处理器的类型，386 也称 <code>x86</code> 对应 32位操作系统、<code>amd64</code> 也称 x64 对应 64 位操作系统，<code>arm</code> 这种架构一般用于嵌入式开发。比如 <code>Android</code> ， <code>iOS</code> ， <code>Win mobile</code> 等</p><p>为了方便呢，可以在项目的根目录下写一个bat文件</p><p>这样就能快速构建了</p><p>然后放到linux服务器下，设置文件权限就可以直接运行了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x main</span><br><span class="line">./main</span><br></pre></td></tr></table></figure><blockquote><p>再次注意啊，以后打包web项目的时候，配置文件和静态文件等这些非go程序，是要一起复制到目标服务器里面的</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA基础面试题（下）</title>
      <link href="/2025/02/11/JAVA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
      <url>/2025/02/11/JAVA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h3 id="Exception-和-Error有什么区别？"><a href="#Exception-和-Error有什么区别？" class="headerlink" title="Exception 和 Error有什么区别？"></a>Exception 和 Error有什么区别？</h3><p>在 Java 中，所有的异常都有一个共同的祖先 <strong>java.lang</strong> 包的 <strong>Throwable</strong> 类。<strong>Throwable</strong> 类有两个重要的子类：</p><ul><li><strong>Exception</strong>：程序本身可以处理的异常，可以通过 <strong>catch</strong> 来进行捕获。<strong>Exception</strong> 又可分为 Checked Exception（受检查异常，必须处理）和 UnChecked Exception（不受检查异常，可以不处理）。</li><li><strong>Error</strong>：<strong>Error</strong> 属于程序无法处理的错误，不建议通过 <strong>catch</strong> 捕获。例如 Java 虚拟机运行错误（<strong>Virtual MachineError</strong>）、虚拟机内存不够错误（<strong>OutfmeoryError</strong>）、类定义错误（<strong>noClassDefFoundError</strong>）等。这些异常发生时，Java 虚拟机（JVM）一般会选择线程终止。</li></ul><h3 id="Checked-Exception-和-UnChecked-Exception-有什么区别？"><a href="#Checked-Exception-和-UnChecked-Exception-有什么区别？" class="headerlink" title="Checked Exception 和 UnChecked Exception  有什么区别？"></a>Checked Exception 和 UnChecked Exception  有什么区别？</h3><p><strong>Checked Exception</strong> 即 受检查异常，Java 代码在编译过程中，如果受检查异常没有被 <strong>catch</strong> 或者 <strong>throws</strong> 关键字处理的话，就没办法通过编译。</p><p><strong>除了 RuntimeException 及其子类以外</strong>，其他 <strong>Exception</strong> 类及其子类都属于受检查异常。常见的受检查异常有：<strong>IO</strong> 相关的异常、<strong>ClassNotFoundException</strong> 、<strong>SQLException</strong> …。</p><p><strong>UnChecked Exception</strong> 即 不受检查异常，Java 代码在编译过程中，我即使不处理不受检查异常也可以正常通过编译。</p><p><strong>RuntimeException</strong> 及其子类都统称为非受检查异常，常见的有：</p><ul><li><strong>NullPointerException</strong>（空指针异常）。</li><li><strong>IllegalArgumentException</strong>（参数错误比如方法入参类型错误）。</li><li><strong>NumberFormatException</strong>（字符串转换为数字格式错误）。</li><li><strong>ArrayIndexOutOfBoundsException</strong>（数组越界错误）。</li><li><strong>ClassCastException</strong>（类型转换错误）。</li><li><strong>ArithmeticException</strong>（算术错误）。</li><li>…</li></ul><h3 id="Throwable-类常用方法有那些？"><a href="#Throwable-类常用方法有那些？" class="headerlink" title="Throwable 类常用方法有那些？"></a>Throwable 类常用方法有那些？</h3><ul><li>**String getMessage()**：返回异常发生的详细信息。</li><li>**String toString()**：返回异常发生时的简要描述。</li><li>**String getLocalizedMessage()**：返回异常对象的本地化信息。使用 <strong>Throwable</strong> 的子类覆盖这个方法，可以生成本地化信息。如果子类没有覆盖该方法，则该方法返回的信息与 <strong>getMessage()</strong> 返回的结果相同。</li><li>**void printStackTrace()**：在控制台上打印 <strong>Throwable</strong> 对象封装的异常信息。</li></ul><h3 id="try-catch-finally-如何使用？"><a href="#try-catch-finally-如何使用？" class="headerlink" title="try-catch-finally 如何使用？"></a>try-catch-finally 如何使用？</h3><ul><li><strong>try</strong> 块：用于捕获异常。其后可接零个或多个 <strong>catch</strong> 块，如果没有 <strong>catch</strong> 块，则必须跟一个 <strong>finally</strong> 块。</li><li><strong>catch</strong> 块：用于处理 try 捕获到的异常。</li><li><strong>finally</strong> 块：无论是否捕获或处理异常，<strong>finally</strong> 块里的语句都会被执行。当在 <strong>try</strong> 块或 <strong>catch</strong> 块中遇到 <strong>return</strong> 语句时，<strong>finally</strong> 语句块将在方法返回之前被执行。</li></ul><h3 id="finally-中的代码一定会执行吗"><a href="#finally-中的代码一定会执行吗" class="headerlink" title="finally 中的代码一定会执行吗?"></a>finally 中的代码一定会执行吗?</h3><p>不一定！在某些情况下，finally 中的代码不会被执行。</p><p>就比如说 finally 之前虚拟机被终止运行的话，finally 中的代码就不会被执行。</p><p>另外，有 2 种特殊情况，<strong>finally</strong> 块的代码不会被执行：</p><ul><li>程序所在的线程死亡。</li><li>关闭 CPU。</li></ul><h3 id="异常使用有那些需要注意的地方？"><a href="#异常使用有那些需要注意的地方？" class="headerlink" title="异常使用有那些需要注意的地方？"></a>异常使用有那些需要注意的地方？</h3><ul><li>不要把异常定义为静态变量，因为这样会导致异常栈信息错乱。每次手动抛出异常，我们都需要手动 new 一个异常对象抛出。</li><li>抛出的异常信息一定要有意义。</li><li>建议抛出更加具体的异常比如字符串转换为数字格式错误的时候应该抛出 <strong>NumberFormatException</strong> 而不是其父类 <strong>IllegaArgumentException</strong>。</li><li>避免重复记录日志：如果在捕获异常的地方已经记录了足够的信息（包括异常类型、错误信息和堆栈跟踪等），那么在业务代码中，再次抛出这个异常时，就不应该再次记录相同的错误信息。重复记录日志会使得日志文件膨胀，并且可能会掩盖问题的实际原因，使得问题更难以追踪和解决。</li><li>…</li></ul><h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><p>什么是泛型？有什么作用？</p><p><strong>Java 泛型</strong> 是 JDK 5 中引入的一个新特性，允许在定义类、接口或方法时使用参数化类型。使用泛型参数，可以增强代码的可读性以及稳定性。</p><h3 id="泛型的使用方式有哪几种？"><a href="#泛型的使用方式有哪几种？" class="headerlink" title="泛型的使用方式有哪几种？"></a>泛型的使用方式有哪几种？</h3><p>泛型一般有三种使用方式：泛型类、泛型接口、泛型方法。</p><h4 id="项目中哪里用到了泛型？"><a href="#项目中哪里用到了泛型？" class="headerlink" title="项目中哪里用到了泛型？"></a>项目中哪里用到了泛型？</h4><ul><li>自定义接口通用返回结果。</li><li>构建集合工具类。</li><li>…</li></ul><h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><h3 id="何谓反射？"><a href="#何谓反射？" class="headerlink" title="何谓反射？"></a>何谓反射？</h3><p>反射 是一种强大的机制，<strong>允许程序在运行时检查或修改其自身的行为</strong>。反射之所以称为框架的灵魂，主要是因为它赋予了我们在运行时分析类以及执行类中方法的能力。通过反射你可以获取任意一个类的所有属性和方法，你还可以调用这些方法和属性。</p><h3 id="反射的优缺点？"><a href="#反射的优缺点？" class="headerlink" title="反射的优缺点？"></a>反射的优缺点？</h3><p>反射可以让我们的代码更加灵活、为各种框架提供开箱即用的功能提供了便利。</p><p>不过，反射让我们在运行时有了分析操作类的能力的同时，也增加了安全问题，比如可以无视泛型参数的安全检查（泛型参数的安全检查发生在编译时）。另外，反射的性能也要稍差点，不过，对于框架来说实际是影响不大的。</p><h3 id="反射的应用场景？"><a href="#反射的应用场景？" class="headerlink" title="反射的应用场景？"></a>反射的应用场景？</h3><p>像咱们平时大部分时候都是在写业务代码，很少会接触到直接使用反射机制的场景。但是！这并不代表反射没有用。相反，正是因为反射，你才能这么轻松地使用各种框架。像 Spring&#x2F;Spring Boot、MyBatis 等等框架中都大量使用了反射机制。</p><p><strong>这些框架中也大量使用了动态代理，而动态代理的实现也依赖反射</strong>。</p><p>为什么你使用 Spring 的时候，一个 <strong>@Component</strong> 注解就声明了一个类为 Spring Bean 呢？为什么你通过一个 <strong>@Value</strong> 注解就读取到配置文件中的值呢？</p><p>这些都是因为你可以基于反射分析类，然后获取到类 &#x2F; 属性 &#x2F; 方法 &#x2F; 方法的参数上的注解。你获取到注解之后，就可以做进一步的处理。</p><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="何谓注解？"><a href="#何谓注解？" class="headerlink" title="何谓注解？"></a>何谓注解？</h3><p><strong>Annotation</strong>（注解）是 Java 5 开始引入的新特性，可以看作是一种特殊的注释，主要是用于修饰类、方法或者变量，提供某些信息供程序在编译或运行时使用。</p><h3 id="解析注解方法有几种？"><a href="#解析注解方法有几种？" class="headerlink" title="解析注解方法有几种？"></a>解析注解方法有几种？</h3><p>注解只有在被解析之后才会生效，常见的解析方法有两种：</p><ul><li><strong>编译期直接扫描</strong>：编译器在编译 Java 代码的时候扫描对应的注解并处理，比如某个方法使用 <strong>@Override</strong> 注解，编译器在编译的时候就会检测当前的方法是否重写了父类对应的方法。</li><li><strong>运行期通过反射处理</strong>：想框架中自带的注解（比如 Spring 框架的 <strong>@Value</strong>、**@Component**）都是通过反射来进行处理的。</li></ul><h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><h3 id="何谓-SPI"><a href="#何谓-SPI" class="headerlink" title="何谓 SPI"></a>何谓 SPI</h3><p>SPI 即 Service Provider Interface，字面意思就是：“服务提供者的接口”，我的理解是：专门提供给服务提供者或扩展框架功能的开发者去使用的一个接口。</p><p>SPI 将服务接口和具体的服务实现分离出来，将服务调用方和服务实现方解耦，能够提升程序的扩展性、可维护性。修改或者替换服务实现并不需要修改调用方。</p><p>很多框架都使用了 Java 的 SPI 机制，比如：Spring 框架、数据库加载驱动、日志接口、以及 Dubbo 的扩展实现等等。</p><h3 id="SPI-和-API-有什么区别？"><a href="#SPI-和-API-有什么区别？" class="headerlink" title="SPI 和 API 有什么区别？"></a>SPI 和 API 有什么区别？</h3><p>说到 SPI 就不得不说一下 API 了，从广义上来说它们都属于接口，而且很容易混淆。</p><p>一般模块之间都是通过接口进行通讯，因此我们在服务调用方和服务实现方（也称服务提供者）之间引用一个“接口”。</p><ul><li>当实现方提供了接口和实现，我们可以通过调用实现方的接口从而拥有实现方给我们提供的能力，这就是 <strong>API</strong>。这种情况下，接口和实现都是放在实现方的功能，而不需要关心具体的的实现细节。</li><li>当接口存在与调用方这边时，这就是 <strong>SPI</strong>。由接口调用方确定接口规则，然后由不同的厂商根据这个规则对这个接口进行实现，从而提供服务。</li></ul><h3 id="SPI-的优缺点"><a href="#SPI-的优缺点" class="headerlink" title="SPI 的优缺点"></a>SPI 的优缺点</h3><p>提供 SPI 机制能够大大地提高接口设计地灵活性，但是 SPI 机制也存在一些缺点：</p><ul><li>需要遍历加载所有地实现类，不能做到按需加载，这样效率还是相对较低。</li><li>当多个 <strong>ServiceLoader</strong> 同时 <strong>load</strong> 时，会有并发问题。</li></ul><h2 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h2><ul><li><strong>序列化</strong>：将数据结构或对象转换成可以存储或传输地形式，通常是二进制流，也可以是 JSON、XML 等文本格式。</li><li><strong>反序列化</strong>：将在序列化过程中所生成的数据转换为原始数据结构或者对象的过程。</li></ul><h3 id="序列化对应于-TCP-IP-4层模型的哪一层？"><a href="#序列化对应于-TCP-IP-4层模型的哪一层？" class="headerlink" title="序列化对应于 TCP &#x2F; IP 4层模型的哪一层？"></a>序列化对应于 TCP &#x2F; IP 4层模型的哪一层？</h3><p>我们知道网络通信的双方必须要采用和遵守相同的协议。TCP &#x2F; IP</p><p> 四层模型是下面这样的，序列化协议属于哪一层呢？</p><ol><li>应用层</li><li>传输层</li><li>网络层</li><li>网络接口层</li></ol><blockquote><p>1 应用层 -&gt; 为计算机用户提供服务</p><p>​   表示层 -&gt; 数据处理（编解码、加密解密、压缩解压缩）</p><p>​   会话层 -&gt; 管理（建立、维护、重连）应用程序之间的会话</p><p>2 传输层 -&gt; 为两台主机进程之间的通信提供通用的数据传输服务</p><p>3 网络层 -&gt; 路由和寻址（决定数据在网络的游走路径）</p><p>4 数据链路层 -&gt; 帧解码和误差纠正控制</p><p>​   物理层 -&gt; 透明地传送比特流</p></blockquote><p>如上图所示，OSI 七层协议模型中，表示层做的事情主要是对应用层的用户数据进行转换为二进制流。反过来的话，就是将二进制流转换成应用层的用户数据。这不就对应的是序列化和反序列化么</p><p>因为，OSI 七层协议模型中的应用层、表示层和会话层对应的是 TCP &#x2F; IP 四层模型中的应用层，所以序列化协议属于 TCP &#x2F; IP 协议应用层的一部分。</p><h2 id="I-O"><a href="#I-O" class="headerlink" title="I&#x2F;O"></a>I&#x2F;O</h2><h3 id="关于-I-O流了解吗？"><a href="#关于-I-O流了解吗？" class="headerlink" title="关于 I&#x2F;O流了解吗？"></a>关于 I&#x2F;O流了解吗？</h3><p><strong>IO</strong> 即 <strong>Input&#x2F;Output</strong>，输入和输出。数据输入到计算机内存的过程即输入，反之输出到外部存储（比如数据库，文件，远程主机）的过程即输出。数据传输过程类似于水流，因此称为 IO 流。IO 流在 Java 中分为输入流和输出流，而根据数据的处理方式又分为字节流和字符流。</p><p>Java IO 流的40多个类都是从如下 4 个抽象类基类中派生出来的。</p><ul><li><strong>InputStream</strong>&#x2F;<strong>Reader</strong>：所有输入流的基类，前者是字节输入流，后者是字符输入流。</li><li><strong>OutputStream</strong>&#x2F;<strong>Writer</strong>：所有输出流的基类，前者是字节输出流，后者是字符输出流。</li></ul><h3 id="I-O-流为什么要分为字节流和字符流呢？"><a href="#I-O-流为什么要分为字节流和字符流呢？" class="headerlink" title="I&#x2F;O 流为什么要分为字节流和字符流呢？"></a>I&#x2F;O 流为什么要分为字节流和字符流呢？</h3><p><strong>不管文件读写还是网络发送接收，信息的最小存储单元都是字节，那为什么 I&#x2F;O 流操作要分为字节流操作和字符流操作呢？</strong></p><ul><li>字符流是由 Java 虚拟机将字节转换得到的，这个过程还算是比较耗时。</li><li>如果我们不知道编码类型的话，使用字节流的过程中很容易出现乱码问题。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA基础面试题（中）</title>
      <link href="/2025/02/10/JAVA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E4%B8%AD%EF%BC%89/"/>
      <url>/2025/02/10/JAVA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E4%B8%AD%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="面向对象基础"><a href="#面向对象基础" class="headerlink" title="面向对象基础"></a>面向对象基础</h2><h3 id="面向对象和面向过程的区别"><a href="#面向对象和面向过程的区别" class="headerlink" title="面向对象和面向过程的区别"></a>面向对象和面向过程的区别</h3><p>面向过程编程（Procedural-Oriented Programming，POP）和面向对象编程（Object-Oriented Programming，OOP）是常见的编程范式，两者的主要区别在于解决问题的方式不同。</p><ul><li><strong>面向过程编程（POP）</strong>：面向过程把解决问题的过程拆成一个个方法，通过方法的执行解决问题。</li><li><strong>面向对象编程（OOP）</strong>：面向对象会先抽象出对象，然后用对象执行方法的方式解决问题。</li></ul><p>相比较于 POP，OOP 开发的程序一般具有下面这些优点：</p><ul><li><strong>易维护</strong>：由于良好的结构和封装性，OOP 程序通常更容易维护。</li><li><strong>易复用</strong>：通过继承和多态，OOP 设计使得代码更具复用性，方便扩展功能。</li><li><strong>易扩展</strong>：模块化设计使得系统扩展变得更加容易和灵活。</li></ul><p>POP 的编程方式通常更为简单和直接，适合处理一些简单的任务。</p><h3 id="创建一个对象用什么运算符？对象实体与对象引用有何不同？"><a href="#创建一个对象用什么运算符？对象实体与对象引用有何不同？" class="headerlink" title="创建一个对象用什么运算符？对象实体与对象引用有何不同？"></a>创建一个对象用什么运算符？对象实体与对象引用有何不同？</h3><p>new 运算符，new 创建对象实例（对象实例在堆内存中），对象引用指向对象实例（对象引用存在于栈内存中）。</p><ul><li>一个对象引用可以指向 0 个或一个对象。</li><li>一个对象可以有 n 个引用指向它。</li></ul><h3 id="对象的相等和引用相等的区别"><a href="#对象的相等和引用相等的区别" class="headerlink" title="对象的相等和引用相等的区别"></a>对象的相等和引用相等的区别</h3><ul><li>对象的相等一般比较的是<strong>内存中存放的内容</strong>是否相等。</li><li>引用相等一般比较的是它们<strong>指向的内存地址</strong>是否相等。</li></ul><p>如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="comment">// 使用 == 比较字符串的引用相等</span></span><br><span class="line">System.out.println(str1 == str2);</span><br><span class="line">System.out.println(str1 == str3);</span><br><span class="line"><span class="comment">// 使用 equals 方法比较字符串的相等</span></span><br><span class="line">System.out.println(str1.equals(str2));</span><br><span class="line">System.out.println(str1.equals(str3));</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">false</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br></pre></td></tr></table></figure><p>从上面的代码输出结果可以看出：</p><ul><li><strong>str1</strong> 和 <strong>str2</strong> 不相等，而 <strong>str1</strong> 和 <strong>str3</strong> 相等。这是因为 <strong>&#x3D;&#x3D;</strong> 运算符比较的是字符串的引用是否相等。</li><li><strong>str1</strong>、<strong>str2</strong>、<strong>str3</strong> 三者的内容都相等。这是因为 <strong>equals</strong> 方法比较的是字符串的内容，即使这些字符串的对象引用不同，只要它们的内容相等，就认为它们是相等的。</li></ul><h3 id="如果一个类没有声明构造方法，该程序能正确执行吗？"><a href="#如果一个类没有声明构造方法，该程序能正确执行吗？" class="headerlink" title="如果一个类没有声明构造方法，该程序能正确执行吗？"></a>如果一个类没有声明构造方法，该程序能正确执行吗？</h3><p>构造方法是一种特殊的方法，主要作用是完成对象的初始化工作。</p><p>如果一个类没有声明构造方法，也可以执行！因为一个类即使没有构造方法也会有默认的不带参数的构造方法。如果我们自己添加了类的构造方法（无论是否有参），Java 就不会添加默认的无参数的构造方法了。</p><p>我们一直在不知不觉地使用构造方法，这也是为什么我们在创建对象的时候后面要加一个括号（因为要调用无参的构造方法）。如果我们重载了有参的构造方法，记得都要把无参的构造方法也写出来（无论是否用到），因为可以帮助我们在创建对象的时候少踩坑。</p><h3 id="构造方法有那些？是否可以被-override"><a href="#构造方法有那些？是否可以被-override" class="headerlink" title="构造方法有那些？是否可以被 override ?"></a>构造方法有那些？是否可以被 override ?</h3><p>构造方法具有一下特点：</p><ul><li>名称与类名相同：构造方法的名称必须与类名完全一致。</li><li>没有返回值：构造方法没有返回类型，且不能使用 <strong>void</strong> 声明。</li><li>自动执行：在生成类的对象时，构造方法会自动执行，无需显式调用。</li></ul><p>构造方法<strong>不能被重写（override）</strong>，但<strong>可以被重载（overload）</strong>。因此，一个类中可以有多个构造方法，这些构造方法可以具有不同的参数列表，以提供不同的对象初始化方式。</p><h3 id="面向对象三大特性"><a href="#面向对象三大特性" class="headerlink" title="面向对象三大特性"></a>面向对象三大特性</h3><h4 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h4><p>封装是指把一个对象的状态信息（也就是属性）隐藏在对象内部，不允许外部对象直接访问对象的内部信息。但是可以提供一些被外界访问的方法来操作属性。就好像我们看不到挂在墙上的空调内部的零件信息（也就是属性），但是可以通过遥控器（方法）来控制空调。如果属性不想被外界访问，我们大可不必提供方法给外界访问。但是如果一个类没有提供给外界访问的方法，那么这个类也没有什么意义了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;<span class="comment">//id属性私有化</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//name属性私有化</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取id的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置id的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取name的方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置name的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>不同类型的对象，相互之间经常有一定数量的共同点。例如，小明同学、小红同学都共享学生的特性（班级、学号等）。同时，每一个对象还定义了额外的特性使得它们与众不同。例如小明同学的数学比较好，小红的性格惹人喜爱。继承是使用已存在的类定义作为基础建立新类的技术，新类的定义可以增加新的数据或新的功能，也可以用父类的功能，但不能选择性地继承父类。通过使用继承，可以快速地创建新的类，可以提高代码的重用，程序的可维护性，节省大量创建新类的时间，提高我们的开发效率。</p><h5 id="关于继承如下-3-点："><a href="#关于继承如下-3-点：" class="headerlink" title="关于继承如下 3 点："></a>关于继承如下 3 点：</h5><ul><li>子类拥有父类对象所有的属性和方法（包括私有属性和私有方法），但父类中的私有属性和方法子类是无法访问的，只是拥有。</li><li>子类可以拥有自己属性和方法，即子类可以对父类进行扩展。</li><li>子类可以用自己的方式实现父类的方法。</li></ul><h4 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h4><p>多态，顾名思义，表示一个对象具有多种的状态，具体表现为父类的引用指向子类的实例。</p><h5 id="多态的特点："><a href="#多态的特点：" class="headerlink" title="多态的特点："></a>多态的特点：</h5><ul><li>对象类型和引用类型之间具有继承（类）&#x2F;（接口）的关系。</li><li>引用类型变量发出的方法调用到底是哪个类中的方法，必须在程序运行期间才能确定。</li><li>多态不能调用“只在子类存在但父类不存在的”方法。</li><li>如果子类重写了父类的方法，真正执行的是子类重写的方法，如果子类没有重写父类的方法，执行的是父类的方法</li></ul><h3 id="接口和抽象类有什么共同点和区别？"><a href="#接口和抽象类有什么共同点和区别？" class="headerlink" title="接口和抽象类有什么共同点和区别？"></a>接口和抽象类有什么共同点和区别？</h3><p>接口和抽象类的<strong>共同点</strong>：</p><ul><li><strong>实例化</strong>：接口和抽象类都不能直接实例化，只能被实现（接口）或继承（抽象类）后才能创建具体的对象。</li><li><strong>抽象方法</strong>：接口和抽象类都可以包含抽象方法。抽象方法没有方法体，必须在子类或实现类中实现。</li></ul><p>接口和抽象类的<strong>区别</strong>：</p><ul><li><strong>设计目的</strong>：接口主要用于对类的行为进行约束，你实现了某个接口就具有了对应的行为。抽象类主要用于代码复用，强调的是所属关系。</li><li><strong>继承和实现</strong>：一个类只能继承一个类（包括抽象类），因为 Java 不支持多继承。但一个类可以实现多个接口，一个接口也可以继承多个其他接口。</li><li><strong>成员变量</strong>：接口中的成员变量只能是 <strong>public  static  final</strong> 类型的，不能被修改且必须有初始值。抽象类的成员变量可以有任何修饰符（<strong>private，protected，public</strong>），可以在子类中被重新定义或赋值。</li><li><strong>方法</strong>：<ul><li>Java 8 之前，接口中的方法默认是 <strong>public abstract</strong>，也就是只能方法声明。自 Java 8 起，可以在接口 <strong>default</strong>（默认）方法和 <strong>static</strong>（静态）方法。自 Java 9 起，接口可以包含 <strong>private</strong> 方法。</li><li>抽象类可以包含抽象方法和非抽象方法。抽象方法没有方法体，必须在子类中实现。非抽象方法有具体实现，可以直接在抽象类中使用或在子类中重写。</li></ul></li></ul><h3 id="深拷贝和浅拷贝区别了解吗？什么是引用拷贝？"><a href="#深拷贝和浅拷贝区别了解吗？什么是引用拷贝？" class="headerlink" title="深拷贝和浅拷贝区别了解吗？什么是引用拷贝？"></a>深拷贝和浅拷贝区别了解吗？什么是引用拷贝？</h3><p>关于深拷贝和浅拷贝：</p><ul><li><strong>浅拷贝</strong>：<strong>浅拷贝会在堆上创建一个新的对象</strong>（区别引用拷贝的一点），不过，如果原对象内部的属性是引用类型的话，浅拷贝会直接复制内部对象的引用地址，也就是说拷贝对象和原对象共用一个内部对象。</li><li><strong>深拷贝</strong>：深拷贝会完全复制整个对象，包括这个对象所包含的内部对象。</li></ul><p><strong>那什么是引用拷贝呢？</strong>简单来说，引用拷贝就是两个不同的引用指向同一个对象。</p><h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p>object 类是一个特殊的类，是所有类的父类，主要提供了以下 11 个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native 方法，用于返回当前运行时对象的 Class 对象，使用了 final 关键字修饰，故不允许子类重写。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native 方法，用于返回对象的哈希码，主要使用在哈希表中，比如 JDK 中的HashMap。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于比较 2 个对象的内存地址是否相等，String 类对该方法进行了重写以用于比较字符串的值是否相等。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native 方法，用于创建并返回当前对象的一份拷贝。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">native</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回类的名字实例的哈希码的 16 进制的字符串。建议 Object 所有的子类都重写这个方法。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native 方法，并且不能重写。唤醒一个在此对象监视器上等待的线程(监视器相当于就是锁的概念)。如果有多个线程在等待只会任意唤醒一个。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native 方法，并且不能重写。跟 notify 一样，唯一的区别就是会唤醒在此对象监视器上等待的所有线程，而不是一个线程。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notifyAll</span><span class="params">()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * native方法，并且不能重写。暂停线程的执行。注意：sleep 方法没有释放锁，而 wait 方法释放了锁 ，timeout 是等待时间。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多了 nanos 参数，这个参数表示额外时间（以纳秒为单位，范围是 0-999999）。 所以超时的时间还需要加上 nanos 纳秒。。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout, <span class="type">int</span> nanos)</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跟之前的2个wait方法一样，只不过该方法一直等待，没有超时时间这个概念</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实例被垃圾回收器回收的时候触发的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; &#125;</span><br></pre></td></tr></table></figure><h3 id="和-equals-区别"><a href="#和-equals-区别" class="headerlink" title="&#x3D;&#x3D; 和 equals() 区别"></a>&#x3D;&#x3D; 和 equals() 区别</h3><p><strong>&#x3D;&#x3D;</strong> 对于基本类型和引用类型的作用效果是不同的：</p><ul><li>对于<strong>基本数据类型</strong>来说，**&#x3D;&#x3D;** 比较的是<strong>值</strong>。</li><li>对于<strong>引用数据类型</strong>来说，**&#x3D;&#x3D;** 比较的是<strong>对象的内存地址</strong>。</li></ul><blockquote><p>因为 Java 只有值传递，所以，对于 &#x3D;&#x3D; 来说，不管是比较基本数据类型，还是引用数据类型的变量，其本质比较的是值，只是引用类型变量存的值是对象的地址。</p></blockquote><p><strong>equals()</strong> 不能用于判断基本数据类型的变量，只能用来判断两个对象是否相等。<strong>equals()</strong> 方法存在于 <strong>Object</strong> 类中，而 <strong>Object</strong> 类是所有类直接或间接父类，因此所有的类都有 <strong>equals()</strong> 方法。</p><p><strong>equals()</strong> 方法存在两种使用情况：</p><ul><li>类没有重写 <strong>equals()</strong> 方法：通过 <strong>equals()</strong> 比较该类的两个对象时，等价于通过 “&#x3D;&#x3D;” 比较这两个对象，使用的默认是 <strong>Object</strong> 类 <strong>equals()</strong> 方法。</li><li>类重写了 <strong>equals()</strong> 方法：一般我们都重写 <strong>equals()</strong> 方法来比较两个对象中的属性是否相等；若它们的属性相等，则返回 true（即，认为两个对象相等）。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>); <span class="comment">// a 为一个引用</span></span><br><span class="line"><span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>); <span class="comment">// b为另一个引用,对象的内容一样</span></span><br><span class="line"><span class="type">String</span> <span class="variable">aa</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// 放在常量池中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">bb</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// 从常量池中查找</span></span><br><span class="line">System.out.println(aa == bb);<span class="comment">// true</span></span><br><span class="line">System.out.println(a == b);<span class="comment">// false</span></span><br><span class="line">System.out.println(a.equals(b));<span class="comment">// true</span></span><br><span class="line">System.out.println(<span class="number">42</span> == <span class="number">42.0</span>);<span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>String</strong> 中的 <strong>equals()</strong> 方法是被重写过的，因为 <strong>Object</strong> 的 <strong>equals()</strong> 方法是比较的对象的内存地址，而 <strong>String</strong> 的 <strong>equals()</strong> 方法比较的是对象的值。</p><p>当创建 <strong>String</strong> 类型的对象时，虚拟机会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用。如果没有就在常量池中重新创建一个 <strong>String</strong> 对象。</p><h3 id="hashCode-有什么用？"><a href="#hashCode-有什么用？" class="headerlink" title="hashCode() 有什么用？"></a>hashCode() 有什么用？</h3><p><strong>hashCode()</strong> 的作用是获取哈希码（<strong>int</strong> 整数），也称为散列码。这个哈希码的作用是确定该对象在哈希表中的索引位置。</p><p>散列表存储的是键值对（key - value），它的特点是：<strong>能够根据‘键’快速的检索出对应的‘值’</strong>。<strong>这其中就利用到了散列码</strong>。</p><h3 id="为什么要有-hashCode"><a href="#为什么要有-hashCode" class="headerlink" title="为什么要有 hashCode()"></a>为什么要有 hashCode()</h3><p><strong>hashCode()</strong> 和 <strong>equals()</strong> 都是用于比较两个对象是否相等。</p><h3 id="那为什么-JDK-还要提供这两个方法呢？"><a href="#那为什么-JDK-还要提供这两个方法呢？" class="headerlink" title="那为什么 JDK 还要提供这两个方法呢？"></a>那为什么 JDK 还要提供这两个方法呢？</h3><p>这是因为在一些容器（比如 <strong>HashMap</strong>、<strong>HashSet</strong>）中，有了 <strong>hashCode()</strong> 之后，判断元素是否在对应容器中的效率会更高。</p><p>添加元素进 <strong>HashSet</strong> 的过程，如果 <strong>HashSet</strong> 在对比的时候，同样的 <strong>hashCode</strong> 有多个对象，他会继续使用 <strong>equals()</strong> 来判断是否真的相同。也就是说 <strong>hashCode</strong> 帮助我们大大缩小了查找成本。</p><h3 id="那为什么不只提供-hashCode-方法呢？"><a href="#那为什么不只提供-hashCode-方法呢？" class="headerlink" title="那为什么不只提供 hashCode() 方法呢？"></a>那为什么不只提供 hashCode() 方法呢？</h3><p>这是因为两个对象的 <strong>hashCode</strong> 值相等并不代表两个对象就相等。</p><h3 id="那为什么两个对象有相同的-hashCode值，它们也不一定是相等的？"><a href="#那为什么两个对象有相同的-hashCode值，它们也不一定是相等的？" class="headerlink" title="那为什么两个对象有相同的 hashCode值，它们也不一定是相等的？"></a>那为什么两个对象有相同的 hashCode值，它们也不一定是相等的？</h3><p>因为 <strong>hashCode()</strong> 所使用的哈希算法也许刚好让多个对象传回相同的哈希值。越糟糕的哈希算法越容易碰撞，但这也与数值域分布的特性有关（所谓哈希碰撞也就是指不同的对象得到相同的 <strong>hashCode</strong>）。</p><p>总结就是：</p><ul><li>如果两个对象的 <strong>hashCode</strong> 值相等，那这两个对象不一定相等（哈希碰撞）。</li><li>如果两个对象的 <strong>hashCode</strong> 值相等并且 <strong>equals()</strong> 方法也返回 <strong>true</strong>，我们才认为这两个对象相等。</li><li>如果两个对象的 <strong>hashCode</strong> 值不相等，我们就可以直接认为这两个对象不相等。</li></ul><h3 id="为什么重写-equals-时必须重写-hashCode-方法？"><a href="#为什么重写-equals-时必须重写-hashCode-方法？" class="headerlink" title="为什么重写 equals() 时必须重写 hashCode() 方法？"></a>为什么重写 equals() 时必须重写 hashCode() 方法？</h3><p>因为两个相等的对象的 <strong>hashCode</strong> 值必须是相等。也就是说如果 <strong>equals</strong> 方法判断两个对象是相等的，那这两个对象的 <strong>hashCode</strong> 值也要相等。</p><p>如果重写 <strong>equals()</strong> 时没有重写 <strong>hashCode()</strong> 方法的话就可能会导致 <strong>equals</strong> 方法判断是相等的两个对象，<strong>hashCode</strong> 值却不相等。</p><p><strong>总结</strong>：</p><ul><li><strong>equals</strong> 方法判断两个对象是相等的，那这两个对象的 <strong>hashCode</strong> 值也要相等。</li><li>两个对象有相同的 <strong>hashCode</strong> 值，它们也不一定相等（哈希碰撞）。</li></ul><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="String、StringBuffer、StringBuilder-的区别？"><a href="#String、StringBuffer、StringBuilder-的区别？" class="headerlink" title="String、StringBuffer、StringBuilder 的区别？"></a>String、StringBuffer、StringBuilder 的区别？</h3><h4 id="可变性"><a href="#可变性" class="headerlink" title="可变性"></a>可变性</h4><p><strong>String</strong> 是不可变的。</p><p><strong>StringBuilder</strong> 与 <strong>StringBuffer</strong> 都继承自 <strong>AbstractStringBuilder</strong> 类，在<strong>AbstractStringBuilder</strong> 中也是使用字符数组保存字符串，不过没有使用 <strong>final</strong> 和 <strong>private</strong> 关键字修饰，最关键的是这个 <strong>AbstractStringBuilder</strong> 类还提供了很多修改字符串的方法比如 <strong>append</strong> 方法。</p><h4 id="线程安全性"><a href="#线程安全性" class="headerlink" title="线程安全性"></a>线程安全性</h4><p><strong>String</strong> 中的对象是不可变的，也可以理解为常量，<strong>线程安全</strong>。<strong>AbstractStringBuilder</strong> 是 <strong>StringBuilder</strong> 和 <strong>StringBuffer</strong> 的公共父类，定义了一些字符串的基本操作，如 <strong>expandCapacity</strong>、<strong>append</strong>、<strong>insert</strong>、<strong>indexOf <strong>等公共方法。</strong>StringBuffer</strong> 对方法加了同步锁或者对调用的方法加了同步锁，所以<strong>线程是安全的</strong>。<strong>StringBuilder</strong> 并没有对方法进行加同步锁，所以是<strong>非线程安全</strong>的。</p><h4 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h4><p>每次对 <strong>String</strong> 类型进行改变的时候，都会生成一个新的 <strong>String</strong> 对象，然后将指针指向新的 <strong>String</strong> 对象。<strong>StringBuffer</strong> 每次对 <strong>StringBuffer</strong> 对象本身进行操作，而不是生成新的对象并改变对象对象引用。相同情况下使用 <strong>StringBuilder</strong> 相比使用 <strong>StringBuffer</strong> 仅能获得 10% - 15% 左右的性能提升，却要冒多线程不安全的风险。</p><h4 id="对于三者的使用总结："><a href="#对于三者的使用总结：" class="headerlink" title="对于三者的使用总结："></a>对于三者的使用总结：</h4><ul><li>操作少量的数据：适用 <strong>String</strong>。</li><li>单线程操作字符串缓冲区下操作大量数据：适用 <strong>StringBuilder</strong>。</li><li>多线程操作字符串缓冲区下操作大量数据：适用 <strong>StringBuffer</strong>。</li></ul><h3 id="字符串拼接用-“-”-还是StringBuilder-？"><a href="#字符串拼接用-“-”-还是StringBuilder-？" class="headerlink" title="字符串拼接用 “+” 还是StringBuilder ？"></a>字符串拼接用 “+” 还是StringBuilder ？</h3><p>Java 语言本身并不支持运算符重载，“+” 和 “+&#x3D;” 是专门为 String 类重载过的运算符，也就是 Java 中仅有的两个重载过的运算符。</p><p>字符串对象通过 “+” 的字符串拼接方式，实际上是通过 <strong>StringBuilder</strong> 调用 <strong>append()</strong> 方法实现的，拼接完成之后调用 <strong>toString()</strong> 得到一个 <strong>String</strong> 对象。</p><p>不过，在循环内使用 “+” 进行字符串的拼接的话，存在比较明显的缺陷：<strong>编译器不会创建单个 StringBuilder 以复用，会导致创建过多的 StringBuilder 对象</strong>。</p><p>如果直接使用 <strong>StringBuilder</strong> 对象进行字符串拼接的话，就不会存在这个问题了。</p><h3 id="String-equals-和-Object-equals-有何区别？"><a href="#String-equals-和-Object-equals-有何区别？" class="headerlink" title="String#equals() 和 Object#equals() 有何区别？"></a>String#equals() 和 Object#equals() 有何区别？</h3><p><strong>String</strong> 中的 <strong>equals()</strong> 方法是被重写过的，比较的是 String 字符串的值是否相等。<strong>Object</strong> 的 <strong>equals</strong> 方法比较的是对象的内存地址。</p><h3 id="字符串常量池的作用了解吗？"><a href="#字符串常量池的作用了解吗？" class="headerlink" title="字符串常量池的作用了解吗？"></a>字符串常量池的作用了解吗？</h3><p><strong>字符串常量池</strong> 是 <strong>JVM</strong> 为了提升性能和减少内存消耗针对字符串（String 类）专门开辟的一块区域，主要目的是为了避免字符串的重复创建。</p><h3 id="String-s1-new-String-“abc”-这句话创建了几个字符串对象？"><a href="#String-s1-new-String-“abc”-这句话创建了几个字符串对象？" class="headerlink" title="String s1 &#x3D; new String(“abc”); 这句话创建了几个字符串对象？"></a>String s1 &#x3D; new String(“abc”); 这句话创建了几个字符串对象？</h3><p>会创建 1 或 2 个字符串对象：</p><ul><li>字符串常量池中不存在 “abc” ：会创建 2 个字符串对象。一个在字符串常量池中，由虚拟机指令创建。一个在堆中，由 <strong>new String()</strong> 创建，并使用常量池中的 “abc” 进行初始化。</li><li>字符串常量池中已存在 “abc” ：会创建 1 个字符串对象。该对象在堆中，由 <strong>new String()</strong> 创建，并使用常量池中的 “abc” 进行初始化。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手写 RPC 框架</title>
      <link href="/2025/02/08/%E6%89%8B%E5%86%99-RPC-%E6%A1%86%E6%9E%B6/"/>
      <url>/2025/02/08/%E6%89%8B%E5%86%99-RPC-%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="手写-RPC-框架"><a href="#手写-RPC-框架" class="headerlink" title="手写 RPC 框架"></a>手写 RPC 框架</h1><h2 id="一、基本概念"><a href="#一、基本概念" class="headerlink" title="一、基本概念"></a>一、基本概念</h2><h3 id="什么是-RPC？"><a href="#什么是-RPC？" class="headerlink" title="什么是 RPC？"></a>什么是 RPC？</h3><p>专业定义：RPC（Remote Procedure Call）即远程过程调用，是一种计算机通信协议，它允许程序在不同的计算机之间进行通信和交互，就像本地调用一样。</p><p>简单理解，新开了一家买鱼的熟食店，现在你作为消费者想要把鱼皮购买到家。如果是以前，你只能自己跑腿到线下店铺购买，耗时耗力。但现在有了手机、网络、外卖平台，你只需要在家动动手指，就能点个外卖让骑手把鱼配送到家，你不需要关注网络是怎么传输的、外卖平台是怎么操作的、骑手小哥是怎么配送的，只负责享受鱼就行了。</p><h3 id="为什么需要-RPC？"><a href="#为什么需要-RPC？" class="headerlink" title="为什么需要 RPC？"></a>为什么需要 RPC？</h3><p>回到 RPC 的概念，RPC 允许一个程序（称为服务消费者）像调用自己程序的方法一样，调用另一个程序（称为服务提供者）的接口，而不需要了解数据的传输处理过程、底层网络通信的细节等。这些都会由 RPC 框架帮你完成，使得开发者可以轻松调用远程服务，快速开发分布式系统。</p><p>举个例子，现在有个项目 A 提供了点餐服务，项目 B 想要调用点餐服务完成下单。</p><p>点餐服务和接口的示例伪代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="comment">// 点餐，返回 orderId</span></span><br><span class="line">    <span class="type">long</span> <span class="title function_">order</span><span class="params">(参数 <span class="number">1</span>， 参数 <span class="number">2</span>， 参数 <span class="number">3</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果没有 RPC 框架，项目 B 怎么调用项目 A 的服务呢?</p><p>首先，由于项目 A 和项目 B 都是独立的系统，不能像 SDK 一样作为依赖包引入。那么就想要项目 A 提供 web 服务，并且编写一个点餐接口暴露服务，比如访问 <a href="http://acknight.com/">http://acknight.com</a> 就能调用点餐服务；然后项目 B 作为服务消费者，想要自己构造请求，并通过 HttpClient 请求上述地址。如果项目 B 想要调用更多第三方服务，每个服务和方法的调用都要编写一个 HTTP 请求，那么会非常麻烦。</p><p>示例伪代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orderId = orderService.order(参数 <span class="number">1</span>, 参数 <span class="number">2</span>, 参数 <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>看起来就跟调用自己项目的方法没有如何区别。</p><h2 id="二、RPC框架实现思路"><a href="#二、RPC框架实现思路" class="headerlink" title="二、RPC框架实现思路"></a>二、RPC框架实现思路</h2><h3 id="基本设计"><a href="#基本设计" class="headerlink" title="基本设计"></a>基本设计</h3><p>RPC框架为什么能帮我们简化调用？如何实现一个RPC框架呢？</p><p>如下图，有服务消费者和服务提供者两个角色：</p><p><img src="/img/7d0335ae-7bba-42fb-861a-60fc3ccb0331.png" alt="7d0335ae-7bba-42fb-861a-60fc3ccb0331"></p><p>消费者想要调用提供者，就想要提供者启动一个 <strong>web 服务</strong>，然后通过<strong>请求客户端</strong>发送 HTTP 或者其他协议的请求来调用。</p><p>比如请求 acknight.com&#x2F;order 地址后，提供者会调用 orderService 的 order 方法：</p><p><img src="/img/769d50cf-7f2d-4a52-b20d-d9dbf83788c8.png" alt="769d50cf-7f2d-4a52-b20d-d9dbf83788c8"></p><p>但如果提供者提供了多个服务和方法，每个接口和方法都要单独写一个接口？消费者要针对每个接口写一段 HTTP 调用逻辑吗？</p><p>其实可以提供一个统一的服务调用接口，通过<strong>请求处理器</strong>根据客户端的请求参数来进行不同的处理、调用不同的服务和方法。</p><p>可以在服务提供者程序维护一个<strong>本地服务注册器</strong>，记录服务和对应实现类的映射。</p><p>比如消费者要调用 orderService 服务的 order 方法，可以发送请求，参数为 service&#x3D;orderService,method&#x3D;order，然后请求处理器会根据 service 从服务注册器中找到对应的服务实现类，并且通过 Java 的反射机制调用 method 指定的方法。</p><p><img src="/img/5cd8205c-87ca-4d4d-98bb-ff5f77054f10.png" alt="5cd8205c-87ca-4d4d-98bb-ff5f77054f10"></p><p>想要注意的是，由于 Java 对象无法直接在网络中传输，所以要对传输的参数进行<strong>序列化</strong>和<strong>反序列化</strong>。</p><p><img src="/img/cc136568-ef60-4ceb-a946-9089e26fc945.png" alt="cc136568-ef60-4ceb-a946-9089e26fc945"></p><p>为了简化消费者发请求的代码，实现类似本地调用的体验。可以基于代理模式，为消费者要调用的接口生成一个代理对象，由代理对象完成请求和响应的过程。</p><p>所谓代理，就是有人帮你做一些事情，不用自己操心。</p><p>至此，一个最简易的 RPC 框架架构图诞生了：</p><p><img src="/img/63ec9c7e-7abc-4e44-bc4c-541a2a73e712.png" alt="63ec9c7e-7abc-4e44-bc4c-541a2a73e712"></p><p>图中虚线部分就是 RPC 框架想要提供的模块和能力。</p><h3 id="扩展设计"><a href="#扩展设计" class="headerlink" title="扩展设计"></a>扩展设计</h3><p>虽然上述设计已经跑通了基本调用流程，但离一个完备的 RPC 框架还有很大的差距，让我们带着问题来进一步完善下架构设计。</p><ol><li><h4 id="服务注册发现"><a href="#服务注册发现" class="headerlink" title="服务注册发现"></a>服务注册发现</h4><p>问题 1：消费者如何知道提供者的调用地址呢？</p><p>类比生活场景，我们点外卖时，外卖小哥如何知道我们的地址和店铺的地址？肯定是买家和卖家分别填写了地址，由平台来保存。</p><p>因此，我们想要一个<strong>注册中心</strong>，来保存提供者的地址。消费者要调用服务时，只需要从注册中心获取对应服务的提供者地址即可。</p><p><img src="/img/ea75a4f7-1e1c-483d-9a5b-78ef915d3380.png" alt="ea75a4f7-1e1c-483d-9a5b-78ef915d3380"></p><p>一般用现成的第三方注册中心，比如 Redis、Zookeeper、Nacos等。</p></li><li><h4 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h4><p>问题 2：如果有多个服务提供者，消费者应该调用哪个服务提供者呢？</p><p>我们可以给服务调用方增加负载均衡能力，通过指定不同的算法来决定调用哪一个服务提供者，比如轮询、随机、根据性能动态调用等。</p><p><img src="/img/f574b8b4-8b46-45fc-ab39-f785b0651805.png" alt="f574b8b4-8b46-45fc-ab39-f785b0651805"></p></li><li><h4 id="容错机制"><a href="#容错机制" class="headerlink" title="容错机制"></a>容错机制</h4><p>问题 3：如果服务调用失败，应该如何处理？</p><p>为了保证分布式系统的高可用，我们通常会给服务的调用增加一定的容错机制，比如失败重试、降级调用其他接口等。</p><p><img src="/img/74e4e5d7-2c31-4d26-bea7-059af2aa50b5.png" alt="74e4e5d7-2c31-4d26-bea7-059af2aa50b5"></p></li><li><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>除了上面几个经典设计外，如果想要做一个优秀的 RPC 框架，还要考虑很多问题。</p><p>比如：</p><ul><li><p>服务提供者下线了怎么办？想要一个失效节点剔除机制。</p></li><li><p>服务消费者每次都从注册中心拉去信息，性能会不会很差？可以使用缓存来优化性能。</p></li><li><p>如何优化 RPC 框架的传输通讯性能？比如选择合适的网络框架、自定义协议头、节约传输体积等。</p></li><li><p>如何让整个框架更利于扩展？比如使用 Java 的 SPI 机制、配置化等。</p></li><li><p>…</p></li></ul></li></ol><h2 id="三、开发简易版-RPC框架"><a href="#三、开发简易版-RPC框架" class="headerlink" title="三、开发简易版 RPC框架"></a>三、开发简易版 RPC框架</h2><p><img src="/img/63ec9c7e-7abc-4e44-bc4c-541a2a73e712.png" alt="63ec9c7e-7abc-4e44-bc4c-541a2a73e712"></p><h3 id="项目准备"><a href="#项目准备" class="headerlink" title="项目准备"></a>项目准备</h3><h4 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h4><p>首先创建一个项目根目录 <strong>my-rpc</strong>，然后使用IDEA开发工具依次创建几个 Maven 模块。</p><ul><li>example-common：示例代码的公共依赖，包括接口、Model等。</li><li>example-consumer：示例服务消费者代码。</li><li>example-provider：示例服务提供者代码。</li><li>my-rpc-easy：简易版 RPC 框架</li></ul><p>在示例项目中，我们将以一个最简单的用户服务为例，演示整个服务调用过程。</p><h4 id="example-common-公共模块"><a href="#example-common-公共模块" class="headerlink" title="example-common 公共模块"></a>example-common 公共模块</h4><p>公共模块需要同时被消费者和服务提供者引入，主要是编写和服务相关的接口和数据模型。</p><ul><li>编写一个用户实体类 User：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.common.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，对象需要实现序列化接口，为后续网络传输序列化提供支持。</p><ul><li>编写用户服务接口UserService，提供一个获取用户的方法：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.common.serveice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.common.model.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">getUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="example-provider-服务提供者"><a href="#example-provider-服务提供者" class="headerlink" title="example-provider 服务提供者"></a>example-provider 服务提供者</h4><p>服务提供者是真正实现了接口的模块。</p><ul><li>在 <strong>pom.xml</strong> 文件中引入依赖：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.acknight<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-rpc-easy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.acknight<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>example-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>编写服务实现类，实现公共模块中定义的用户服务接口。</p><p>功能是打印用户的名称，并返回参数中的用户对象。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.provider.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.common.model.User;</span><br><span class="line"><span class="keyword">import</span> com.acknight.common.serveice.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户名：&quot;</span> + user.getName());</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>编写服务提供者启动类 EasyProviderExample，之后会在该类的main方法中编写提供服务的代码。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.provider;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简易服务提供者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyProviderExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 提供服务</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="example-consumer-服务消费者"><a href="#example-consumer-服务消费者" class="headerlink" title="example-consumer 服务消费者"></a>example-consumer 服务消费者</h4><p>服务消费者是需要调用服务的模块。</p><ul><li>在 <strong>pom.xml</strong> 文件中引入依赖，和提供者模块的依赖一致</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.acknight<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-rpc-easy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.acknight<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>example-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>创建服务消费者启动类 EasyConsumerExample，编写调用接口的代码。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.comsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.common.model.User;</span><br><span class="line"><span class="keyword">import</span> com.acknight.common.serveice.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简易服务消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyConsumerExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 需要获取 UserService 的实现类对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;ACKnight&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> userService.getUser(user);</span><br><span class="line">        <span class="keyword">if</span> (newUser != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(newUser.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;user == null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是，现在是无法获取到userService示例的，所以预留为null。我们之后的目标是，能够通过 RPC 框架，快速得到一个支持远程调用服务提供者的代理对象，像调用本地方法一样调用 UserService 的方法。</p><h4 id="web-服务器"><a href="#web-服务器" class="headerlink" title="web 服务器"></a>web 服务器</h4><p>接下来，我们要先让服务提供者提供<strong>可远程访问</strong>的服务。那么，就需要一个 web 服务器，能够接受处理请求、并返回响应。</p><p>web 服务器的选择有很多，比如 Spring Boot 内嵌的 Tomcat、NIO 框架的 Netty 和 Vert.x 等等。</p><p>我们使用高性能的 NIO 框架和 Vert.x 来作为 RPC 框架的 web服务器。</p><p>Vert.x 官方文档：<a href="https://vertx.io/">https://vertx.io/</a></p><ul><li>打开 <strong>my-rpc-easy</strong> 项目，引入 Vert.x 和工具类的依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.vertx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>vertx-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>编写一个 web 服务器的接口 HttpServe，定义统一的启动服务器方法，便于后续的扩展，比如实现多种不同的 web 服务器。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.server;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HTTP服务器接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HttpServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动服务器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doStart</span><span class="params">(<span class="type">int</span> port)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>编写基于 Vert.x实现的 web 服务器 VertxHttpServe，能够监听指定端口并处理请求。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.server;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.vertx.core.Vertx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VertxHttpServe</span> <span class="keyword">implements</span> <span class="title class_">HttpServer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStart</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建 Vert.x 实例</span></span><br><span class="line">        <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建 HTTP 服务器</span></span><br><span class="line">        io.vertx.core.http.<span class="type">HttpServer</span> <span class="variable">server</span> <span class="operator">=</span> vertx.createHttpServer();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 监听端口并处理请求</span></span><br><span class="line">        server.requestHandler(request -&gt; &#123;</span><br><span class="line">            <span class="comment">// 处理 HTTP 请求</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Received request: &quot;</span> + request.method() + <span class="string">&quot; &quot;</span> + request.uri());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 发送 HTTP 响应</span></span><br><span class="line">            request.response()</span><br><span class="line">                    .putHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>)</span><br><span class="line">                    .end();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 启动 HTTP 服务器并监听指定端口</span></span><br><span class="line">        server.listen(port, result -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.succeeded()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Server is now listening on port &quot;</span> + port);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.err.println(<span class="string">&quot;Failed to start server: &quot;</span> + result.cause());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>验证web服务器能否启动成功并接受请求。</p><p>修改实例服务提供者模块的 <strong>EasyProviderExample</strong> 类，编写启动 web 服务的代码。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.server.HttpServer;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.server.VertxHttpServe;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简易服务提供者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyProviderExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 启动 web 服务</span></span><br><span class="line">        <span class="type">HttpServer</span> <span class="variable">httpServer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VertxHttpServe</span>();</span><br><span class="line">        httpServer.doStart(<span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过浏览器访问 <strong>localhost:8080</strong>，查看能否正常访问并看到输出的文字。</p><h4 id="本地服务注册器"><a href="#本地服务注册器" class="headerlink" title="本地服务注册器"></a>本地服务注册器</h4><p>我们现在做的简易 RPC 框架主要是跑通流程，所以暂时先不用第三方注册中心，直接把服务注册到服务提供者本地即可。</p><p>在 RPC 模块中创建本地服务注册器 LocalRegistry。</p><p>使用线程安全的 ConcurrentHashMap 存储服务注册信息，key 为服务名称、value 为服务的实现类。之后就可以根据要调用的服务名称获取到对应的实现类，然后通过反射进行方法调用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalRegistry</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册信息存储</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Class&lt;?&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> implClass</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(String serviceName, Class&lt;?&gt; implClass)</span> &#123;</span><br><span class="line">        map.put(serviceName, implClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取服务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; get(String serviceName) &#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(serviceName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除服务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceName</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(String serviceName)</span> &#123;</span><br><span class="line">        map.remove(serviceName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，本地服务注册器和注册中心的作用是有区别的。注册中心的作用侧重于管理注册的服务、提供服务信息给消费者；而本地服务注册器的作用是根据服务名获取对应的实现类，是完全调用必不可少的模块。</p><p>服务提供者启动时，需要注册服务到注册器中，修改 <strong>EasyProviderExample</strong> 代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.common.server.UserService;</span><br><span class="line"><span class="keyword">import</span> com.acknight.provider.server.Impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.registry.LocalRegistry;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.server.HttpServer;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.server.VertxHttpServe;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简易服务提供者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyProviderExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 注册服务</span></span><br><span class="line">        LocalRegistry.register(UserService.class.getName(), UserServiceImpl.class);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 启动 web 服务</span></span><br><span class="line">        <span class="type">HttpServer</span> <span class="variable">httpServer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VertxHttpServe</span>();</span><br><span class="line">        httpServer.doStart(<span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="序列化器"><a href="#序列化器" class="headerlink" title="序列化器"></a>序列化器</h4><p>服务在本地注册后，我们就可以根据请求信息取出实现类并调用方法了。</p><p>但是在编写处理请求的逻辑前，我们要先实现序列化器模块。因为无论是请求或响应，都会涉及参数的传输。而 Java 对象是存活在 JVM 虚拟机中的，如果想在其他位置存储并访问、或者在网络中进行传输，就需要进行序列化和反序列化。</p><h5 id="什么是序列化和反序列化？"><a href="#什么是序列化和反序列化？" class="headerlink" title="什么是序列化和反序列化？"></a>什么是序列化和反序列化？</h5><ul><li>序列化：将 Java 对象转为可传输的字节数组。</li><li>反序列化：将字节数组转换为 Java 对象。</li></ul><p>有很多种不同的序列化方式，比如 Java 原生序列化、JSON、Hessian、Kryo、protobuf 等。</p><ul><li>在 RPC 模块中编写序列化接口 Serializer，提供序列化和反序列化两个方法，便于后续扩展更多的序列化器。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.serializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 序列化接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 序列化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &lt;T&gt; <span class="type">byte</span>[] serialize(T object) <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反序列化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] bytes, Class&lt;T&gt; type)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>基于 Java 自带的序列化器实现 JdkSerializer。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.serializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDK 序列化器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdkSerializer</span> <span class="keyword">implements</span> <span class="title class_">Serializer</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 序列化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="type">byte</span>[] serialize(T object) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(outputStream);</span><br><span class="line">        objectOutputStream.writeObject(object);</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">        <span class="keyword">return</span> outputStream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反序列化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] bytes, Class&lt;T&gt; type)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(inputStream);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) objectInputStream.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            objectInputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="提供者处理调用-请求处理器"><a href="#提供者处理调用-请求处理器" class="headerlink" title="提供者处理调用 - 请求处理器"></a>提供者处理调用 - 请求处理器</h4><p>请求处理器是 RPC 框架的实现关键，它的作用是：处理接收到的请求，并根据请求参数找到对应的服务和方法，通过反射实现调用，最后封装返回结果并响应请求。</p><ul><li><p>在 RPC 模块中编写请求和响应封装类。</p><blockquote><p>RPC模块</p><ul><li>model<ul><li>RpcRequest</li><li>RpcResponse</li></ul></li></ul></blockquote><p>请求类 RpcRequest 的作用是封装调用所需的信息，比如服务名称、方法名称、调用参数的类型列表、参数列表。这些都是 Java 反射机制所需的参数。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RPC请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcRequest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String serviceName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String methodName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 参数类型列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt;[] parameterTypes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 参数列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object[] args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​响应类 RpcResponse 的作用是封装调用方法得到的返回值、以及调用的信息（比如异常情况）等。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RPC响应</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RpcResponse</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应数据类型（预留）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt; dataType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Exception exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>编写请求处理器 HttpServerHandler。</p><blockquote><p>RPC模块</p><ul><li>server<ul><li>HttpServer</li><li>HttpServerHandler</li><li>VertxHttpServe</li></ul></li></ul></blockquote><p>业务流程如下：</p><ol><li>反序列化请求为对象，并从请求对象中获取参数。</li><li>根据服务名称从本地注册器中获取到对应的服务实现类。</li><li>通过反射机制调用方法，得到返回结果。</li><li>对返回结果进行封装和序列化，并写入到响应中。</li></ol></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.model.RpcRequest;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.model.RpcResponse;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.registry.LocalRegistry;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.serializer.JdkSerializer;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.serializer.Serializer;</span><br><span class="line"><span class="keyword">import</span> io.vertx.core.Handler;</span><br><span class="line"><span class="keyword">import</span> io.vertx.core.buffer.Buffer;</span><br><span class="line"><span class="keyword">import</span> io.vertx.core.http.HttpServerRequest;</span><br><span class="line"><span class="keyword">import</span> io.vertx.core.http.HttpServerResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpServerHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span>&lt;HttpServerRequest&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServerRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 指定序列化器</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Serializer</span> <span class="variable">serializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdkSerializer</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 记录日志</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Received request: &quot;</span> + request.method() + <span class="string">&quot; &quot;</span> + request.uri());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 异步处理 HTTP 请求</span></span><br><span class="line">        request.bodyHandler(body -&gt; &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = body.getBytes();</span><br><span class="line">            <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rpcRequest = serializer.deserialize(bytes, RpcRequest.class);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 构造响应对象</span></span><br><span class="line">            <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RpcResponse</span>();</span><br><span class="line">            <span class="comment">// 如果请求为null，直接返回</span></span><br><span class="line">            <span class="keyword">if</span> (rpcRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">                rpcResponse.setMessage(<span class="string">&quot;rpcRequest is null&quot;</span>);</span><br><span class="line">                doRequest(request, rpcResponse, serializer);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 获取要调用的服务实现类，通过反射调用</span></span><br><span class="line">                Class&lt;?&gt; implClass = LocalRegistry.get(rpcRequest.getServiceName());</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> implClass.getMethod(rpcRequest.getMethodName(), rpcRequest.getParameterTypes());</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(implClass.newInstance(), rpcRequest.getArgs());</span><br><span class="line">                <span class="comment">// 封装返回结果</span></span><br><span class="line">                rpcResponse.setData(result);</span><br><span class="line">                rpcResponse.setDataType(method.getReturnType());</span><br><span class="line">                rpcResponse.setMessage(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                rpcResponse.setMessage(e.getMessage());</span><br><span class="line">                rpcResponse.setException(e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 响应</span></span><br><span class="line">            doRequest(request, rpcResponse, serializer);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doRequest</span><span class="params">(HttpServerRequest request, RpcResponse rpcResponse, Serializer serializer)</span> &#123;</span><br><span class="line">        <span class="type">HttpServerResponse</span> <span class="variable">response</span> <span class="operator">=</span> request.response()</span><br><span class="line">                .putHeader(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 序列化</span></span><br><span class="line">            <span class="type">byte</span>[] serialized = serializer.serialize(rpcResponse);</span><br><span class="line">            response.end(Buffer.buffer(serialized));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            response.end(Buffer.buffer());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>需要注意，不同的 web 服务器对应的请求处理器实现方式也不同，比如 Vert.x 中是通过实现 <strong>hanlder<HttpServerRequest></strong> 接口来自定义处理器的。并且通过 <strong>request.bodyHandler</strong> 异步处理请求。</p><ul><li>给 HttpServer 绑定请求处理器。</li></ul><p>修改VertxHttpServer的代码，通过 <strong>server.requestHandler</strong> 绑定处理器。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.server;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.vertx.core.Vertx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VertxHttpServe</span> <span class="keyword">implements</span> <span class="title class_">HttpServer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStart</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建 Vert.x 实例</span></span><br><span class="line">        <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建 HTTP 服务器</span></span><br><span class="line">        io.vertx.core.http.<span class="type">HttpServer</span> <span class="variable">server</span> <span class="operator">=</span> vertx.createHttpServer();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 监听端口并处理请求</span></span><br><span class="line">        server.requestHandler(<span class="keyword">new</span> <span class="title class_">HttpServerHandler</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 启动 HTTP 服务器并监听指定端口</span></span><br><span class="line">        server.listen(port, result -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (result.succeeded()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Server is now listening on port &quot;</span> + port);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.err.println(<span class="string">&quot;Failed to start server: &quot;</span> + result.cause());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，引入了 RPC 框架的服务提供者模块，已经能够接受请求并完成服务调用了。</p><h4 id="消费方发起调用-代理"><a href="#消费方发起调用-代理" class="headerlink" title="消费方发起调用 - 代理"></a>消费方发起调用 - 代理</h4><p>在项目准备阶段，我们已经预留了一段调用服务的代码，只要能够获取到 UserService 对象（实现类），就能够跑通整个流程。</p><p>但 UserService 的实现类从哪来？</p><p>总不能把服务提供者的 UserServiceImpl 复制粘贴到消费者模块吧？要能那样做还需要 RPC 框架干什么？分布式系统中，我们调用其他项目或团队提供的接口时，一般只关注请求参数和响应结果，而不是关注具体实现。</p><p>在之前的架构中讲过，我们可以通过生成代理对象来简化消费方的调用。</p><p>代理的实现方式大致分为 2 类：静态代理和动态代理。</p><h5 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h5><p>静态代理是指为每一个特定类型的接口或对象，编写一个代理类。</p><p>比如在 <strong>example-consumer</strong> 模块中，创建一个静态代理 UserServiceProxy，实现 UserService 接口和 getUser 方法。</p><blockquote><p>example-consumer</p><ul><li>EasyConsumerExample</li><li>UserServiceProxy</li></ul></blockquote><p>只不过实现 getUser 方法时，不是复制粘贴提供者 UserServiceImpl 中的代码，而是要构造 HTTP 请求去调用服务提供者。</p><p>需要注意发送前要将参数序列化。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.comsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> com.acknight.common.model.User;</span><br><span class="line"><span class="keyword">import</span> com.acknight.common.serveice.UserService;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.model.RpcRequest;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.model.RpcResponse;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.serializer.JdkSerializer;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.serializer.Serializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态代理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 指定序列化器</span></span><br><span class="line">        <span class="type">Serializer</span> <span class="variable">serializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdkSerializer</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 发请求</span></span><br><span class="line">        <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> RpcRequest.builder()</span><br><span class="line">                .serviceName(UserService.class.getName())</span><br><span class="line">                .methodName(<span class="string">&quot;getUser&quot;</span>)</span><br><span class="line">                .parameterTypes(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;User.class&#125;)</span><br><span class="line">                .args(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;user&#125;)</span><br><span class="line">                .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bodyBytes = serializer.serialize(rpcRequest);</span><br><span class="line">            <span class="type">byte</span>[] result;</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">HttpResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> HttpRequest.post(<span class="string">&quot;hppt://localhost:8080&quot;</span>)</span><br><span class="line">                    .body(bodyBytes)</span><br><span class="line">                    .execute()) &#123;</span><br><span class="line">                result = httpResponse.bodyBytes();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> serializer.deserialize(result, RpcResponse.class);</span><br><span class="line">            <span class="keyword">return</span> (User) rpcResponse.getData();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后修改 EasyConsumerExample，new 一个代理对象并赋值给 userService，就能完成调用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.comsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.common.model.User;</span><br><span class="line"><span class="keyword">import</span> com.acknight.common.serveice.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简易服务消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyConsumerExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过静态代理获取 UserService 的实现类对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceProxy</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;ACKnight&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> userService.getUser(user);</span><br><span class="line">        <span class="keyword">if</span> (newUser != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(newUser.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;user == null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>静态代理虽然很好理解（就是写个实现类），但缺点也很明显，我们如果要给每个服务接口写一个实现类，是非常麻烦的，这种代理方式的灵活性很差。</p><p>所以 RPC 框架中，我们会使用动态代理。</p><h5 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h5><p>动态代理的作用是，根据生成的对象的类型，自动生成一个代理对象。</p><p>常用的动态代理实现方式有 JDK 动态代理和基于字节码生成的动态代理（比如 CGLIB）。前者简单易用，无需引入额外的库，但缺点是只能对接口进行代理；后者更灵活、可以对任何类进行代理，但性能略低于 JDK 动态代理。</p><ul><li>在 RPC 模块中编写动态代理类 ServiceProxy，需要实现 InvocationHandler 接口的 invoke 方法。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.model.RpcRequest;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.model.RpcResponse;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.serializer.JdkSerializer;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.serializer.Serializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务代理（JDK 动态代理）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 指定序列化器</span></span><br><span class="line">        <span class="type">Serializer</span> <span class="variable">serializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdkSerializer</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构造请求</span></span><br><span class="line">        <span class="type">RpcRequest</span> <span class="variable">rpcRequest</span> <span class="operator">=</span> RpcRequest.builder()</span><br><span class="line">                .serviceName(method.getDeclaringClass().getName())</span><br><span class="line">                .methodName(method.getName())</span><br><span class="line">                .parameterTypes(method.getParameterTypes())</span><br><span class="line">                .args(args)</span><br><span class="line">                .build();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 序列化</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = serializer.serialize(rpcRequest);</span><br><span class="line">            <span class="comment">// 发送请求</span></span><br><span class="line">            <span class="comment">// 这里地址被硬编码了（需要使用注册中心和服务发现机制解决）</span></span><br><span class="line">            <span class="keyword">try</span> (<span class="type">HttpResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> HttpRequest.post(<span class="string">&quot;http://localhost:8080&quot;</span>)</span><br><span class="line">                    .body(bytes)</span><br><span class="line">                    .execute()) &#123;</span><br><span class="line">                <span class="type">byte</span>[] result = httpResponse.bodyBytes();</span><br><span class="line">                <span class="comment">// 反序列化</span></span><br><span class="line">                <span class="type">RpcResponse</span> <span class="variable">rpcResponse</span> <span class="operator">=</span> serializer.deserialize(result, RpcResponse.class);</span><br><span class="line">                <span class="keyword">return</span> rpcResponse.getData();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码，当用户调用某个接口的方法时，会改为调用 invoke 方法。在 invoke 方法中，我们可以获取到要调用的方法信息、传入的参数列表等，这不就是我们服务提供者需要的参数么？用这些参数来构造请求对象就可以完成调用了。</p><p>需要注意的时，上述代码中，请求的服务提供者地址被硬编码了，需要使用注册中心和服务发现机制来解决。</p><ul><li><p>创建动态代理工厂 ServiceProxyFactory，作用是根据指定类创建动态代理对象。</p><blockquote><p>RPC 模块</p><ul><li>proxy<ul><li>ServiceProxy</li><li>ServiceProxyFactory</li></ul></li></ul></blockquote></li></ul><p>这里使用了工厂模式，来简化对象的创建过程。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.rpc.proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务代理工厂（用于创建代理对象）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceProxyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据服务类获取代理对象</span></span><br><span class="line"><span class="comment">     * 使用Proxy.newProxyInstance方法生成代理对象，这是Java反射API中创建动态代理的标准方式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceClass</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getProxy</span><span class="params">(Class&lt;T&gt; serviceClass)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(</span><br><span class="line">                serviceClass.getClassLoader(), <span class="comment">//使用接口的类加载器加载代理类</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceClass&#125;, <span class="comment">// 代理类实现的接口列表，此处仅为传入的serviceClass</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ServiceProxy</span>()); <span class="comment">// 实现InvocationHandler接口的实例，负责处理方法调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码中，主要是通过 <strong>Proxy.newProxyInstance</strong> 方法为指定类型创建代理对象。</p><ul><li>最后，在 EasyConsumerExample 中，就可以通过调用工厂来为 UserService 获取动态代理对象了。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.acknight.comsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.acknight.common.model.User;</span><br><span class="line"><span class="keyword">import</span> com.acknight.common.serveice.UserService;</span><br><span class="line"><span class="keyword">import</span> com.acknight.rpc.proxy.ServiceProxyFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简易服务消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyConsumerExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 动态代理获取 UserService 对象</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> ServiceProxyFactory.getProxy(UserService.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;ACKnight&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> userService.getUser(user);</span><br><span class="line">        <span class="keyword">if</span> (newUser != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(newUser.getName());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;user == null&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，简易版的 RPC 框架已经开发完成。</p><h2 id="四、测试验证"><a href="#四、测试验证" class="headerlink" title="四、测试验证"></a>四、测试验证</h2><ol><li><p>以 debug 模式启动服务提供者，执行 main 方法。</p></li><li><p>以 debug 模式启动服务消费者，执行 main 方法。</p><p>在 ServiceProxy 代理类中添加断点，可以看到 userService 时，实际是调用了代理对象的 invoke 方法，并且获取到了 ServiceName、methodName、参数类型和列表等信息。<img src="/img/53219879-c6f4-4573-af51-74303e9bb7af.png" alt="53219879-c6f4-4573-af51-74303e9bb7af"></p></li><li><p>继续 debug，就可以看到序列化后的请求对象，结构是字节数组。</p><p><img src="/img/ca81de23-6eae-4fda-bfad-b833a0162e4b.png" alt="ca81de23-6eae-4fda-bfad-b833a0162e4b"></p></li><li><p>在服务提供者模块的请求处理器中打断点，可以看到接受并反序列化后的请求，跟发送时的内容一致。</p><p><img src="/img/ea2773a5-7f5e-4b42-a1da-0f9bac9ae655.png" alt="ea2773a5-7f5e-4b42-a1da-0f9bac9ae655"></p></li><li><p>继续 debug，可以看到在请求处理器中，通过反射成功调用了方法，并得到返回的 User 对象。</p><p><img src="/img/307cf3d3-da97-4059-863f-0a4cb05321a8.png" alt="307cf3d3-da97-4059-863f-0a4cb05321a8"></p></li><li><p>最后，在服务提供者和消费者模块中都输出了用户名称，说明整个过程成功。</p><p><img src="/img/b8fa0a3a-5617-4587-bc93-320446d9a1f2.png" alt="b8fa0a3a-5617-4587-bc93-320446d9a1f2"></p></li></ol><p>​<img src="/img/4e8a782d-9f3c-48d2-891c-6b2708277722.png" alt="4e8a782d-9f3c-48d2-891c-6b2708277722"></p><p>至此，简易版 RPC 框架实现完成。</p>]]></content>
      
      
      <categories>
          
          <category> RPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA基础面试题（上）</title>
      <link href="/2025/02/06/JAVA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
      <url>/2025/02/06/JAVA%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="Java-语言有那些特点"><a href="#Java-语言有那些特点" class="headerlink" title="Java 语言有那些特点"></a>Java 语言有那些特点</h2><ul><li>简单易学（语法简单，上手容易）</li><li>面向对象（封装、继承、多态）</li><li>平台无关性（ Java 虚拟机实现平台无关性）</li><li>支持多线程</li><li>可靠性（具备异常处理和自动内存管理机制）</li><li>安全性（ Java 语言本身的设计就提供了多重安全防护机制如访问权限修饰符、限制程序直接访问操作系统资源）</li><li>高效性</li><li>支持网络编程</li><li>编译与解释并存</li></ul><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="Java-中的注释有几种形式？"><a href="#Java-中的注释有几种形式？" class="headerlink" title="Java 中的注释有几种形式？"></a>Java 中的注释有几种形式？</h3><h4 id="Java-中的注释有三种："><a href="#Java-中的注释有三种：" class="headerlink" title="Java 中的注释有三种："></a>Java 中的注释有三种：</h4><ul><li>单行注释：通常用于解释方法内某行代码的作用</li><li>多行注释：通常用于解释一段代码的作用</li><li>文档注释：通常用于生成 Java 开发文档</li></ul><p>用的比较多的还是单行注释和文档注释，多行注释在实际开发中使用的相对较少</p><h3 id="标识符和关键字的区别是什么？"><a href="#标识符和关键字的区别是什么？" class="headerlink" title="标识符和关键字的区别是什么？"></a>标识符和关键字的区别是什么？</h3><p>在我们编写程序的时候，想要大量地为程序、类、变量、方法等取名字，于是就有了标识符。简单来说，标识符就是一个名字。</p><p>有一些标识符，Java 语言已经赋予了其特殊的含义，只能用于特定的地方，这些特殊的标识符就是<strong>关键字</strong>。简单来说，<strong>关键字是被赋予特殊含义的标识符</strong>。比如，在我们日常生活中，如果我们想要开一家店，则要给这个店起一个名字，起的这个“名字”就叫标识符。但是我们店的名字不能叫“警察局”，因为“警察局”这个名字已经被赋予了特殊的含义。而“警察局就是我们生活中的关键字”</p><table><thead><tr><th><em>分类</em></th><th><em>关键字</em></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>访问控制</td><td>private</td><td>protected</td><td>public</td><td></td><td></td><td></td><td></td></tr><tr><td>类、方法和变量修饰符</td><td>abstract</td><td>class</td><td>extends</td><td>final</td><td>implements</td><td>interface</td><td>native</td></tr><tr><td></td><td>new</td><td>static</td><td>strictfp</td><td>synchronized</td><td>transient</td><td>volatile</td><td>enum</td></tr><tr><td>程序控制</td><td>break</td><td>continue</td><td>return</td><td>do</td><td>while</td><td>if</td><td>else</td></tr><tr><td></td><td>for</td><td>instanceof</td><td>switch</td><td>case</td><td>default</td><td>assert</td><td></td></tr><tr><td>错误处理</td><td>try</td><td>catch</td><td>throw</td><td>throws</td><td>finally</td><td></td><td></td></tr><tr><td>包相关</td><td>import</td><td>package</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>基本类型</td><td>boolean</td><td>byte</td><td>char</td><td>double</td><td>float</td><td>int</td><td>long</td></tr><tr><td></td><td>short</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>变量引用</td><td>super</td><td>this</td><td>void</td><td></td><td></td><td></td><td></td></tr><tr><td>保留字</td><td>goto</td><td>const</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="Java-中的几种基本数据类型有了解吗？"><a href="#Java-中的几种基本数据类型有了解吗？" class="headerlink" title="Java 中的几种基本数据类型有了解吗？"></a>Java 中的几种基本数据类型有了解吗？</h3><h4 id="Java-中有-8-种基本数据类型，分别为："><a href="#Java-中有-8-种基本数据类型，分别为：" class="headerlink" title="Java 中有 8 种基本数据类型，分别为："></a>Java 中有 8 种基本数据类型，分别为：</h4><ul><li>4 种整数类型：byte、short、int、long</li><li>2 种浮点型：float、double</li><li>1 种字符类型：char</li><li>1 种布尔类型：boolean</li></ul><p>这 8 种基本数据类型的默认值以及所占空间的大小如下：</p><table><thead><tr><th>基本类型</th><th>位数</th><th>字节</th><th>默认值</th><th>取值范围</th></tr></thead><tbody><tr><td>byte</td><td>8</td><td>1</td><td>0</td><td>-128 ~ 127</td></tr><tr><td>short</td><td>16</td><td>2</td><td>0</td><td>-32768（-2^15） ~ 32767（2^15 - 1）</td></tr><tr><td>int</td><td>32</td><td>4</td><td>0</td><td>-2147483648 ~ 2147483647</td></tr><tr><td>long</td><td>64</td><td>8</td><td>0L</td><td>-9223372036854775808（-2^63） ~ 9223372036854775807（2^63 -1）</td></tr><tr><td>char</td><td>16</td><td>2</td><td>‘u0000’</td><td>0 ~ 65535（2^16 - 1）</td></tr><tr><td>float</td><td>32</td><td>4</td><td>0f</td><td>1.4E-45 ~ 3.4028235E38</td></tr><tr><td>double</td><td>64</td><td>8</td><td>0d</td><td>4.9E-324 ~ 1.7976931348623157E308</td></tr><tr><td>boolean</td><td>1</td><td></td><td>false</td><td>true、false</td></tr></tbody></table><p><strong>注意：</strong></p><ol><li>Java 里使用 long 类型的数据一定要在数值后面加上 <strong>L</strong>，否则将作为整型解析</li><li>Java 里使用 float 类型的数据一定要在数值后面加上 <strong>f</strong> 或 <strong>F</strong>，否则无法通过编译</li><li>char a &#x3D; ‘h’  char：单引号， String a &#x3D; “hello”：双引号</li></ol><p>这八种基本类型都有对应的包装类：Byte、Short、Integer、Long、Float、Double、Character、Boolean</p><h4 id="基本类型和包装类型的区别？"><a href="#基本类型和包装类型的区别？" class="headerlink" title="基本类型和包装类型的区别？"></a>基本类型和包装类型的区别？</h4><ul><li><p><strong>用途</strong>：除了定义一些常量和局部变量之外，我们在其他地方比如方法参数、对象属性中很少使用基本类型来定义变量。并且，<strong>包装类型可用于泛型，而基本类型不可以</strong></p></li><li><p><strong>存储方式</strong>：基本数据类型的局部变量存放在 Java 虚拟机中的局部变量表中，基本数据类型的成员变量（未被 static 修饰）存放在 Java 虚拟机的堆中。包装类型属于对象类型，我们知道几乎所有对象实例都存在于堆中</p></li><li><p><strong>占用空间</strong>：相比包装类型（对象类型），基本数据类型占用的空间往往非常小</p></li><li><p><strong>默认值</strong>：成员变量包装类型不赋值就是 null，而基本类型有默认值且不是 null</p></li><li><p><strong>比较方式</strong>：对于基本数据类型来说， &#x3D;&#x3D; 比较的是值。对于包装类型来说， &#x3D;&#x3D; 比较的是对象的内存地址。所有整型包装类对象之间值的比较，全部使用 equals() 方法</p></li><li><p><strong>注意</strong>：基本数据类型存放在栈中是一个常见的误区！基本数据类型的存储位置取决于它们的作用域和声明方式。如果它们是局部变量，那么它们会存放在栈中；如果它们是成员变量，那么它们会存放在堆&#x2F;方法区&#x2F;元空间中</p></li></ul><h4 id="自动装箱与拆箱了解吗？原理是什么？"><a href="#自动装箱与拆箱了解吗？原理是什么？" class="headerlink" title="自动装箱与拆箱了解吗？原理是什么？"></a>自动装箱与拆箱了解吗？原理是什么？</h4><p><strong>什么是自动拆装箱？</strong></p><ul><li><p><strong>装箱</strong>：将基本类型用它们对应的引用类型包装起来</p></li><li><p><strong>拆箱</strong>：将包装类型转换为基本数据类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// 装箱</span></span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> i; <span class="comment">// 拆箱</span></span><br></pre></td></tr></table></figure><p>Integer i &#x3D; 10 等价于 Integer i &#x3D; Integer.valueOf(10);</p><p>int n &#x3D; i 等价于 int n &#x3D; i.intValue();</p><p>注意：<strong>如果频繁拆装箱的话，也会严重影响系统的性能。我们应该尽量避免不必要的拆装箱操作</strong></p></li></ul><h4 id="超过-long-整型的数据应该如何表示？"><a href="#超过-long-整型的数据应该如何表示？" class="headerlink" title="超过 long 整型的数据应该如何表示？"></a>超过 long 整型的数据应该如何表示？</h4><p>基本数值类型都有一个表达范围，如果超过这个范围就会有数值溢出的风险</p><p>在 Java 中，64为 long 整型是最大的整数类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> Long.MAX_VALUE;</span><br><span class="line">System.out.println(l + <span class="number">1</span>); <span class="comment">// -9223372036854775808</span></span><br><span class="line">System.out.println(l + <span class="number">1</span> == Long.MIN_VALUE); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>BigInteger 内部使用 int[] 数据来存储任意大小的整型数据</p><p>相对于常规整数类型的运算来说，BigInteger 运算的效率会相对较低</p><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="成员变量与局部变量的区别？"><a href="#成员变量与局部变量的区别？" class="headerlink" title="成员变量与局部变量的区别？"></a>成员变量与局部变量的区别？</h3><ul><li><strong>语法形式</strong>：从语法形式上看，成员变量是属于类的，而局部变量是在代码块或方法中定义的变量或是方法的参数；成员变量可以被 public、private、static 等修饰符所修饰，而局部变量不能被访问控制修饰符及 static 所修饰；但是，成员变量和局部变量都能被final所修饰</li><li><strong>存储方式</strong>：从变量在内存中的存储方式来看，如果成员变量是使用 static 修饰的，那么这个成员变量是属于类的，如果没有使用 static 修饰，这个成员变量是属于实例的。而对象存在于堆内存，局部变量则存在于栈内存</li><li><strong>生存时间</strong>：从变量在内存中的生存时间上看，成员变量是对象的一部分，它随着对象的创建而存在，而局部变量随着方法的调用而自动生成，随着方法的调用结束而消亡</li><li><strong>默认值</strong>：从变量是否有默认值来看，成员变量如果没有被赋初始值，则会自动以类型的默认值而赋值（一种情况例外：被 final 修饰的成员变量也必须显式地赋值）</li></ul><h3 id="静态变量有什么作用？"><a href="#静态变量有什么作用？" class="headerlink" title="静态变量有什么作用？"></a>静态变量有什么作用？</h3><p>静态变量也就是被static关键字修饰的变量。它可以被类的所有实例共享，无论一个类创建了多少个对象，这样可以节省内存</p><p>静态变量是通过类名来访问的（如果被 private 关键字修饰就无法这样访问了）</p><h3 id="字符型常量和字符串常量的区别？"><a href="#字符型常量和字符串常量的区别？" class="headerlink" title="字符型常量和字符串常量的区别？"></a>字符型常量和字符串常量的区别？</h3><ul><li><strong>形式</strong>：字符常量是单引号引起的一个字符，字符串常量是双引号引起的0个或若干个字符</li><li>含义：字符常量相当于一个整型值（ ASCII 值），可以参与表达式运算；字符串常量代表一个地址值（该字符串在内存中存放的位置）</li><li><strong>占内存大小</strong>：字符常量只占 2 个字节；字符串常量占若干字节</li></ul><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="什么是方法的返回值？方法有几种类型？"><a href="#什么是方法的返回值？方法有几种类型？" class="headerlink" title="什么是方法的返回值？方法有几种类型？"></a>什么是方法的返回值？方法有几种类型？</h3><p><strong>方法的返回值</strong> 是指我们获取到的某个方法体中的代码执行后产生的结果！（前提是该方法可能产生结果）。返回值的作用是接收出结果，使得它可以用于其他的操作</p><p>按照方法的返回值和参数类型将方法分为下面几种：</p><ol><li><p><strong>无参数无返回值的方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 下面这个方法也没有返回值，虽然用到了 return</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (...) &#123;</span><br><span class="line">        <span class="comment">// 表示结束方法的执行,下方的输出语句不会执行</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>有参数无返回值的方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">(Parameter <span class="number">1</span>, ..., Parameter n)</span> &#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>有返回值无参数的方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">f3</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>有返回值有参数的方法</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">f4</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="静态方法为什么不能调用非静态成员？"><a href="#静态方法为什么不能调用非静态成员？" class="headerlink" title="静态方法为什么不能调用非静态成员？"></a>静态方法为什么不能调用非静态成员？</h3><ol><li>静态方法是属于类的，在类加载的时候就会分配内存，可以通过类名直接访问。而非静态成员属于实例对象，只有在对象实例化之后才存在，想要通过类的实例对象去访问</li><li>在类的非静态成员不存在的时候静态方法就已经存在了，此时调用在内存中还不存在的非静态成员属于非法操作</li></ol><h4 id="静态方法和实例方法有何不同？"><a href="#静态方法和实例方法有何不同？" class="headerlink" title="静态方法和实例方法有何不同？"></a>静态方法和实例方法有何不同？</h4><ol><li><p><strong>调用方式</strong></p><p>在外部调用静态方法时，可以使用 类名.方法名 的方式，也可以使用 对象.方法名 的方式，而实例方法只能使用 对象.方法名 的方式。也就是说静态方法可以无需创建对象</p><p>不过，需要注意的是一般不建议使用 <code>对象.方法名</code> 的方式来调用静态方法。这种方式非常容易造成混淆，静态方法不属于类的某个对象而是属于这个类。</p></li><li><p><strong>访问类成员是否存在限制</strong></p><p>静态方法在访问奔类的成员时，只允许访问静态成员（即静态成员变量和静态方法），不允许访问实例成员（即实例变量和实例方法），而实例方法不存在这个限制</p></li></ol><h3 id="重载和重写有什么区别？"><a href="#重载和重写有什么区别？" class="headerlink" title="重载和重写有什么区别？"></a>重载和重写有什么区别？</h3><blockquote><p>重载就是同样的一个方法能够根据输入数据的不同，做出不同的处理</p><p>重写就是当子类继承父类的相同方法，输入数据一样，但要做出有别于父类的响应时，你就要覆盖父类方法</p></blockquote><h4 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h4><p>重载就是同一个类中多个同名方法根据不同的传参来执行不同的逻辑处理</p><h4 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h4><p>重写发生在运行期，是子类对父类的允许访问的方法的实现过程进行重新编写</p><ol><li>方法名、参数列表必须相同，子类方法返回值类型应比父类方法返回值类型更小或相等，抛出的异常范围小于等于父类，访问修饰符范围大于等于父类</li><li>如果父类方法访问修饰符为 private &#x2F; final &#x2F; static 则子类就不能重写该方法，但是被 static 修饰的方法能够被再次声明</li><li>构造方法无法被重写</li></ol><p>综上：重写就是子类对父类方法的重新改造，外部样子不能改变，内部逻辑可以改变</p><table><thead><tr><th>区别点</th><th>重载方法</th><th>重写方法</th></tr></thead><tbody><tr><td>发生范围</td><td>同一个子类</td><td>子类</td></tr><tr><td>参数列表</td><td>必须修改</td><td>一定不能修改</td></tr><tr><td>返回类型</td><td>可修改</td><td>子类方法返回值类型比父类方法返回值类型更小或相等</td></tr><tr><td>异常</td><td>可修改</td><td>子类方法声明抛出的异常类应比声明抛出的异常更小或相等</td></tr><tr><td>访问修饰符</td><td>可修改</td><td>一定不能做更严格的限制</td></tr><tr><td>发生阶段</td><td>编译期</td><td>运行期</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
